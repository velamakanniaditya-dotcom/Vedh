<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Word Wizard ğŸª„ - Super Worksheets</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@600;800;900&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORKSHEET THEME - LITERACY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --primary: #a855f7; /* Magic Purple */
  --secondary: #f43f5e; /* Spell Pink */
  --danger: #ef4444; 
  --warning: #fbbf24; 
  --blue: #3b82f6;
  --dark: #1e293b; 
  --paper: #ffffff;
  --grid: #f3e8ff; /* Light purple grid */
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Nunito', sans-serif;
  background-color: #faf5ff;
  background-image: linear-gradient(var(--grid) 2px, transparent 2px), linear-gradient(90deg, transparent 40px, #fca5a5 40px, #fca5a5 43px, transparent 43px);
  background-size: 100% 40px, 100% 100%; background-position: 0 38px, 0 0;
  color: var(--dark); min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px;
}

.home-btn {
  position: absolute; top: 20px; left: 20px; background: white; border: 3px solid var(--primary);
  color: var(--primary); padding: 8px 16px; border-radius: 50px; text-decoration: none;
  font-family: 'Fredoka One', cursive; font-size: 1.1rem; box-shadow: 0 4px 0 var(--primary); z-index: 100;
}
.home-btn:active { transform: translateY(4px); box-shadow: 0 0 0 var(--primary); }

header { text-align: center; margin-top: 40px; margin-bottom: 20px; }
h1 { font-family: 'Fredoka One', cursive; font-size: 3.5rem; color: var(--primary); text-shadow: 2px 2px 0 #fff; line-height: 1; }
.subtitle { font-size: 1.2rem; font-weight: 800; color: #475569; margin-top: 5px; }

.screen { display: none; width: 100%; max-width: 600px; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
.screen.active { display: block; }
@keyframes popIn { 0% { opacity: 0; transform: scale(0.9) translateY(20px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }

.worksheet-card { background: var(--paper); border: 4px solid var(--dark); border-radius: 24px; padding: 30px; box-shadow: 0 10px 0 rgba(30, 41, 59, 0.1); text-align: center; position: relative; }

/* Category Grid */
.cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
.cat-btn {
  background: white; border: 4px solid var(--dark); border-radius: 16px; padding: 15px 10px;
  cursor: pointer; font-family: 'Fredoka One', cursive; font-size: 1.2rem; color: var(--dark);
  box-shadow: 0 6px 0 var(--dark); transition: all 0.1s; display: flex; flex-direction: column; align-items: center; gap: 5px;
}
.cat-btn:active { transform: translateY(6px); box-shadow: 0 0 0 var(--dark); }
.cat-icon { font-size: 2.5rem; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1)); }

/* Modes */
.mode-btn { width: 100%; display: flex; align-items: center; gap: 15px; background: white; border: 4px solid var(--dark); border-radius: 20px; padding: 15px 20px; margin-bottom: 15px; cursor: pointer; text-align: left; box-shadow: 0 6px 0 var(--dark); }
.mode-btn:active { transform: translateY(6px); box-shadow: 0 0 0 var(--dark); }

/* Game Area */
.top-bar { display: flex; justify-content: space-between; font-family: 'Fredoka One', cursive; font-size: 1.5rem; margin-bottom: 15px; color: var(--dark); }
.timer-container { width: 100%; height: 20px; background: #e2e8f0; border-radius: 20px; border: 3px solid var(--dark); overflow: hidden; margin-bottom: 25px; position: relative; }
.timer-fill { height: 100%; background: var(--primary); width: 100%; transition: width 0.3s linear, background-color 0.3s; }
.time-plus { position: absolute; right: 10px; top: -5px; color: var(--primary); font-weight: 900; font-size: 1.2rem; opacity: 0; }
.time-plus.show { animation: floatUpFade 1s ease-out forwards; }
@keyframes floatUpFade { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-20px); } }

/* Dynamic Problem Layout */
.flashcard { display: flex; flex-direction: column; align-items: center; justify-content: center; margin-bottom: 25px; min-height: 180px; }
.card-emoji { font-size: 6rem; line-height: 1; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.15)); }
.word-display { font-family: 'Fredoka One', cursive; font-size: 3.5rem; color: var(--dark); margin-top: 10px; letter-spacing: 2px; }
.sentence-display { font-size: 1.6rem; font-weight: 900; color: var(--dark); line-height: 1.4; }
.hint-text { font-family: 'Fredoka One', cursive; font-size: 1.2rem; color: var(--secondary); margin-bottom: 10px; text-transform: uppercase; }

/* Options Grid */
.options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.opt-btn { font-family: 'Fredoka One', cursive; font-size: 1.6rem; background: white; border: 4px solid var(--dark); color: var(--dark); border-radius: 16px; padding: 15px 10px; cursor: pointer; box-shadow: 0 6px 0 var(--dark); transition: all 0.1s; }
.opt-btn:active { transform: translateY(6px); box-shadow: 0 0 0 var(--dark); }
.opt-btn.correct { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 6px 0 #7e22ce; }
.opt-btn.wrong { background: var(--danger); color: white; border-color: var(--danger); box-shadow: 0 6px 0 #b91c1c; }

.btn-primary { width: 100%; font-family: 'Fredoka One', cursive; font-size: 1.5rem; background: var(--primary); color: white; border: 4px solid #7e22ce; border-radius: 16px; padding: 15px; cursor: pointer; box-shadow: 0 6px 0 #7e22ce; }
.btn-primary:active { transform: translateY(6px); box-shadow: 0 0 0 #7e22ce; }

.feedback-star { position: absolute; font-size: 4rem; opacity: 0; pointer-events: none; z-index: 10; }
.feedback-star.pop { animation: starPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
@keyframes starPop { 0% { opacity: 1; transform: scale(0.5) rotate(-20deg); } 50% { transform: scale(1.2) rotate(10deg); } 100% { opacity: 0; transform: scale(1) translateY(-30px); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEST SHEET STYLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.test-header { display: flex; justify-content: space-between; font-family: 'Fredoka One'; font-size: 1.3rem; border-bottom: 3px dashed #cbd5e1; padding-bottom: 15px; margin-bottom: 20px; }
.q-row { display: flex; align-items: center; justify-content: space-between; font-size: 1.4rem; font-family: 'Nunito', sans-serif; font-weight: 900; padding: 15px 0; border-bottom: 2px solid #f1f5f9; text-align: left; }
.q-content { display: flex; align-items: center; gap: 10px; width: 60%; line-height: 1.2; }
.q-input-wrap { position: relative; width: 35%; display: flex; flex-direction: column; align-items: center; gap: 5px; }
.q-input { width: 100%; font-family: 'Fredoka One'; font-size: 1.2rem; padding: 8px; border: 3px solid var(--dark); border-radius: 12px; text-align: center; outline: none; background: white; text-transform: uppercase; }
.q-input:focus { border-color: var(--primary); }
select.q-input { appearance: none; cursor: pointer; }

/* Grading Styles */
.q-row.correct .q-input { background: #d1fae5; border-color: #10b981; color: #10b981; }
.q-row.wrong .q-input { background: #fee2e2; border-color: var(--danger); color: var(--danger); }
.correction { font-size: 1rem; color: #10b981; display: none; font-weight: 800; text-transform: uppercase; }
.q-row.wrong .correction { display: block; animation: popIn 0.3s; }

@media(max-width: 500px) {
  .cat-grid { grid-template-columns: 1fr; }
  .opt-btn { font-size: 1.3rem; padding: 12px 5px; }
  .q-row { font-size: 1.1rem; }
  .q-input { font-size: 1rem; }
}
</style>
</head>
<body>

<a href="index.html" class="home-btn">ğŸ  Home</a>

<header>
  <h1>Word Wizard</h1>
  <div class="subtitle">Spelling & Grammar ğŸª„</div>
</header>

<div id="categoryScreen" class="screen active">
  <div class="worksheet-card">
    <h2 style="font-family:'Fredoka One'; font-size: 1.8rem; color: var(--dark);">What are we learning today?</h2>
    <div class="cat-grid">
      <button class="cat-btn" style="border-color: var(--primary); color: var(--primary);" onclick="selectCategory('spell')">
        <span class="cat-icon">ğŸ”¤</span> Spell It!
      </button>
      <button class="cat-btn" style="border-color: var(--secondary); color: var(--secondary);" onclick="selectCategory('phonics')">
        <span class="cat-icon">ğŸ§©</span> Phonics (Missing Letters)
      </button>
      <button class="cat-btn" style="border-color: var(--warning); color: #d97706;" onclick="selectCategory('sentence')">
        <span class="cat-icon">âœï¸</span> Fill the Sentence
      </button>
      <button class="cat-btn" style="border-color: var(--blue); color: var(--blue);" onclick="selectCategory('grammar')">
        <span class="cat-icon">ğŸƒğŸ½â€â™‚ï¸</span> Action or Thing?
      </button>
      <button class="cat-btn" style="border-color: #ec4899; color: #ec4899; grid-column: 1 / -1;" onclick="selectCategory('jumble')">
        <span class="cat-icon">ğŸŒªï¸</span> Unjumble the Word
      </button>
    </div>
  </div>
</div>

<div id="modeScreen" class="screen">
  <div class="worksheet-card">
    <button style="background:none; border:none; color:#64748b; font-weight:bold; cursor:pointer; margin-bottom:15px; text-decoration:underline;" onclick="switchScreen('categoryScreen')">ğŸ”™ Back to Topics</button>
    <h2 style="font-family:'Fredoka One'; font-size: 1.8rem; margin-bottom: 20px; color: var(--dark);">Choose Your Mode</h2>
    
    <button class="mode-btn" style="border-color: var(--primary); box-shadow: 0 6px 0 var(--primary);" onclick="startGame('relaxed')">
      <div class="mode-icon">ğŸŒŸ</div>
      <div>
        <h3 style="font-family:'Fredoka One'; font-size: 1.4rem; color: var(--dark);">Relaxed Mode</h3>
        <p style="font-weight: 600; color: #64748b;">Timer resets every question!</p>
      </div>
    </button>

    <button class="mode-btn" style="border-color: var(--secondary); box-shadow: 0 6px 0 var(--secondary);" onclick="startGame('blast')">
      <div class="mode-icon">ğŸš€</div>
      <div>
        <h3 style="font-family:'Fredoka One'; font-size: 1.4rem; color: var(--dark);">Blast Mode</h3>
        <p style="font-weight: 600; color: #64748b;">Survival! Get +5s for correct answers.</p>
      </div>
    </button>

    <button class="mode-btn" style="border-color: #3b82f6; box-shadow: 0 6px 0 #3b82f6;" onclick="startGame('test')">
      <div class="mode-icon">ğŸ“</div>
      <div>
        <h3 style="font-family:'Fredoka One'; font-size: 1.4rem; color: var(--dark);">Test Mode</h3>
        <p style="font-weight: 600; color: #64748b;">10 Questions. Grade at the end!</p>
      </div>
    </button>
  </div>
</div>

<div id="gameScreen" class="screen">
  <div class="worksheet-card" style="position:relative;">
    <div class="feedback-star" id="fStar">â­</div>
    
    <div class="top-bar">
      <div>Score: <span id="scoreDisplay">0</span></div>
      <div id="modeDisplay" style="color: var(--primary);">ğŸŒŸ Relaxed</div>
    </div>

    <div class="timer-container">
      <div class="timer-fill" id="timerFill"></div>
      <div class="time-plus" id="timePlus">+5s</div>
    </div>

    <div id="problemArea" class="flashcard"></div>

    <div class="options-grid" id="optionsContainer">
      </div>
  </div>
</div>

<div id="testScreen" class="screen">
  <div class="worksheet-card" style="padding: 20px;">
    <button style="background:none; border:none; color:#64748b; font-weight:bold; cursor:pointer; margin-bottom:15px; text-decoration:underline;" onclick="switchScreen('modeScreen')">ğŸ”™ Quit Test</button>
    
    <div class="test-header">
      <span id="testTitle">Word Wizard Test</span>
      <span>Name: Vedh</span>
    </div>
    
    <div id="testQuestionsContainer"></div>

    <button class="btn-primary" id="submitTestBtn" style="margin-top: 30px;" onclick="gradeTest()">Submit Test ğŸ“‹</button>

    <div id="testResultArea" style="display:none; margin-top:30px;">
      <h2 style="font-family:'Fredoka One'; font-size: 2.5rem;">Score: <span id="testScoreDisplay" style="color:var(--primary);">0/10</span></h2>
      <p id="testResultMsg" style="font-weight: 800; font-size: 1.2rem; color: #64748b; margin-bottom: 20px;">Review your answers above!</p>
      <button class="btn-primary" onclick="switchScreen('categoryScreen')">Take Another Test</button>
    </div>
  </div>
</div>

<div id="endScreen" class="screen">
  <div class="worksheet-card">
    <h2 style="font-family:'Fredoka One'; font-size: 2.5rem; color: var(--dark);">Time's Up!</h2>
    <div style="font-size: 5rem; margin: 10px 0; color: var(--secondary); font-family: 'Fredoka One'; line-height: 1;" id="finalScore">0</div>
    <div style="font-size: 1.2rem; font-weight: 800; color: #64748b; margin-bottom: 25px;" id="endMessage">Great effort!</div>
    <button class="btn-primary" onclick="switchScreen('categoryScreen')">Choose Another Skill ğŸ“š</button>
  </div>
</div>

<script src="sounds.js"></script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MASSIVE DICTIONARY UPGRADE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DICT = [
  { w: "APPLE", e: "ğŸ" }, { w: "CAT", e: "ğŸ±" }, { w: "DOG", e: "ğŸ¶" }, { w: "BIRD", e: "ğŸ¦" },
  { w: "FISH", e: "ğŸŸ" }, { w: "SUN", e: "â˜€ï¸" }, { w: "MOON", e: "ğŸŒ™" }, { w: "STAR", e: "â­" },
  { w: "TREE", e: "ğŸŒ³" }, { w: "TRAIN", e: "ğŸš‚" }, { w: "HOUSE", e: "ğŸ " }, { w: "BOOK", e: "ğŸ“–" },
  { w: "FROG", e: "ğŸ¸" }, { w: "LION", e: "ğŸ¦" }, { w: "CLOCK", e: "â°" }, { w: "FIRE", e: "ğŸ”¥" },
  { w: "TIGER", e: "ğŸ¯" }, { w: "MOUSE", e: "ğŸ­" }, { w: "SNAKE", e: "ğŸ" }, { w: "BEAR", e: "ğŸ»" },
  { w: "PANDA", e: "ğŸ¼" }, { w: "ZEBRA", e: "ğŸ¦“" }, { w: "SHARK", e: "ğŸ¦ˆ" }, { w: "WHALE", e: "ğŸ‹" },
  { w: "SNAIL", e: "ğŸŒ" }, { w: "BUTTERFLY", e: "ğŸ¦‹" }, { w: "SPIDER", e: "ğŸ•·ï¸" }, { w: "ROBOT", e: "ğŸ¤–" },
  { w: "ROCKET", e: "ğŸš€" }, { w: "GUITAR", e: "ğŸ¸" }, { w: "CAMERA", e: "ğŸ“·" }, { w: "PHONE", e: "ğŸ“±" },
  { w: "CHAIR", e: "ğŸª‘" }, { w: "BED", e: "ğŸ›ï¸" }, { w: "CAR", e: "ğŸš—" }, { w: "SHIRT", e: "ğŸ‘•" }, 
  { w: "SHOES", e: "ğŸ‘" }, { w: "WATER", e: "ğŸ’§" }, { w: "CLOUD", e: "â˜ï¸" }, { w: "SNOW", e: "â„ï¸" }, 
  { w: "EARTH", e: "ğŸŒ" }
];

const PHONICS = [
  { s: "CH", w: "_ _ E E S E", e: "ğŸ§€", opts: ["CH", "SH", "TH", "PH"] },
  { s: "SH", w: "_ _ E E P", e: "ğŸ‘", opts: ["SH", "CH", "TH", "WH"] },
  { s: "TH", w: "_ _ U M B", e: "ğŸ‘", opts: ["TH", "CH", "SH", "TR"] },
  { s: "WH", w: "_ _ A L E", e: "ğŸ‹", opts: ["WH", "CH", "SH", "TH"] },
  { s: "TR", w: "_ _ E E", e: "ğŸŒ³", opts: ["TR", "CR", "DR", "BR"] },
  { s: "BR", w: "_ _ E A D", e: "ğŸ", opts: ["BR", "CR", "DR", "FR"] },
  { s: "CR", w: "_ _ A B", e: "ğŸ¦€", opts: ["CR", "BR", "TR", "DR"] },
  { s: "DR", w: "_ _ U M", e: "ğŸ¥", opts: ["DR", "TR", "CR", "BR"] },
  { s: "FL", w: "_ _ O W E R", e: "ğŸŒ»", opts: ["FL", "SL", "PL", "GL"] },
  { s: "GL", w: "_ _ A S S", e: "ğŸ¥›", opts: ["GL", "FL", "PL", "SL"] },
  { s: "PL", w: "_ _ A N T", e: "ğŸª´", opts: ["PL", "FL", "GL", "SL"] },
  { s: "SN", w: "_ _ A K E", e: "ğŸ", opts: ["SN", "SM", "SP", "ST"] },
  { s: "SP", w: "_ _ O O N", e: "ğŸ¥„", opts: ["SP", "ST", "SN", "SM"] },
  { s: "ST", w: "_ _ A R", e: "â­", opts: ["ST", "SP", "SN", "SM"] }
];

const SENTENCES = [
  { s: "The dog ___ loudly.", ans: "barks", opts: ["barks", "meows", "flies", "moos"] },
  { s: "I use a ___ to write.", ans: "pencil", opts: ["pencil", "spoon", "shoe", "car"] },
  { s: "The sun is hot and ___.", ans: "bright", opts: ["bright", "cold", "blue", "dark"] },
  { s: "Birds fly in the ___.", ans: "sky", opts: ["sky", "water", "ground", "cave"] },
  { s: "Apples grow on ___.", ans: "trees", opts: ["trees", "dogs", "clouds", "fish"] },
  { s: "The cat ___ milk.", ans: "drinks", opts: ["drinks", "eats", "reads", "plays"] },
  { s: "I sleep in my ___.", ans: "bed", opts: ["bed", "kitchen", "garden", "bath"] },
  { s: "A fish swims in the ___.", ans: "water", opts: ["water", "sky", "grass", "space"] },
  { s: "We use our eyes to ___.", ans: "see", opts: ["see", "hear", "smell", "taste"] },
  { s: "The sky is very ___ today.", ans: "blue", opts: ["blue", "green", "red", "yellow"] },
  { s: "I wear a ___ on my head.", ans: "hat", opts: ["hat", "sock", "shoe", "glove"] },
  { s: "Monkeys love to eat ___.", ans: "bananas", opts: ["bananas", "rocks", "leaves", "wood"] }
];

const GRAMMAR = [
  { w: "JUMP", type: "Action (Verb)" }, { w: "APPLE", type: "Thing (Noun)" },
  { w: "RUN", type: "Action (Verb)" }, { w: "HOUSE", type: "Thing (Noun)" },
  { w: "SLEEP", type: "Action (Verb)" }, { w: "DOG", type: "Thing (Noun)" },
  { w: "SWIM", type: "Action (Verb)" }, { w: "CAR", type: "Thing (Noun)" },
  { w: "READ", type: "Action (Verb)" }, { w: "BOOK", type: "Thing (Noun)" },
  { w: "EAT", type: "Action (Verb)" }, { w: "PIZZA", type: "Thing (Noun)" },
  { w: "PLAY", type: "Action (Verb)" }, { w: "BALL", type: "Thing (Noun)" },
  { w: "SING", type: "Action (Verb)" }, { w: "BIRD", type: "Thing (Noun)" },
  { w: "FLY", type: "Action (Verb)" }, { w: "KITE", type: "Thing (Noun)" },
  { w: "WRITE", type: "Action (Verb)" }, { w: "PENCIL", type: "Thing (Noun)" }
];

// --- GAME STATE ---
let currentCategory = '';
let currentMode = '';
let score = 0;
let timeLeft = 0;
let timeTotal = 0;
let timerInterval;
let correctAnswer = null;
let testQuestionsData = []; 

const SECONDS_RELAXED = 20; 
const SECONDS_BLAST_START = 20; 
const BONUS_TIME = 5; 

const screens = {
  categoryScreen: document.getElementById('categoryScreen'),
  modeScreen: document.getElementById('modeScreen'),
  gameScreen: document.getElementById('gameScreen'),
  testScreen: document.getElementById('testScreen'),
  endScreen: document.getElementById('endScreen')
};

const els = {
  problem: document.getElementById('problemArea'),
  opts: document.getElementById('optionsContainer'),
  score: document.getElementById('scoreDisplay'),
  timer: document.getElementById('timerFill'),
  plus: document.getElementById('timePlus'),
  mode: document.getElementById('modeDisplay'),
  star: document.getElementById('fStar')
};

function switchScreen(screenName) {
  Object.values(screens).forEach(s => s.classList.remove('active'));
  screens[screenName].classList.add('active');
  clearInterval(timerInterval);
}

function selectCategory(cat) {
  currentCategory = cat;
  switchScreen('modeScreen');
}

function startGame(mode) {
  currentMode = mode;
  score = 0;
  els.score.innerText = score;
  
  if (mode === 'test') {
    generateTest();
    switchScreen('testScreen');
    return;
  }

  if (mode === 'relaxed') {
    els.mode.innerHTML = 'ğŸŒŸ Relaxed';
    timeTotal = SECONDS_RELAXED;
    timeLeft = SECONDS_RELAXED;
  } else {
    els.mode.innerHTML = 'ğŸš€ Blast';
    timeTotal = SECONDS_BLAST_START;
    timeLeft = SECONDS_BLAST_START;
  }

  updateTimerUI();
  generateQuestion();
  switchScreen('gameScreen');

  clearInterval(timerInterval);
  timerInterval = setInterval(countdown, 1000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEST MODE LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateTest() {
  testQuestionsData = [];
  document.getElementById('submitTestBtn').style.display = 'block';
  document.getElementById('testResultArea').style.display = 'none';
  
  let titleMap = { 'spell': 'Spelling', 'phonics': 'Phonics', 'sentence': 'Sentences', 'grammar': 'Grammar', 'jumble': 'Unjumble' };
  document.getElementById('testTitle').innerText = titleMap[currentCategory] + " Test";
  
  const container = document.getElementById('testQuestionsContainer');
  container.innerHTML = '';

  for (let i = 0; i < 10; i++) {
    let questionHTML = '';
    let inputHTML = '';
    let ans = '';

    if (currentCategory === 'spell') {
      let item = DICT[Math.floor(Math.random() * DICT.length)];
      ans = item.w;
      questionHTML = `<span style="font-size:2.5rem; line-height:1;">${item.e}</span> <span>Spell this:</span>`;
      inputHTML = `<input type="text" class="q-input" id="t-input-${i}" placeholder="Type here..." autocapitalize="off" autocomplete="off">`;

    } else if (currentCategory === 'jumble') {
      let item = DICT[Math.floor(Math.random() * DICT.length)];
      ans = item.w;
      let jumbled = item.w.split('').sort(() => Math.random() - 0.5).join('');
      questionHTML = `Unjumble: <span style="color:var(--primary); letter-spacing: 2px;">${jumbled}</span>`;
      inputHTML = `<input type="text" class="q-input" id="t-input-${i}" placeholder="Type word..." autocapitalize="off" autocomplete="off">`;

    } else if (currentCategory === 'phonics') {
      let item = PHONICS[Math.floor(Math.random() * PHONICS.length)];
      ans = item.s;
      questionHTML = `<span style="font-size:2rem; line-height:1;">${item.e}</span> <span style="letter-spacing:2px; font-family:'Fredoka One';">[ ? ] ${item.w.replace('_ _ ', '')}</span>`;
      let opts = item.opts.map(o => `<option value="${o}">${o}</option>`).join('');
      inputHTML = `<select class="q-input" id="t-input-${i}"><option value="">?</option>${opts}</select>`;

    } else if (currentCategory === 'grammar') {
      let item = GRAMMAR[Math.floor(Math.random() * GRAMMAR.length)];
      ans = item.type;
      questionHTML = `Is <span style="color:var(--blue); font-family:'Fredoka One';">"${item.w}"</span> an Action or Thing?`;
      inputHTML = `
        <select class="q-input" id="t-input-${i}" style="font-size:1rem;">
          <option value="">Choose...</option><option value="Action (Verb)">Action (Verb)</option><option value="Thing (Noun)">Thing (Noun)</option>
        </select>`;

    } else if (currentCategory === 'sentence') {
      let item = SENTENCES[Math.floor(Math.random() * SENTENCES.length)];
      ans = item.ans;
      questionHTML = `<span style="font-size:1.1rem; line-height:1.2;">${item.s.replace('___', '<span style="color:var(--danger);">___</span>')}</span>`;
      let opts = item.opts.map(o => `<option value="${o}">${o}</option>`).join('');
      inputHTML = `<select class="q-input" id="t-input-${i}" style="font-size:1rem;"><option value="">?</option>${opts}</select>`;
    }

    testQuestionsData.push(ans);

    let row = document.createElement('div');
    row.className = 'q-row';
    row.id = `qrow-${i}`;
    row.innerHTML = `
      <div class="q-content">
        <span style="font-size:1.2rem; color:#94a3b8; margin-right:10px;">${i + 1}.</span>
        ${questionHTML}
      </div>
      <div class="q-input-wrap">
        ${inputHTML}
        <span class="correction" id="corr-${i}">âœ“ ${ans}</span>
      </div>
    `;
    container.appendChild(row);
  }
}

function gradeTest() {
  let testScore = 0;
  
  testQuestionsData.forEach((ans, i) => {
    let inputEl = document.getElementById(`t-input-${i}`);
    let rowEl = document.getElementById(`qrow-${i}`);
    
    // Convert both to uppercase to prevent case-sensitive errors
    let userVal = inputEl.value.toString().trim().toUpperCase();
    let correctVal = ans.toString().trim().toUpperCase();

    inputEl.disabled = true;

    if (userVal === correctVal) {
      rowEl.classList.add('correct');
      testScore++;
    } else {
      rowEl.classList.add('wrong');
    }
  });

  document.getElementById('submitTestBtn').style.display = 'none';
  document.getElementById('testResultArea').style.display = 'block';
  document.getElementById('testScoreDisplay').innerText = `${testScore}/10`;
  
  if (testScore === 10) {
    if(typeof playSound === 'function') playSound('win');
    document.getElementById('testResultMsg').innerText = "Perfect Score! Amazing! ğŸŒŸ";
  } else if (testScore >= 7) {
    if(typeof playSound === 'function') playSound('correct');
    document.getElementById('testResultMsg').innerText = "Great job! Review your mistakes. ğŸ‘";
  } else {
    if(typeof playSound === 'function') playSound('wrong');
    document.getElementById('testResultMsg').innerText = "Keep practicing! Review your answers. ğŸ’ª";
  }

  // Add XP
  let currentXP = parseInt(localStorage.getItem('vedhTotalXP')) || 0;
  localStorage.setItem('vedhTotalXP', currentXP + (testScore * 2)); 

  window.scrollTo(0, 0);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REGULAR GAME LOGIC (Relaxed / Blast)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function countdown() {
  timeLeft--;
  updateTimerUI();
  if (timeLeft <= 0) endGame();
}

function updateTimerUI() {
  let percentage = (timeLeft / timeTotal) * 100;
  if (percentage > 100) percentage = 100; if (percentage < 0) percentage = 0;
  els.timer.style.width = percentage + '%';
  if (timeLeft <= 5) els.timer.classList.add('low'); else els.timer.classList.remove('low');
}

function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

function getWrongWords(correctWord) {
  let opts = [correctWord];
  while(opts.length < 4) {
    let rnd = DICT[Math.floor(Math.random() * DICT.length)].w;
    if(!opts.includes(rnd)) opts.push(rnd);
  }
  return opts;
}

function generateQuestion() {
  if (currentMode === 'relaxed') { timeLeft = SECONDS_RELAXED; timeTotal = SECONDS_RELAXED; updateTimerUI(); }
  els.problem.innerHTML = '';
  let options = [];

  if (currentCategory === 'spell') {
    let item = DICT[Math.floor(Math.random() * DICT.length)];
    correctAnswer = item.w;
    els.problem.innerHTML = `<div class="hint-text">What is this?</div><div class="card-emoji">${item.e}</div>`;
    options = getWrongWords(correctAnswer);

  } else if (currentCategory === 'phonics') {
    let item = PHONICS[Math.floor(Math.random() * PHONICS.length)];
    correctAnswer = item.s;
    els.problem.innerHTML = `<div class="card-emoji" style="font-size:4rem;">${item.e}</div><div class="word-display">${item.w}</div>`;
    options = [...item.opts];

  } else if (currentCategory === 'sentence') {
    let item = SENTENCES[Math.floor(Math.random() * SENTENCES.length)];
    correctAnswer = item.ans;
    els.problem.innerHTML = `<div class="hint-text">Fill the blank</div><div class="sentence-display">${item.s}</div>`;
    options = [...item.opts];

  } else if (currentCategory === 'grammar') {
    let item = GRAMMAR[Math.floor(Math.random() * GRAMMAR.length)];
    correctAnswer = item.type;
    els.problem.innerHTML = `<div class="hint-text">Action or Thing?</div><div class="word-display" style="color:var(--blue);">${item.w}</div>`;
    options = ["Action (Verb)", "Thing (Noun)"];

  } else if (currentCategory === 'jumble') {
    let item = DICT[Math.floor(Math.random() * DICT.length)];
    correctAnswer = item.w;
    let jumbled = item.w.split('').sort(() => Math.random() - 0.5).join('');
    els.problem.innerHTML = `<div class="hint-text">Unjumble the word!</div><div class="word-display" style="color:var(--danger);">${jumbled}</div>`;
    options = getWrongWords(correctAnswer);
  }

  renderOptions(options);
}

function renderOptions(options) {
  if(currentCategory !== 'grammar') shuffle(options);
  els.opts.innerHTML = '';
  if(currentCategory === 'sentence') els.opts.style.gridTemplateColumns = '1fr';
  else els.opts.style.gridTemplateColumns = '1fr 1fr';

  options.forEach(opt => {
    let btn = document.createElement('button');
    btn.className = 'opt-btn';
    btn.innerText = opt;
    btn.onclick = () => checkAnswer(opt, btn);
    els.opts.appendChild(btn);
  });
}

function checkAnswer(selected, btn) {
  document.querySelectorAll('.opt-btn').forEach(b => b.disabled = true);

  if (selected === correctAnswer) {
    if(typeof playSound === 'function') playSound('correct');
    btn.classList.add('correct');
    score++; els.score.innerText = score;
    
    els.star.style.left = btn.offsetLeft + (btn.offsetWidth/2) - 20 + 'px';
    els.star.style.top = btn.offsetTop - 30 + 'px';
    els.star.classList.remove('pop'); void els.star.offsetWidth; els.star.classList.add('pop');

    if (currentMode === 'blast') {
      timeLeft += BONUS_TIME; if(timeLeft > timeTotal) timeTotal = timeLeft; 
      els.plus.classList.remove('show'); void els.plus.offsetWidth; els.plus.classList.add('show');
      updateTimerUI();
    }
    setTimeout(generateQuestion, 600);
  } else {
    if(typeof playSound === 'function') playSound('wrong');
    btn.classList.add('wrong');
    document.querySelectorAll('.opt-btn').forEach(b => { if (b.innerText === correctAnswer) b.classList.add('correct'); });
    setTimeout(generateQuestion, 1200); 
  }
}

function endGame() {
  if(typeof playSound === 'function') playSound('win');
  clearInterval(timerInterval);
  document.getElementById('finalScore').innerText = score;
  let currentXP = parseInt(localStorage.getItem('vedhTotalXP')) || 0;
  localStorage.setItem('vedhTotalXP', currentXP + score);
  
  let msg = "Keep Practising! ğŸ‘";
  if (score > 10) msg = "Great Job! ğŸŒŸ";
  if (score > 20) msg = "Spelling Bee Champion! ğŸ†";
  document.getElementById('endMessage').innerText = msg;
  switchScreen('endScreen');
}
</script>
</body>
</html>
