<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Kingdom ğŸ‘‘ - Learn, Play & Challenge!</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Baloo+2:wght@400;600;700;800&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --gold: #FFD700; --gold2: #ffb300;
  --deep-blue: #1a237e; --royal-blue: #283593;
  --green: #00e676; --green2: #00c853; --green-dark: #43a047;
  --red: #ff5252; --red-dark: #e53935;
  --orange: #ff9100; --orange-dark: #fb8c00;
  --purple: #e040fb; --blue: #40c4ff;
  --light-sq: #f0d9b5; --dark-sq: #b58863;
  --card-bg: rgba(255,255,255,0.07);
  --card-border: rgba(255,255,255,0.14);
}
* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Nunito', sans-serif;
  background: linear-gradient(145deg, #0f0c29 0%, #1a237e 35%, #283593 65%, #1565c0 100%);
  min-height: 100vh;
  color: #fff;
  overflow-x: hidden;
}

/* Starfield */
body::before {
  content:'';
  position:fixed; inset:0; z-index:0; pointer-events:none;
  background-image:
    radial-gradient(circle, rgba(255,255,255,0.7) 1px, transparent 1px),
    radial-gradient(circle, rgba(255,255,255,0.35) 1px, transparent 1px),
    radial-gradient(ellipse at 20% 50%, rgba(120,50,255,0.12) 0%, transparent 60%),
    radial-gradient(ellipse at 80% 20%, rgba(0,200,255,0.08) 0%, transparent 50%);
  background-size: 80px 80px, 35px 35px, 100% 100%, 100% 100%;
  background-position: 0 0, 18px 18px, 0 0, 0 0;
}

.container { max-width:1100px; margin:0 auto; padding:16px 16px 50px; position:relative; z-index:1; }

/* Floating Home Button */
.home-btn {
  position: absolute; top: 20px; left: 20px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(5px);
  border: 2px solid var(--gold);
  color: var(--gold);
  padding: 8px 16px;
  border-radius: 50px;
  text-decoration: none;
  font-family: 'Fredoka One', cursive;
  font-size: 1.1rem;
  display: flex; align-items: center; gap: 8px;
  transition: all 0.2s; z-index: 100;
}
.home-btn:hover { background: var(--gold); color: var(--deep-blue); transform: scale(1.05); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header { text-align:center; padding:28px 0 10px; margin-top: 30px; }
.crown-anim { font-size:3rem; display:block; animation:crown-rock 4s ease-in-out infinite; }
@keyframes crown-rock { 0%,100%{transform:rotate(-6deg) translateY(0);} 50%{transform:rotate(6deg) translateY(-10px);} }

header h1 {
  font-family:'Fredoka One', cursive;
  font-size: clamp(2.2rem,6vw,4.2rem);
  color: var(--gold);
  text-shadow: 0 4px 20px rgba(255,215,0,0.45), 3px 3px 0 rgba(0,0,0,0.35);
  letter-spacing:2px;
  animation: title-float 3.5s ease-in-out infinite;
}
@keyframes title-float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-7px);} }
header p { color:#b0bce8; font-size:1.05rem; margin-top:6px; font-weight:600; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIPS TICKER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tips-ticker {
  background: rgba(255,215,0,0.1);
  border: 1.5px solid rgba(255,215,0,0.28);
  border-radius:12px; padding:10px 20px;
  text-align:center; margin:14px 0;
  font-size:0.92rem; color:var(--gold); font-weight:700;
  transition: opacity 0.5s;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tabs {
  display:flex; gap:7px; flex-wrap:wrap;
  justify-content:center; margin:16px 0 20px;
}
.tab-btn {
  font-family:'Fredoka One', cursive;
  font-size:0.95rem; padding:9px 18px;
  border:2.5px solid rgba(255,255,255,0.25);
  border-radius:50px;
  background:rgba(255,255,255,0.09);
  color:#fff; cursor:pointer; transition:all 0.28s;
  backdrop-filter:blur(6px);
}
.tab-btn:hover, .tab-btn.active {
  background:var(--gold); color:var(--deep-blue);
  border-color:var(--gold); transform:translateY(-3px);
  box-shadow:0 6px 22px rgba(255,215,0,0.38);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section { display:none; animation:fadeUp 0.4s ease; }
.section.active { display:block; }
@keyframes fadeUp { from{opacity:0;transform:translateY(18px);} to{opacity:1;transform:translateY(0);} }

.section-title {
  font-family:'Fredoka One', cursive;
  font-size:1.9rem; color:var(--gold);
  text-align:center; margin-bottom:22px;
  text-shadow:2px 2px 0 rgba(0,0,0,0.3);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS (shared)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  background:var(--card-bg);
  border:2px solid var(--card-border);
  border-radius:20px; padding:22px 24px;
  margin-bottom:18px; backdrop-filter:blur(10px);
  transition:transform 0.28s, box-shadow 0.28s;
}
.card:hover { transform:translateY(-4px); box-shadow:0 12px 32px rgba(0,0,0,0.3); }
.card h2 { font-family:'Fredoka One',cursive; font-size:1.45rem; color:var(--gold); margin-bottom:12px; }
.card p { color:#c5cae9; line-height:1.7; font-size:1rem; margin-bottom:6px; }
.card p:last-child { margin-bottom:0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: PIECES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pieces-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(155px,1fr));
  gap:13px; margin-bottom:20px;
}
.piece-card {
  background:rgba(255,255,255,0.09); border-radius:16px;
  padding:18px 12px; text-align:center; cursor:pointer;
  border:2px solid transparent; transition:all 0.28s;
}
.piece-card:hover, .piece-card.selected {
  border-color:var(--gold); background:rgba(255,215,0,0.14);
  transform:scale(1.05);
}
.piece-emoji { font-size:3rem; display:block; margin-bottom:8px; }
.piece-name { font-family:'Fredoka One',cursive; font-size:1.05rem; color:var(--gold); }
.piece-desc { font-size:0.82rem; color:#b0bce8; margin-top:4px; }

#piece-info {
  background:rgba(255,215,0,0.09); border:2px solid var(--gold);
  border-radius:16px; padding:18px 22px; display:none; margin-top:16px;
}
#piece-info.show { display:block; animation:fadeUp 0.3s ease; }
#piece-info h3 { font-family:'Fredoka One',cursive; color:var(--gold); font-size:1.35rem; margin-bottom:9px; }
#piece-info p { color:#e8eaf6; line-height:1.7; }
#piece-info .moves-diagram { font-size:1.4rem; letter-spacing:3px; margin:9px 0; color:var(--blue); }

.value-row {
  display:flex; flex-wrap:wrap; gap:10px; margin-top:14px;
}
.val-chip {
  text-align:center; background:rgba(255,255,255,0.09);
  padding:10px 14px; border-radius:12px;
  min-width:70px;
}
.val-chip .vc-piece { font-size:1.8rem; }
.val-chip .vc-name { font-family:'Fredoka One'; color:var(--gold); font-size:0.8rem; }
.val-chip .vc-pts { font-size:1.1rem; color:#fff; margin-top:2px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: PRACTICE BOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.board-container {
  display:flex; flex-wrap:wrap; gap:22px;
  align-items:flex-start; justify-content:center;
}
.chess-board-practice {
  display:grid; grid-template-columns:repeat(8,1fr);
  border:4px solid var(--gold); border-radius:8px; overflow:hidden;
  box-shadow:0 10px 42px rgba(0,0,0,0.55); flex-shrink:0;
}
.psq {
  width:52px; height:52px;
  display:flex; align-items:center; justify-content:center;
  font-size:1.85rem; cursor:pointer; transition:filter 0.18s;
  position:relative;
}
.psq.light { background:var(--light-sq); }
.psq.dark  { background:var(--dark-sq); }
.psq.highlight { background:rgba(255,215,0,0.72) !important; }
.psq.valid-move::after {
  content:''; position:absolute;
  width:16px; height:16px; border-radius:50%;
  background:rgba(0,200,80,0.55); border:2px solid rgba(0,230,100,0.9);
  pointer-events:none;
}
.psq:hover { filter:brightness(1.12); }

.board-info { flex:1; min-width:200px; max-width:290px; }
.board-info h3 { font-family:'Fredoka One',cursive; color:var(--gold); font-size:1.25rem; margin-bottom:8px; }
.board-info p  { color:#b0bce8; font-size:0.9rem; line-height:1.6; margin-bottom:8px; }
#board-message {
  background:rgba(255,215,0,0.12); border:2px solid rgba(255,215,0,0.35);
  border-radius:12px; padding:10px 14px;
  font-weight:700; color:var(--gold); font-size:0.9rem;
}
#turn-display { font-family:'Fredoka One',cursive; font-size:1.1rem; color:#fff; margin-top:5px; }

.pboard-btn {
  font-family:'Fredoka One',cursive; font-size:0.88rem;
  padding:8px 16px; border:none; border-radius:50px;
  cursor:pointer; margin:4px 4px 4px 0; transition:all 0.25s;
}
.pboard-btn.gold { background:var(--gold); color:var(--deep-blue); }
.pboard-btn.green { background:var(--green-dark); color:#fff; }
.pboard-btn:hover { transform:translateY(-2px); box-shadow:0 5px 14px rgba(0,0,0,0.3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: OPENINGS & STRATEGIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.opening-card {
  background:var(--card-bg); border:2px solid var(--card-border);
  border-radius:16px; padding:18px; margin-bottom:14px;
  display:flex; gap:18px; align-items:flex-start; flex-wrap:wrap;
  transition:all 0.28s;
}
.opening-card:hover { background:rgba(255,255,255,0.11); transform:translateX(5px); }
.opening-icon { font-size:2.8rem; flex-shrink:0; }
.opening-content h3 { font-family:'Fredoka One',cursive; color:var(--gold); font-size:1.15rem; margin-bottom:4px; }
.moves-tag {
  font-family:monospace; font-size:0.88rem; color:#90caf9;
  background:rgba(0,0,0,0.3); padding:4px 10px; border-radius:8px;
  display:inline-block; margin:4px 0;
}
.opening-content p { color:#b0bce8; font-size:0.9rem; line-height:1.6; }
.diff-tag { display:inline-block; padding:2px 11px; border-radius:20px; font-size:0.72rem; font-weight:700; margin-left:6px; }
.tag-beginner { background:rgba(0,230,118,0.2); color:var(--green); }
.tag-intermediate { background:rgba(255,145,0,0.2); color:var(--orange); }
.tag-advanced { background:rgba(255,82,82,0.2); color:var(--red); }

.strategies-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(270px,1fr)); gap:15px; }
.strategy-card { background:var(--card-bg); border-radius:16px; padding:20px; border-left:5px solid var(--gold); transition:all 0.28s; }
.strategy-card:hover { transform:translateX(5px); background:rgba(255,255,255,0.11); }
.strategy-card h3 { font-family:'Fredoka One',cursive; color:var(--gold); font-size:1.1rem; margin-bottom:6px; }
.strategy-card p { color:#b0bce8; font-size:0.88rem; line-height:1.6; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: CHALLENGES (puzzle board)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.challenge-progress-bar {
  background:rgba(255,255,255,0.1); border-radius:20px; height:11px; overflow:hidden;
  border:1px solid rgba(255,255,255,0.14); margin:0 0 6px;
}
.challenge-progress-fill {
  height:100%; background:linear-gradient(90deg, var(--green2), var(--gold), var(--orange));
  border-radius:20px; transition:width 0.6s cubic-bezier(.4,0,.2,1); box-shadow:0 0 10px rgba(0,230,118,0.45);
}
.challenge-progress-text { text-align:center; font-size:0.82rem; color:#8090b8; margin-bottom:16px; }

.challenge-grid {
  display:grid; grid-template-columns:repeat(auto-fill, minmax(110px,1fr)); gap:8px; margin-bottom:20px;
}
.ch-thumb {
  background:var(--card-bg); border:2px solid var(--card-border); border-radius:12px; padding:10px 6px; text-align:center;
  cursor:pointer; transition:all 0.22s; position:relative; overflow:hidden;
}
.ch-thumb:hover { transform:translateY(-4px); border-color:var(--gold); box-shadow:0 8px 22px rgba(255,215,0,0.2); }
.ch-thumb.ch-active { border-color:var(--gold); background:rgba(255,215,0,0.13); }
.ch-thumb.ch-solved { border-color:var(--green); background:rgba(0,230,118,0.1); }
.ch-thumb.ch-solved::after { content:'âœ“'; position:absolute; top:3px; right:5px; color:var(--green); font-weight:800; font-size:0.85rem; }
.ch-thumb .th-icon { font-size:1.6rem; display:block; margin-bottom:3px; }
.ch-thumb .th-num { font-family:'Fredoka One'; font-size:0.7rem; color:var(--gold); font-weight:700; }
.ch-thumb .th-diff { font-size:0.6rem; padding:2px 7px; border-radius:20px; display:inline-block; margin-top:2px; font-weight:700; }

.chal-game-area { display:grid; grid-template-columns:auto 1fr; gap:18px; align-items:start; }
@media(max-width:640px){ .chal-game-area{grid-template-columns:1fr;} }

.board-label-row { display:flex; padding-left:20px; font-family:'Fredoka One'; font-size:0.72rem; color:#607090; }
.board-label-row span { width:52px; text-align:center; }
.board-row-wrap { display:flex; align-items:center; }
.board-rank-lbl { width:18px; font-family:'Fredoka One'; font-size:0.72rem; color:#607090; text-align:right; margin-right:2px; }

.chal-board {
  display:grid; grid-template-columns:repeat(8,52px);
  border:3px solid rgba(255,215,0,0.6); border-radius:6px; overflow:hidden;
  box-shadow:0 0 38px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,215,0,0.2);
}
.csq {
  width:52px; height:52px; display:flex; align-items:center; justify-content:center;
  font-size:1.85rem; cursor:pointer; transition:filter 0.15s; position:relative; user-select:none;
}
.csq.light { background:var(--light-sq); }
.csq.dark  { background:var(--dark-sq); }
.csq.csel  { outline:3px solid var(--gold); outline-offset:-3px; background:#e8c84a !important; }
.csq.cvm::after { content:''; position:absolute; width:17px; height:17px; border-radius:50%; background:rgba(0,200,80,0.52); border:2px solid rgba(0,230,100,0.9); pointer-events:none; }
.csq.cvc::after { content:''; position:absolute; inset:3px; border-radius:3px; border:3px solid rgba(255,80,80,0.85); pointer-events:none; }
.csq.ctarget { animation:pulse-tgt 1s ease-in-out infinite; }
@keyframes pulse-tgt { 0%,100%{ box-shadow:inset 0 0 0 3px rgba(255,215,0,0.8); } 50%{ box-shadow:inset 0 0 0 3px rgba(255,100,0,1), inset 0 0 12px rgba(255,150,0,0.4); } }
.csq.cflash { animation:flash-g 0.55s ease; }
@keyframes flash-g { 0%,100%{filter:brightness(1);} 50%{filter:brightness(2) saturate(2) hue-rotate(80deg);} }
.csq:hover { filter:brightness(1.1); }

@media(max-width:480px){
  .chal-board{ grid-template-columns:repeat(8,40px); }
  .csq,.board-label-row span{ width:40px; height:40px; font-size:1.35rem; }
}

.chal-side { min-width:0; }
.chal-header {
  display:flex; align-items:center; gap:10px;
  background:var(--card-bg); border:2px solid var(--card-border);
  border-radius:16px; padding:14px 18px; margin-bottom:12px;
}
.chal-big-icon { font-size:2.5rem; flex-shrink:0; }
.chal-meta h2 { font-family:'Fredoka One'; font-size:1.25rem; color:var(--gold); line-height:1.2; }
.chal-diff-badge { display:inline-block; padding:2px 11px; border-radius:20px; font-size:0.72rem; font-weight:700; margin-top:3px; }

.mission-box {
  background:linear-gradient(135deg, rgba(0,230,118,0.08), rgba(0,200,83,0.04));
  border:2px solid rgba(0,230,118,0.3); border-radius:13px; padding:13px 15px; margin-bottom:10px;
}
.mission-box h3 { color:var(--green); font-family:'Fredoka One'; font-size:0.95rem; margin-bottom:5px; }
.mission-box p { color:#c8d5e0; font-size:0.88rem; line-height:1.6; }
.target-tag {
  display:inline-flex; align-items:center; gap:5px;
  background:rgba(255,82,82,0.15); border:1.5px solid rgba(255,82,82,0.4);
  border-radius:10px; padding:4px 10px; font-size:0.9rem; font-weight:700; color:#ffa0a0; margin-top:7px;
}

.hint-box {
  background:linear-gradient(135deg, rgba(255,215,0,0.08), rgba(255,145,0,0.04));
  border:2px solid rgba(255,215,0,0.25); border-radius:13px; padding:13px 15px; margin-bottom:10px;
}
.hint-box h3 { color:var(--gold); font-family:'Fredoka One'; font-size:0.95rem; margin-bottom:5px; }
.hint-reveal-btn {
  cursor:pointer; font-size:0.75rem; background:rgba(255,215,0,0.15); padding:2px 10px; border-radius:20px; margin-left:6px; border:none; color:var(--gold); font-family:'Nunito'; font-weight:700;
}
.hint-reveal-btn:hover { background:rgba(255,215,0,0.28); }
.hint-intro { color:#ddd0a0; font-size:0.88rem; line-height:1.6; }
.hint-steps { list-style:none; margin-top:7px; }
.hint-steps li { padding:4px 0 4px 20px; position:relative; color:#c8d5e0; font-size:0.84rem; line-height:1.5; border-bottom:1px solid rgba(255,255,255,0.06); }
.hint-steps li::before { content:attr(data-n); position:absolute; left:0; color:var(--gold); font-weight:800; }

.chal-btn-row { display:flex; gap:7px; flex-wrap:wrap; margin-bottom:10px; }
.chal-btn { font-family:'Fredoka One'; font-weight:700; font-size:0.9rem; padding:8px 17px; border:none; border-radius:50px; cursor:pointer; transition:all 0.22s; }
.chal-btn-reset { background:rgba(255,255,255,0.09); color:#ccc; border:2px solid rgba(255,255,255,0.16); }
.chal-btn-reset:hover { background:rgba(255,255,255,0.16); transform:translateY(-2px); }
.chal-btn-next { background:linear-gradient(135deg,var(--green2),#00bfa5); color:#002a1a; }
.chal-btn-next:hover { transform:translateY(-2px); box-shadow:0 5px 14px rgba(0,200,100,0.38); }

.result-box { border-radius:13px; padding:14px; text-align:center; margin-bottom:10px; display:none; animation:fadeUp 0.38s ease; }
.result-box.rsuccess { background:rgba(0,230,118,0.11); border:2px solid rgba(0,230,118,0.4); display:block; }
.result-box .r-big { font-size:2.3rem; }
.result-box h3 { font-family:'Fredoka One'; font-size:1.2rem; margin:5px 0 3px; }
.result-box p { color:#c8d5e0; font-size:0.87rem; }

.moves-log { background:rgba(0,0,0,0.28); border-radius:10px; padding:9px 13px; font-size:0.8rem; color:#7080a8; line-height:1.9; min-height:30px; border:1px solid rgba(255,255,255,0.07); }
.moves-log span { color:var(--blue); font-weight:700; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION: QUIZ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.quiz-score { font-family:'Fredoka One',cursive; font-size:1.25rem; color:var(--gold); text-align:center; margin-bottom:16px; }
.quiz-progress { background:rgba(255,255,255,0.12); border-radius:20px; height:10px; overflow:hidden; max-width:320px; margin:8px auto 0; }
.quiz-progress-fill { height:100%; background:linear-gradient(90deg,var(--green2),var(--gold)); border-radius:20px; transition:width 0.5s ease; }

.quiz-box { background:var(--card-bg); border:2px solid var(--card-border); border-radius:20px; padding:28px; text-align:center; max-width:600px; margin:0 auto; }
.quiz-box h3 { font-family:'Fredoka One',cursive; color:var(--gold); font-size:1.7rem; margin-bottom:16px; }
.quiz-question { font-size:1.1rem; color:#e0e8ff; margin-bottom:22px; line-height:1.6; }
.quiz-options { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:18px; }
.quiz-opt { padding:13px; border:2px solid rgba(255,255,255,0.18); border-radius:12px; background:rgba(255,255,255,0.07); color:#fff; font-size:0.97rem; font-weight:700; cursor:pointer; transition:all 0.26s; font-family:'Nunito',sans-serif; }
.quiz-opt:hover { border-color:var(--gold); background:rgba(255,215,0,0.14); }
.quiz-opt.correct { background:var(--green-dark); border-color:var(--green-dark); }
.quiz-opt.wrong   { background:var(--red-dark);   border-color:var(--red-dark); }

.quiz-feedback { padding:13px; border-radius:12px; font-weight:700; font-size:1rem; margin-bottom:14px; display:none; }
.quiz-feedback.show { display:block; animation:fadeUp 0.3s; }
.quiz-feedback.qcorrect { background:rgba(67,160,71,0.28); border:2px solid var(--green-dark); }
.quiz-feedback.qwrong   { background:rgba(229,57,53,0.22);  border:2px solid var(--red-dark); }
.badge { display:inline-block; font-size:1.7rem; margin:4px; cursor:default; transition:transform 0.28s; }
.badge:hover { transform:scale(1.3) rotate(10deg); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.confetti-wrap { position:fixed; inset:0; pointer-events:none; z-index:999; }
.confetti-piece { position:absolute; border-radius:2px; animation:confetti-fall 2s ease-in forwards; }
@keyframes confetti-fall { 0%  { transform:translateY(-80px) rotate(0deg); opacity:1; } 100%{ transform:translateY(110vh) rotate(740deg); opacity:0; } }

@media(max-width:600px){
  .psq { width:40px; height:40px; font-size:1.35rem; }
  .chess-board-practice { grid-template-columns:repeat(8,40px); }
  .quiz-options { grid-template-columns:1fr; }
  .tab-btn { font-size:0.8rem; padding:7px 12px; }
  .pieces-grid { grid-template-columns:repeat(auto-fill,minmax(130px,1fr)); }
}
</style>
</head>
<body>
  
<a href="index.html" class="home-btn">ğŸ  Home</a>

<div class="container">
<header>
  <span class="crown-anim">â™›</span>
  <h1>Chess Kingdom</h1>
  <p>Learn â€¢ Practice â€¢ Challenge â€¢ Master! ğŸ‘‘</p>
</header>

<div class="tips-ticker" id="tipsTicker">ğŸ’¡ Tip: Control the center with your pawns on e4 and d4!</div>

<div class="tabs">
  <button class="tab-btn active"  onclick="showTab('pieces',this)">â™Ÿ Pieces</button>
  <button class="tab-btn"         onclick="showTab('board',this)">ğŸ® Practice</button>
  <button class="tab-btn"         onclick="showTab('openings',this)">ğŸ“– Openings</button>
  <button class="tab-btn"         onclick="showTab('strategies',this)">ğŸ§  Strategies</button>
  <button class="tab-btn"         onclick="showTab('tricks',this)">âš¡ Tricks</button>
  <button class="tab-btn"         onclick="showTab('challenges',this)">ğŸ† Challenges</button>
  <button class="tab-btn"         onclick="showTab('quiz',this)">â“ Quiz</button>
</div>

<div class="section active" id="section-pieces">
  <h2 class="section-title">Meet the Chess Pieces! â™Ÿ</h2>
  <div class="pieces-grid">
    <div class="piece-card" onclick="showPieceInfo('king')"><span class="piece-emoji">â™š</span><div class="piece-name">King</div><div class="piece-desc">Most important!</div></div>
    <div class="piece-card" onclick="showPieceInfo('queen')"><span class="piece-emoji">â™›</span><div class="piece-name">Queen</div><div class="piece-desc">Most powerful!</div></div>
    <div class="piece-card" onclick="showPieceInfo('rook')"><span class="piece-emoji">â™œ</span><div class="piece-name">Rook</div><div class="piece-desc">Castle warrior!</div></div>
    <div class="piece-card" onclick="showPieceInfo('bishop')"><span class="piece-emoji">â™</span><div class="piece-name">Bishop</div><div class="piece-desc">Diagonal master!</div></div>
    <div class="piece-card" onclick="showPieceInfo('knight')"><span class="piece-emoji">â™</span><div class="piece-name">Knight</div><div class="piece-desc">L-shape jumper! ğŸ´</div></div>
    <div class="piece-card" onclick="showPieceInfo('pawn')"><span class="piece-emoji">â™Ÿ</span><div class="piece-name">Pawn</div><div class="piece-desc">Little hero!</div></div>
  </div>
  <div id="piece-info">
    <h3 id="pi-name"></h3>
    <p id="pi-desc"></p>
    <div class="moves-diagram" id="pi-moves"></div>
    <p id="pi-tip"></p>
  </div>
  <div class="card" style="margin-top:18px;">
    <h2>âš–ï¸ Piece Values</h2>
    <p>Trade wisely using these point values!</p>
    <div class="value-row">
      <div class="val-chip"><div class="vc-piece">â™Ÿ</div><div class="vc-name">Pawn</div><div class="vc-pts">1 â­</div></div>
      <div class="val-chip"><div class="vc-piece">â™</div><div class="vc-name">Knight</div><div class="vc-pts">3 â­</div></div>
      <div class="val-chip"><div class="vc-piece">â™</div><div class="vc-name">Bishop</div><div class="vc-pts">3 â­</div></div>
      <div class="val-chip"><div class="vc-piece">â™œ</div><div class="vc-name">Rook</div><div class="vc-pts">5 â­</div></div>
      <div class="val-chip"><div class="vc-piece">â™›</div><div class="vc-name">Queen</div><div class="vc-pts">9 â­</div></div>
    </div>
  </div>
</div>

<div class="section" id="section-board">
  <h2 class="section-title">ğŸ® Practice Board</h2>
  <div class="board-container">
    <div>
      <div class="chess-board-practice" id="practiceBoard"></div>
      <div style="margin-top:10px;display:flex;flex-wrap:wrap;gap:6px;">
        <button class="pboard-btn gold" onclick="resetPracticeBoard()">ğŸ”„ Reset</button>
        <button class="pboard-btn green" onclick="showPracticeSetup('scholars')">âš¡ Scholar's Mate</button>
        <button class="pboard-btn green" onclick="showPracticeSetup('castling')">ğŸ° Castling Demo</button>
      </div>
    </div>
    <div class="board-info">
      <h3>How to Play</h3>
      <p>ğŸ‘† Click a piece to select it, then click a highlighted dot to move!</p>
      <div id="board-message">ğŸ® Click any White piece to get started!</div>
      <div style="margin-top:12px;">
        <h3>Turn</h3>
        <div id="turn-display">â¬œ White's turn</div>
      </div>
      <div style="margin-top:12px;">
        <h3>Captured</h3>
        <div id="captured-white" style="min-height:26px;font-size:1.1rem;margin-top:4px;"></div>
        <div id="captured-black" style="min-height:26px;font-size:1.1rem;"></div>
      </div>
    </div>
  </div>
</div>

<div class="section" id="section-openings">
  <h2 class="section-title">ğŸ“– Famous Openings</h2>
  <div class="opening-card">
    <div class="opening-icon">ğŸ¹</div>
    <div class="opening-content">
      <h3>Italian Game <span class="diff-tag tag-beginner">Beginner</span></h3>
      <div class="moves-tag">1.e4 e5 2.Nf3 Nc6 3.Bc4</div>
      <p>One of the oldest openings! White attacks f7 â€” the weakest square near Black's king. Control the center, develop your pieces fast.</p>
    </div>
  </div>
  <div class="opening-card">
    <div class="opening-icon">ğŸ›¡ï¸</div>
    <div class="opening-content">
      <h3>Sicilian Defence <span class="diff-tag tag-intermediate">Intermediate</span></h3>
      <div class="moves-tag">1.e4 c5</div>
      <p>The most popular opening in chess! Black fights back without mirroring. Creates an unbalanced, exciting game with lots of attacking chances.</p>
    </div>
  </div>
  <div class="opening-card">
    <div class="opening-icon">ğŸŒ²</div>
    <div class="opening-content">
      <h3>London System <span class="diff-tag tag-beginner">Beginner</span></h3>
      <div class="moves-tag">1.d4 d5 2.Bf4 Nf6 3.e3</div>
      <p>Solid and reliable for White. Build a strong pawn structure, develop your bishop early, and play great chess without memorising too much!</p>
    </div>
  </div>
  <div class="opening-card">
    <div class="opening-icon">ğŸ¦…</div>
    <div class="opening-content">
      <h3>King's Indian Defence <span class="diff-tag tag-intermediate">Intermediate</span></h3>
      <div class="moves-tag">1.d4 Nf6 2.c4 g6 3.Nc3 Bg7</div>
      <p>Black lets White take the center, then counterattacks! The "fianchetto" bishop on g7 becomes super-powerful. Loved by aggressive players!</p>
    </div>
  </div>
  <div class="opening-card">
    <div class="opening-icon">ğŸ­</div>
    <div class="opening-content">
      <h3>French Defence <span class="diff-tag tag-beginner">Beginner</span></h3>
      <div class="moves-tag">1.e4 e6 2.d4 d5</div>
      <p>Black builds a solid wall of pawns! Very strong and hard to break down. Great for players who like solid, patient defending.</p>
    </div>
  </div>
  <div class="card">
    <h2>ğŸŒŸ Golden Opening Rules</h2>
    <p>1. <strong>Control the center</strong> â€” squares e4, d4, e5, d5 are most important!</p>
    <p>2. <strong>Develop your pieces</strong> â€” get knights and bishops out early!</p>
    <p>3. <strong>Castle your king to safety</strong> â€” don't leave your king in the center!</p>
    <p>4. <strong>Don't move the same piece twice</strong> â€” unless there's a great reason!</p>
  </div>
</div>

<div class="section" id="section-strategies">
  <h2 class="section-title">ğŸ§  Chess Strategies</h2>
  <div class="strategies-grid">
    <div class="strategy-card"><h3>ğŸ¯ Control the Center</h3><span class="diff-tag tag-beginner">Beginner</span><p>The four center squares are the most powerful spots. Pieces here control more squares!</p></div>
    <div class="strategy-card"><h3>ğŸ° Castle Early!</h3><span class="diff-tag tag-beginner">Beginner</span><p>Castling moves your king to safety AND connects your rooks. Do it in the first 10 moves!</p></div>
    <div class="strategy-card"><h3>ğŸ¦ Piece Activity</h3><span class="diff-tag tag-beginner">Beginner</span><p>An active piece controlling many squares is worth more than a stuck piece.</p></div>
    <div class="strategy-card"><h3>ğŸ“Œ Outposts</h3><span class="diff-tag tag-intermediate">Intermediate</span><p>An outpost is a square deep in enemy territory where your piece sits safely.</p></div>
    <div class="strategy-card"><h3>ğŸ”“ Open Files</h3><span class="diff-tag tag-intermediate">Intermediate</span><p>Rooks love open files (columns with no pawns). Put rooks there to attack!</p></div>
    <div class="strategy-card"><h3>ğŸ‘‘ King Safety</h3><span class="diff-tag tag-beginner">Beginner</span><p>Never ignore your king's safety! Keep a pawn shield in front of him.</p></div>
  </div>
</div>

<div class="section" id="section-tricks">
  <h2 class="section-title">âš¡ Tactics & Tricks</h2>
  <div class="card"><h2>âš¡ Fork â€” Attack Two at Once!</h2><p>A fork attacks two enemy pieces at the same time. The most famous is the knight fork!</p></div>
  <div class="card"><h2>ğŸ“Œ Pin â€” Stuck in Place!</h2><p>A pin is when a piece can't move because moving it would expose a more valuable piece behind it.</p></div>
  <div class="card"><h2>ğŸ’¥ Skewer â€” Reverse Pin!</h2><p>A skewer attacks a valuable piece, it moves away, and then you capture the piece behind it.</p></div>
  <div class="card"><h2>ğŸ¯ Discovered Attack!</h2><p>Moving one piece to reveal a surprise attack by the piece hiding behind it!</p></div>
</div>

<div class="section" id="section-challenges">
  <h2 class="section-title">ğŸ† Chess Challenges!</h2>
  <p style="text-align:center;color:#8090b8;font-size:0.88rem;margin-bottom:10px;">ğŸ¯ Capture the target â€¢ ğŸ’¡ Use the hint â€¢ âœ… Solve all 20!</p>
  
  <div class="challenge-progress-bar"><div class="challenge-progress-fill" id="chalFill" style="width:0%"></div></div>
  <div class="challenge-progress-text" id="chalProgressText">0 of 20 challenges solved</div>

  <div class="challenge-grid" id="challengeGrid"></div>

  <div class="chal-game-area">
    <div>
      <div class="board-label-row" id="chalColLabels">
        <span>a</span><span>b</span><span>c</span><span>d</span>
        <span>e</span><span>f</span><span>g</span><span>h</span>
      </div>
      <div id="chalBoardRows" class="chal-board"></div>
    </div>
    <div class="chal-side">
      <div class="chal-header">
        <div class="chal-big-icon" id="chalIcon">ğŸ¯</div>
        <div class="chal-meta">
          <h2 id="chalTitle">Pick a Challenge Above!</h2>
          <span class="chal-diff-badge easy-tag" id="chalDiff">Easy</span>
        </div>
      </div>
      <div class="mission-box">
        <h3>ğŸ¯ Your Mission</h3>
        <p id="chalMission">Choose any challenge from the grid above to begin!</p>
        <div id="chalTargetTag"></div>
      </div>
      <div class="hint-box">
        <h3>ğŸ’¡ Hint <button class="hint-reveal-btn" id="hintRevealBtn" onclick="revealHint()">Show Hint ğŸ‘</button></h3>
        <div id="hintContent" style="display:none;">
          <p class="hint-intro" id="hintIntro"></p>
          <ul class="hint-steps" id="hintSteps"></ul>
        </div>
        <p id="hintHiddenMsg" style="color:#607090;font-size:0.85rem;">Click "Show Hint" if you're stuck!</p>
      </div>
      <div class="chal-btn-row">
        <button class="chal-btn chal-btn-reset" onclick="resetChallenge()">ğŸ”„ Reset</button>
        <button class="chal-btn chal-btn-next" id="chalNextBtn" onclick="nextChallenge()" style="display:none;">Next â¡ï¸</button>
      </div>
      <div class="result-box" id="chalResultBox">
        <div class="r-big" id="chalResultEmoji"></div>
        <h3 id="chalResultTitle"></h3>
        <p id="chalResultMsg"></p>
      </div>
      <div class="moves-log" id="chalMovesLog">Waiting for your first moveâ€¦</div>
    </div>
  </div>
</div>

<div class="section" id="section-quiz">
  <h2 class="section-title">â“ Chess Quiz Challenge!</h2>
  <div class="quiz-score">
    â­ Score: <span id="quizScore">0</span> / <span id="quizTotal">0</span>
    <div class="quiz-progress"><div class="quiz-progress-fill" id="quizProgressFill" style="width:0%"></div></div>
  </div>
  <div class="quiz-box">
    <div id="quizEmoji" style="font-size:2.8rem;margin-bottom:8px;">ğŸ¤”</div>
    <h3 id="quizQNum">Question 1 of 12</h3>
    <div class="quiz-question" id="quizQuestion"></div>
    <div class="quiz-options" id="quizOptions"></div>
    <div class="quiz-feedback" id="quizFeedback"></div>
    <button style="font-family:'Fredoka One';background:var(--gold);color:var(--deep-blue);border:none;padding:9px 22px;border-radius:50px;cursor:pointer;font-size:1rem;margin:4px;" id="quizNextBtn" onclick="quizNext()" style="display:none;">Next Question â¡ï¸</button>
    <button style="font-family:'Fredoka One';background:var(--green-dark);color:#fff;border:none;padding:9px 22px;border-radius:50px;cursor:pointer;font-size:1rem;margin:4px;" id="quizRestartBtn" onclick="quizRestart()" style="display:none;">Play Again! ğŸ”„</button>
  </div>
  <div style="text-align:center;margin-top:18px;">
    <div id="badgesLabel" style="font-size:0.9rem;color:#7080a8;margin-bottom:8px;">Earn badges by answering correctly!</div>
    <div id="earnedBadges"></div>
  </div>
</div>

</div><div class="confetti-wrap" id="confettiWrap"></div>

<script>
'use strict';

// Shared Global Functions
const WHITE = ['â™”','â™•','â™–','â™—','â™˜','â™™'];
const BLACK = ['â™š','â™›','â™œ','â™','â™','â™Ÿ'];
function isW(p){ return WHITE.includes(p); }
function isB(p){ return BLACK.includes(p); }
function isEmpty(p){ return !p; }

// TIPS TICKER
const TIPS = [
  "ğŸ’¡ Control the center with pawns on e4 and d4!",
  "ğŸ’¡ Knights are best in the center, not on the edge!",
  "ğŸ° Castle early to keep your king safe!",
  "â­ The queen is worth 9 points â€” protect her!",
  "ğŸ¯ Always look for forks, pins, and skewers!",
  "â™Ÿ Passed pawns become queens â€” push them forward!",
];
let tipIdx = 0;
setInterval(() => {
  tipIdx = (tipIdx + 1) % TIPS.length;
  document.getElementById('tipsTicker').textContent = TIPS[tipIdx];
}, 5000);

// TAB NAVIGATION
let practiceBoardInit = false;
let quizInit = false;
let challengesInit = false;

function showTab(id, btn) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('section-' + id).classList.add('active');
  btn.classList.add('active');
  if (id === 'board' && !practiceBoardInit) { initPracticeBoard(); practiceBoardInit = true; }
  if (id === 'quiz' && !quizInit) { quizStart(); quizInit = true; }
  if (id === 'challenges' && !challengesInit) { initChallenges(); challengesInit = true; }
}

// PIECE INFO
const PIECE_DATA = {
  king:   { name:"ğŸ‘‘ King", desc:"The king is the most important piece! If your king is trapped, you lose.", moves:"â†‘ â†— â†’ â†˜ â†“ â†™ â† â†–", tip:"ğŸ’¡ Keep your king safe! Castle early." },
  queen:  { name:"â™› Queen", desc:"The most powerful piece! Moves any number of squares in any direction.", moves:"â†‘â†‘ â†—â†— â†’â†’ â†˜â†˜ â†“â†“ â†™â†™ â†â† â†–â†–", tip:"ğŸ’¡ Don't bring your queen out too early!" },
  rook:   { name:"â™œ Rook", desc:"Moves any number of squares horizontally or vertically.", moves:"â†‘â†‘â†‘  â†“â†“â†“  â†â†â†  â†’â†’â†’", tip:"ğŸ’¡ Rooks love open files!" },
  bishop: { name:"â™ Bishop", desc:"Moves diagonally any number of squares.", moves:"â†—â†—  â†˜â†˜  â†™â†™  â†–â†–", tip:"ğŸ’¡ Stay on your color!" },
  knight: { name:"â™ Knight", desc:"Moves in an L-shape: 2 squares one way, 1 square sideways. It jumps!", moves:"Moves in an L-shape", tip:"ğŸ’¡ Keep knights near the center." },
  pawn:   { name:"â™Ÿ Pawn", desc:"Moves forward, captures diagonally. Can become a Queen!", moves:"â†‘ (forward)  â†—â†– (capture)", tip:"ğŸ’¡ Push passed pawns!" }
};

function showPieceInfo(p) {
  const d = PIECE_DATA[p];
  document.getElementById('pi-name').textContent = d.name;
  document.getElementById('pi-desc').textContent = d.desc;
  document.getElementById('pi-moves').textContent = d.moves;
  document.getElementById('pi-tip').textContent = d.tip;
  document.getElementById('piece-info').classList.add('show');
}

// PRACTICE BOARD
const INIT_BOARD = [
  ['â™œ','â™','â™','â™›','â™š','â™','â™','â™œ'],
  ['â™Ÿ','â™Ÿ','â™Ÿ','â™Ÿ','â™Ÿ','â™Ÿ','â™Ÿ','â™Ÿ'],
  ['','','','','','','',''],['','','','','','','',''],
  ['','','','','','','',''],['','','','','','','',''],
  ['â™™','â™™','â™™','â™™','â™™','â™™','â™™','â™™'],
  ['â™–','â™˜','â™—','â™•','â™”','â™—','â™˜','â™–'],
];
let pBoard = [], pSelected = null, pTurn = 'white', pCapW = [], pCapB = [];

function initPracticeBoard() {
  pBoard = INIT_BOARD.map(r => [...r]);
  const el = document.getElementById('practiceBoard');
  el.innerHTML = '';
  for (let r = 0; r < 8; r++) for (let c = 0; c < 8; c++) {
    const sq = document.createElement('div');
    sq.className = 'psq ' + ((r+c)%2===0?'light':'dark');
    sq.id = `psq_${r}_${c}`;
    sq.onclick = () => practiceClick(r, c);
    el.appendChild(sq);
  }
  renderPracticeBoard();
}

function renderPracticeBoard() {
  for (let r=0;r<8;r++) for (let c=0;c<8;c++) {
    const sq = document.getElementById(`psq_${r}_${c}`);
    sq.textContent = pBoard[r][c] || '';
    sq.classList.remove('highlight', 'valid-move');
  }
  document.getElementById('turn-display').textContent = pTurn==='white' ? 'â¬œ White\'s turn' : 'â¬› Black\'s turn';
}

function practiceClick(r, c) {
  const piece = pBoard[r][c];
  const isCurrentTeam = pTurn==='white' ? isW(piece) : isB(piece);
  if (pSelected) {
    const [sr, sc] = pSelected;
    const valid = getValidMoves(pBoard, sr, sc);
    const ok = valid.some(([vr,vc]) => vr===r && vc===c);
    if (ok) {
      const cap = pBoard[r][c];
      if (cap) { isW(cap) ? pCapB.push(cap) : pCapW.push(cap); }
      pBoard[r][c] = pBoard[sr][sc];
      pBoard[sr][sc] = '';
      if (pBoard[r][c]==='â™™' && r===0) pBoard[r][c]='â™•';
      if (pBoard[r][c]==='â™Ÿ' && r===7) pBoard[r][c]='â™›';
      pSelected = null;
      pTurn = pTurn==='white'?'black':'white';
      renderPracticeBoard();
    } else if (isCurrentTeam) {
      pSelected = [r, c];
      renderPracticeBoard();
      highlightPractice(r, c);
    } else {
      pSelected = null;
      renderPracticeBoard();
    }
  } else if (isCurrentTeam) {
    pSelected = [r, c];
    renderPracticeBoard();
    highlightPractice(r, c);
  }
}

function highlightPractice(r, c) {
  document.getElementById(`psq_${r}_${c}`).classList.add('highlight');
  getValidMoves(pBoard, r, c).forEach(([mr,mc]) => {
    document.getElementById(`psq_${mr}_${mc}`).classList.add('valid-move');
  });
}

function resetPracticeBoard() {
  pBoard = INIT_BOARD.map(r => [...r]);
  pSelected = null; pTurn = 'white'; pCapW = []; pCapB = [];
  renderPracticeBoard();
}

function showPracticeSetup(type) {
  resetPracticeBoard();
  if (type === 'scholars') {
    pBoard[4][4]='â™™'; pBoard[6][4]=''; pBoard[3][4]='â™Ÿ'; pBoard[1][4]=''; pBoard[4][2]='â™—'; pBoard[7][5]='';
  } else if (type === 'castling') {
    pBoard[7][5]=''; pBoard[7][6]='';
  }
  renderPracticeBoard();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHALLENGE ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CHALLENGES = [
  { id:1, icon:'ğŸ´', title:'Knight Fork Attack!', diff:'easy', mission:'Move the White Knight to fork (attack) BOTH the Black Rook and Black King at the same time!', targetLabel:'Fork the Rook & King', pieces:[ {p:'â™˜',sq:[4,4],c:'w'}, {p:'â™œ',sq:[2,2],c:'b'}, {p:'â™š',sq:[2,6],c:'b'}, ], targetCapture:null, solution:[{from:[4,4],to:[3,4]}], successMsg:'Amazing! Your Knight attacked two pieces at once â€” that\'s a FORK! ğŸ´âš¡', hint:{ intro:'The Knight moves in an L-shape: 2 squares one way, then 1 square the other.', steps:[ 'Look at the Knight on e5.', 'Move the Knight to d3 to attack both pieces at once!' ] } },
  { id:2, icon:'â™Ÿ', title:'Pawn Takes the Queen!', diff:'easy', mission:'Move your White Pawn to capture the Black Queen and win big material!', targetLabel:'Capture the Black Queen â™›', pieces:[ {p:'â™™',sq:[3,3],c:'w'}, {p:'â™›',sq:[2,4],c:'b'}, {p:'â™š',sq:[0,7],c:'b'}, {p:'â™”',sq:[7,0],c:'w'}, ], targetCapture:[2,4], solution:[{from:[3,3],to:[2,4]}], successMsg:'YES! Your tiny pawn just captured the most powerful piece! ğŸ¦¸', hint:{ intro:'Pawns capture diagonally.', steps:[ 'Click your Pawn on d5, then click the Queen on e6 to capture!' ] } },
  { id:3, icon:'ğŸ°', title:'Rook Takes the Rook!', diff:'easy', mission:'Your White Rook can capture the Black Rook on the same row. Take it!', targetLabel:'Capture the Black Rook â™œ', pieces:[ {p:'â™–',sq:[4,0],c:'w'}, {p:'â™œ',sq:[4,7],c:'b'}, {p:'â™š',sq:[0,4],c:'b'}, {p:'â™”',sq:[7,4],c:'w'}, ], targetCapture:[4,7], solution:[{from:[4,0],to:[4,7]}], successMsg:'Perfect Rook move! ğŸ°', hint:{ intro:'The Rook moves in straight lines.', steps:[ 'Slide your Rook all the way across rank 4 to capture!' ] } },
  { id:4, icon:'â™—', title:'Bishop Snipes the Knight!', diff:'easy', mission:'Move the White Bishop diagonally to capture the Black Knight!', targetLabel:'Capture the Black Knight â™', pieces:[ {p:'â™—',sq:[6,0],c:'w'}, {p:'â™',sq:[2,4],c:'b'}, {p:'â™š',sq:[0,7],c:'b'}, {p:'â™”',sq:[7,7],c:'w'}, ], targetCapture:[2,4], solution:[{from:[6,0],to:[2,4]}], successMsg:'Excellent! Your Bishop fired across the whole diagonal like a laser! â™—âœ¨', hint:{ intro:'Bishops move diagonally.', steps:[ 'Drag your Bishop all the way to e6 to capture!' ] } },
  { id:5, icon:'â™•', title:'Queen Checkmate!', diff:'easy', mission:'Move the White Queen to give CHECKMATE to the Black King!', targetLabel:'Checkmate the King â™š', pieces:[ {p:'â™•',sq:[2,0],c:'w'}, {p:'â™–',sq:[1,7],c:'w'}, {p:'â™š',sq:[0,7],c:'b'}, {p:'â™”',sq:[7,7],c:'w'}, ], targetCapture:null, solution:[{from:[2,0],to:[0,0]}], successMsg:'CHECKMATE! The King has nowhere to go! ğŸ‘‘ğŸ‰', hint:{ intro:'Checkmate means the King is attacked AND cannot escape.', steps:[ 'Move Queen from a6 to a8 â€” that\'s checkmate! âœ…' ] } },
  { id:6, icon:'ğŸ­', title:'Pin the Knight!', diff:'medium', mission:'Move your White Rook to pin the Black Knight against the Black King!', targetLabel:'Create a PIN on the Knight', pieces:[ {p:'â™–',sq:[4,0],c:'w'}, {p:'â™',sq:[4,4],c:'b'}, {p:'â™š',sq:[4,7],c:'b'}, {p:'â™”',sq:[7,0],c:'w'}, ], targetCapture:null, solution:[{from:[4,0],to:[4,3]}], successMsg:'You created a PIN! The Knight can\'t move! ğŸ“Œ', hint:{ intro:'A PIN exposes a valuable piece behind the target.', steps:[ 'Move Rook to d4 to create the pin! ğŸ“Œ' ] } },
  { id:7, icon:'âš¡', title:'Knight Fork: Queen & King!', diff:'medium', mission:'Move the White Knight to attack BOTH the Black Queen AND the Black King!', targetLabel:'Fork Queen â™› and King â™š', pieces:[ {p:'â™˜',sq:[5,2],c:'w'}, {p:'â™›',sq:[3,1],c:'b'}, {p:'â™š',sq:[3,5],c:'b'}, {p:'â™”',sq:[7,7],c:'w'}, ], targetCapture:null, solution:[{from:[5,2],to:[4,4]}], successMsg:'INCREDIBLE Fork! You win the Queen! âš¡ğŸ´', hint:{ intro:'A Fork attacks multiple pieces.', steps:[ 'Move the Knight to e4 to attack both simultaneously!' ] } },
  { id:8, icon:'ğŸŒŸ', title:'Pawn Promotion!', diff:'easy', mission:'Move your White Pawn to the last rank to PROMOTE it to a Queen!', targetLabel:'Promote Pawn on rank 8', pieces:[ {p:'â™™',sq:[1,4],c:'w'}, {p:'â™š',sq:[0,0],c:'b'}, {p:'â™”',sq:[7,7],c:'w'}, ], targetCapture:null, promotionSq:[0,4], solution:[{from:[1,4],to:[0,4]}], successMsg:'PROMOTION! Your little Pawn became a mighty Queen! ğŸŒŸâ™›', hint:{ intro:'Pawns promote on the opposite end.', steps:[ 'Move the Pawn one square forward to e8! ğŸŒŸ' ] } },
  { id:9, icon:'ğŸ”±', title:'Discovered Attack!', diff:'medium', mission:'Move the White Knight away to UNCOVER an attack by the White Bishop!', targetLabel:'Uncover Bishop attack on â™›', pieces:[ {p:'â™˜',sq:[4,4],c:'w'}, {p:'â™—',sq:[6,2],c:'w'}, {p:'â™›',sq:[2,6],c:'b'}, {p:'â™š',sq:[0,7],c:'b'}, {p:'â™”',sq:[7,7],c:'w'}, ], targetCapture:null, solution:[{from:[4,4],to:[2,3]}], successMsg:'Brilliant! REVEALED the Bishop\'s hidden attack! ğŸ”±', hint:{ intro:'Discovered Attack happens when moving unblocks a friendly piece.', steps:[ 'Move the Knight to d6. Then the Bishop fires at the Queen!' ] } },
  { id:10, icon:'ğŸ¹', title:'Skewer the King!', diff:'medium', mission:'Move the White Bishop to SKEWER the Black King, forcing it to move and exposing the Queen!', targetLabel:'Skewer King', pieces:[ {p:'â™—',sq:[5,0],c:'w'}, {p:'â™š',sq:[2,3],c:'b'}, {p:'â™›',sq:[0,5],c:'b'}, {p:'â™”',sq:[7,7],c:'w'}, ], targetCapture:null, solution:[{from:[5,0],to:[3,2]}], successMsg:'SKEWER! The King had to move and now the Bishop takes the Queen! ğŸ¹ğŸ’¥', hint:{ intro:'A Skewer attacks a big piece, exposing the one behind it.', steps:[ 'Move the Bishop to c5 to attack the King!' ] } },
  { id:11, icon:'ğŸ’', title:'Back Rank Checkmate!', diff:'medium', mission:'Use your Rook to deliver CHECKMATE on the back rank!', targetLabel:'Checkmate â™š on back rank', pieces:[ {p:'â™–',sq:[4,0],c:'w'}, {p:'â™š',sq:[0,6],c:'b'}, {p:'â™Ÿ',sq:[1,4],c:'b'}, {p:'â™Ÿ',sq:[1,5],c:'b'}, {p:'â™Ÿ',sq:[1,6],c:'b'}, {p:'â™”',sq:[7,0],c:'w'}, ], targetCapture:null, solution:[{from:[4,0],to:[0,0]}], successMsg:'BACK RANK CHECKMATE! A classic! ğŸ’ğŸ‘‘', hint:{ intro:'King locked by pawns.', steps:[ 'Move your Rook from a4 all the way to a8! ğŸ°' ] } },
  { id:12, icon:'ğŸª', title:'Double Check!', diff:'hard', mission:'Move the Knight to deliver CHECK â€” and reveal a DISCOVERED CHECK from the Rook!', targetLabel:'Give Double Check', pieces:[ {p:'â™˜',sq:[5,4],c:'w'}, {p:'â™–',sq:[5,0],c:'w'}, {p:'â™š',sq:[5,7],c:'b'}, {p:'â™”',sq:[7,6],c:'w'}, ], targetCapture:null, solution:[{from:[5,4],to:[3,5]}], successMsg:'DOUBLE CHECK! ğŸªâš¡', hint:{ intro:'Move Knight to attack the King AND reveal the Rook.', steps:[ 'Move Knight to f5!' ] } },
  { id:13, icon:'ğŸ¦', title:'Queen Takes All!', diff:'easy', mission:'Capture the Black Rook in ONE move!', targetLabel:'Capture Black Rook â™œ', pieces:[ {p:'â™•',sq:[7,0],c:'w'}, {p:'â™œ',sq:[0,0],c:'b'}, {p:'â™š',sq:[0,7],c:'b'}, {p:'â™”',sq:[7,7],c:'w'}, ], targetCapture:[0,0], solution:[{from:[7,0],to:[0,0]}], successMsg:'She flies across the whole board! ğŸ¦â™•', hint:{ intro:'Queens move anywhere.', steps:[ 'Slide from a1 to a8!' ] } },
  { id:14, icon:'ğŸ¯', title:'Rook Ladder Mate!', diff:'medium', mission:'Move the White Rook to give CHECKMATE to the cornered King!', targetLabel:'Checkmate â™š', pieces:[ {p:'â™–',sq:[1,0],c:'w'}, {p:'â™–',sq:[2,7],c:'w'}, {p:'â™š',sq:[0,7],c:'b'}, {p:'â™”',sq:[7,0],c:'w'}, ], targetCapture:null, solution:[{from:[1,0],to:[0,0]}], successMsg:'Ladder Checkmate! ğŸ¯', hint:{ intro:'Push the King to the corner.', steps:[ 'Move Ra7 to a8! ğŸ°ğŸ°' ] } },
  { id:15, icon:'ğŸ”®', title:'Bishop Pair Attack!', diff:'medium', mission:'Move the White Bishop to capture the unprotected Black Knight!', targetLabel:'Capture Black Knight â™', pieces:[ {p:'â™—',sq:[7,0],c:'w'}, {p:'â™—',sq:[6,1],c:'w'}, {p:'â™',sq:[4,4],c:'b'}, {p:'â™š',sq:[0,7],c:'b'}, {p:'â™”',sq:[7,7],c:'w'}, ], targetCapture:[4,4], solution:[{from:[7,0],to:[4,3]}], successMsg:'Great capture! ğŸ”®', hint:{ intro:'Look for free pieces.', steps:[ 'Find the diagonal to e4.' ] } },
  { id:16, icon:'ğŸ’¥', title:'Knight Sacrifice!', diff:'hard', mission:'Sacrifice your Knight to OPEN the defenses, then Queen mates!', targetLabel:'Sac Knight â™', pieces:[ {p:'â™˜',sq:[2,4],c:'w'}, {p:'â™•',sq:[2,7],c:'w'}, {p:'â™š',sq:[0,6],c:'b'}, {p:'â™Ÿ',sq:[1,5],c:'b'}, {p:'â™Ÿ',sq:[1,6],c:'b'}, {p:'â™”',sq:[7,0],c:'w'}, ], targetCapture:[1,5], solution:[{from:[2,4],to:[1,5]}], successMsg:'Brilliant sacrifice! ğŸ’¥ğŸ©', hint:{ intro:'Give up a piece to win.', steps:[ 'Capture the f7 pawn with your Knight.' ] } },
  { id:17, icon:'ğŸŒŠ', title:'Rook vs Pawn Race!', diff:'easy', mission:'Use your Rook to STOP the Black pawn from promoting!', targetLabel:'Capture Black Pawn â™Ÿ', pieces:[ {p:'â™–',sq:[7,0],c:'w'}, {p:'â™Ÿ',sq:[1,3],c:'b'}, {p:'â™š',sq:[0,4],c:'b'}, {p:'â™”',sq:[7,7],c:'w'}, ], targetCapture:[1,3], solution:[{from:[7,0],to:[1,0]}], successMsg:'You stopped it! ğŸŒŠğŸƒ', hint:{ intro:'Move fast.', steps:[ 'Move the Rook to the d-file to capture!' ] } },
  { id:18, icon:'ğŸ§©', title:'Queen & Rook Battery!', diff:'medium', mission:'Stack your Queen and Rook to create a BATTERY!', targetLabel:'Create battery', pieces:[ {p:'â™•',sq:[4,3],c:'w'}, {p:'â™–',sq:[7,3],c:'w'}, {p:'â™š',sq:[0,3],c:'b'}, {p:'â™Ÿ',sq:[1,2],c:'b'}, {p:'â™Ÿ',sq:[1,4],c:'b'}, {p:'â™”',sq:[7,7],c:'w'}, ], targetCapture:null, solution:[{from:[4,3],to:[1,3]}], successMsg:'Battery power! ğŸ§©ğŸ”‹', hint:{ intro:'Line them up.', steps:[ 'Move Queen to d7!' ] } },
  { id:19, icon:'ğŸ‘»', title:'Ghost Knight Fork!', diff:'hard', mission:'Triple fork the Black Queen, Rook AND King!', targetLabel:'Triple fork: â™› â™œ â™š', pieces:[ {p:'â™˜',sq:[6,5],c:'w'}, {p:'â™›',sq:[4,4],c:'b'}, {p:'â™œ',sq:[2,6],c:'b'}, {p:'â™š',sq:[4,2],c:'b'}, {p:'â™”',sq:[7,0],c:'w'}, ], targetCapture:null, solution:[{from:[6,5],to:[4,6]}], successMsg:'TRIPLE FORK! ğŸ‘»âš¡', hint:{ intro:'Find the perfect square.', steps:[ 'Move to d3! ğŸ´' ] } },
  { id:20, icon:'ğŸ†', title:'Legendary Smothered Mate!', diff:'hard', mission:'Use the Knight to deliver the legendary SMOTHERED MATE!', targetLabel:'Smothered Mate', pieces:[ {p:'â™˜',sq:[1,5],c:'w'}, {p:'â™•',sq:[0,5],c:'w'}, {p:'â™š',sq:[0,7],c:'b'}, {p:'â™œ',sq:[0,6],c:'b'}, {p:'â™Ÿ',sq:[1,7],c:'b'}, {p:'â™”',sq:[7,0],c:'w'}, ], targetCapture:null, solution:[{from:[1,5],to:[2,7]}], successMsg:'SMOTHERED MATE! You\'re a chess master! ğŸ†ğŸ‘‘', hint:{ intro:'The King is trapped.', steps:[ 'Move Nf7 to h8 for CHECKMATE! ğŸ†' ] } }
];

let currentChallenge = null;
let chalBoard = [];
let chalSelectedSq = null;
let solved = new Set();
let solutionStep = 0;

function initChallenges(){
  buildChallengeGrid();
  buildChalBoard();
  loadChallenge(CHALLENGES[0]);
}

function buildChallengeGrid(){
  const grid = document.getElementById('challengeGrid');
  grid.innerHTML = '';
  CHALLENGES.forEach(ch => {
    const el = document.createElement('div');
    el.className = 'ch-thumb' + (solved.has(ch.id)?' ch-solved':'');
    el.id = 'thumb'+ch.id;
    el.onclick = () => loadChallenge(ch);
    el.innerHTML = `<span class="th-icon">${ch.icon}</span><div class="th-num">#${ch.id}</div><div class="th-diff ${ch.diff}">${ch.diff}</div>`;
    grid.appendChild(el);
  });
}

function buildChalBoard(){
  const container = document.getElementById('chalBoardRows');
  container.innerHTML = '';
  for(let r=0;r<8;r++){
    const rowWrap = document.createElement('div');
    rowWrap.className = 'board-row-wrap';
    const lbl = document.createElement('div');
    lbl.className = 'board-rank-lbl';
    lbl.textContent = 8-r;
    rowWrap.appendChild(lbl);
    for(let c=0;c<8;c++){
      const sq = document.createElement('div');
      sq.className='csq '+((r+c)%2===0?'light':'dark');
      sq.id=`csq_${r}_${c}`;
      sq.onclick=()=>chalHandleClick(r,c);
      rowWrap.appendChild(sq);
    }
    container.appendChild(rowWrap);
  }
}

function renderChalBoard(){
  for(let r=0;r<8;r++) for(let c=0;c<8;c++){
    const sq=document.getElementById(`csq_${r}_${c}`);
    sq.textContent = chalBoard[r][c]||'';
  }
}

function loadChallenge(ch){
  currentChallenge = ch;
  solutionStep = 0;
  chalSelectedSq = null;
  document.querySelectorAll('.ch-thumb').forEach(t=>t.classList.remove('ch-active'));
  const thumb = document.getElementById('thumb'+ch.id);
  if(thumb){ thumb.classList.add('ch-active'); thumb.scrollIntoView({behavior:'smooth',block:'nearest'}); }

  chalBoard = Array.from({length:8},()=>Array(8).fill(''));
  ch.pieces.forEach(({p,sq})=>{ chalBoard[sq[0]][sq[1]]=p; });
  renderChalBoard();
  clearChalHighlights();

  if(ch.targetCapture){ document.getElementById(`csq_${ch.targetCapture[0]}_${ch.targetCapture[1]}`).classList.add('ctarget'); }

  document.getElementById('chalIcon').textContent = ch.icon;
  document.getElementById('chalTitle').textContent = ch.title;
  document.getElementById('chalDiff').textContent = ch.diff;
  document.getElementById('chalMission').textContent = ch.mission;
  document.getElementById('chalTargetTag').innerHTML = `<div class="target-tag">ğŸ¯ ${ch.targetLabel}</div>`;

  document.getElementById('hintContent').style.display='none';
  document.getElementById('hintHiddenMsg').style.display='block';
  document.getElementById('hintRevealBtn').textContent='Show Hint ğŸ‘';

  document.getElementById('chalResultBox').style.display='none';
  document.getElementById('chalNextBtn').style.display='none';
  document.getElementById('chalMovesLog').innerHTML='Waiting for your first moveâ€¦';
}

function revealHint(){
  if(!currentChallenge) return;
  document.getElementById('hintContent').style.display='block';
  document.getElementById('hintHiddenMsg').style.display='none';
  document.getElementById('hintRevealBtn').textContent='Hint shown ğŸ’¡';
  document.getElementById('hintIntro').textContent=currentChallenge.hint.intro;
  document.getElementById('hintSteps').innerHTML=currentChallenge.hint.steps.map((s,i)=>`<li data-n="${i+1}">${s}</li>`).join('');
}

function chalHandleClick(r,c){
  if(!currentChallenge) return;
  const piece=chalBoard[r][c];

  if(chalSelectedSq){
    const [sr,sc]=chalSelectedSq;
    const valid=getValidMoves(chalBoard, sr,sc);
    const isValid=valid.some(([vr,vc])=>vr===r&&vc===c);

    if(isValid){
      chalMakeMove(sr,sc,r,c);
      chalSelectedSq=null;
      renderChalBoard();
      clearChalHighlights();
    } else if(isW(piece)){
      chalSelectedSq=[r,c];
      renderChalBoard();
      clearChalHighlights();
      showChalHighlights(r,c);
    } else {
      chalSelectedSq=null;
      clearChalHighlights();
    }
  } else if(isW(piece)){
    chalSelectedSq=[r,c];
    clearChalHighlights();
    showChalHighlights(r,c);
  }
}

function chalMakeMove(sr,sc,r,c){
  const captured=chalBoard[r][c];
  const movingPiece=chalBoard[sr][sc];
  chalBoard[r][c]=movingPiece;
  chalBoard[sr][sc]='';

  const files='abcdefgh'; const ranks='87654321';
  const notation=`${files[sc]}${ranks[sr]}â†’${files[c]}${ranks[r]}${captured?'Ã—'+captured:''}`;
  const log=document.getElementById('chalMovesLog');
  log.innerHTML=(log.innerHTML==='Waiting for your first moveâ€¦'?'':log.innerHTML+' ')+'<span>'+notation+'</span>';

  if(movingPiece==='â™™'&&r===0){ chalBoard[r][c]='â™•'; }
  document.getElementById(`csq_${r}_${c}`).classList.add('cflash');
  setTimeout(()=>{ renderChalBoard(); checkSuccess(r,c,captured); },300);
}

function checkSuccess(r,c,captured){
  const ch=currentChallenge;
  let success=false;

  if(ch.targetCapture){ const [tr,tc]=ch.targetCapture; if(r===tr&&c===tc&&captured){ success=true; } }
  if(ch.promotionSq && r===ch.promotionSq[0]&&c===ch.promotionSq[1]){ success=true; }
  if(ch.solution && ch.solution.length>0){
    const sol=ch.solution[solutionStep];
    if(sol && r===sol.to[0]&&c===sol.to[1]){ solutionStep++; if(solutionStep>=ch.solution.length){ success=true; } }
  }

  if(success){ showSuccess(); }
}

function showSuccess(){
  solved.add(currentChallenge.id);
  const pct=Math.round((solved.size/CHALLENGES.length)*100);
  document.getElementById('chalFill').style.width=pct+'%';
  document.getElementById('chalProgressText').textContent=`${solved.size} of ${CHALLENGES.length} challenges solved`;
  buildChallengeGrid();

  const rb=document.getElementById('chalResultBox');
  rb.className='result-box rsuccess';
  rb.style.display='block';
  document.getElementById('chalResultEmoji').textContent='ğŸ‰';
  document.getElementById('chalResultTitle').textContent='Challenge Solved!';
  document.getElementById('chalResultMsg').textContent=currentChallenge.successMsg;
  document.getElementById('chalNextBtn').style.display='inline-block';
  launchConfetti();
}

function clearChalHighlights(){
  document.querySelectorAll('.csq').forEach(s=>{ s.classList.remove('csel','cvm','cvc','ctarget'); });
}

function showChalHighlights(r,c){
  document.getElementById(`csq_${r}_${c}`).classList.add('csel');
  getValidMoves(chalBoard, r,c).forEach(([mr,mc])=>{
    const sq=document.getElementById(`csq_${mr}_${mc}`);
    if(chalBoard[mr][mc]) sq.classList.add('cvc');
    else sq.classList.add('cvm');
  });
}

function resetChallenge(){ if(currentChallenge) loadChallenge(currentChallenge); }
function nextChallenge(){
  const idx=CHALLENGES.findIndex(c=>c.id===currentChallenge.id);
  loadChallenge(CHALLENGES[(idx+1)%CHALLENGES.length]);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARED MOVE GENERATOR 
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getValidMoves(board, r, c) {
  const p = board[r][c]; if (!p) return [];
  const moves = [];
  const friendly = isW(p)?isW:isB;
  const add = (nr,nc) => {
    if (nr<0||nr>7||nc<0||nc>7) return false;
    if (friendly(board[nr][nc])) return false;
    moves.push([nr,nc]); return !board[nr][nc];
  };
  const slide = (dr,dc) => {
    let nr=r+dr, nc=c+dc;
    while(nr>=0&&nr<8&&nc>=0&&nc<8){
      if(friendly(board[nr][nc])) break;
      moves.push([nr,nc]); if(board[nr][nc]) break;
      nr+=dr; nc+=dc;
    }
  };
  switch(p){
    case'â™™': if(r>0&&!board[r-1][c]){moves.push([r-1,c]);if(r===6&&!board[r-2][c])moves.push([r-2,c]);}if(r>0&&c>0&&isB(board[r-1][c-1]))moves.push([r-1,c-1]);if(r>0&&c<7&&isB(board[r-1][c+1]))moves.push([r-1,c+1]);break;
    case'â™Ÿ': if(r<7&&!board[r+1][c]){moves.push([r+1,c]);if(r===1&&!board[r+2][c])moves.push([r+2,c]);}if(r<7&&c>0&&isW(board[r+1][c-1]))moves.push([r+1,c-1]);if(r<7&&c<7&&isW(board[r+1][c+1]))moves.push([r+1,c+1]);break;
    case'â™˜':case'â™': [[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(([dr,dc])=>add(r+dr,c+dc)); break;
    case'â™—':case'â™': [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d=>slide(...d)); break;
    case'â™–':case'â™œ': [[-1,0],[1,0],[0,-1],[0,1]].forEach(d=>slide(...d)); break;
    case'â™•':case'â™›': [[-1,-1],[-1,1],[1,-1],[1,1],[-1,0],[1,0],[0,-1],[0,1]].forEach(d=>slide(...d)); break;
    case'â™”':case'â™š': [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(([dr,dc])=>add(r+dr,c+dc)); break;
  }
  return moves;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUIZ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const QUESTIONS = [
  { q:"Which piece can jump over other pieces?", opts:["Bishop","Rook","Knight","Queen"], ans:2, emoji:"ğŸ´", exp:"The Knight is the only piece that can jump over other pieces! It moves in an L-shape." },
  { q:"What is it called when the King cannot escape from attack?", opts:["Check","Stalemate","Checkmate","Fork"], ans:2, emoji:"ğŸ˜±", exp:"Checkmate! When the king is in check and has no escape, the game is over!" },
  { q:"How many points is the Queen worth?", opts:["5","7","9","3"], ans:2, emoji:"â™›", exp:"The Queen is worth 9 points â€” she's the most powerful piece on the board!" },
  { q:"What happens when you 'castle'?", opts:["Move queen across board","Move king 2 squares with rook","Capture a piece","Promote a pawn"], ans:1, emoji:"ğŸ°", exp:"Castling moves the king 2 squares and the rook jumps over it to safety!" },
  { q:"What is a 'fork' in chess?", opts:["Moving a piece backwards","Blocking a check","Attacking two pieces at once","A pawn promotion"], ans:2, emoji:"âš¡", exp:"A fork attacks two enemy pieces at the same time!" },
  { q:"Where is the best square for a Knight?", opts:["Corner","Edge of board","Center of board","Behind other pieces"], ans:2, emoji:"ğŸ¯", exp:"Knights in the center control up to 8 squares!" },
];
const QUIZ_BADGES = ['ğŸŒŸ','ğŸ†','âš¡','ğŸ¯','â™›','ğŸ§ '];
let qCurrent=0, qScore=0, qAnswered=false;

function quizStart() {
  qCurrent=0; qScore=0; qAnswered=false;
  document.getElementById('quizScore').textContent='0';
  document.getElementById('quizTotal').textContent='0';
  document.getElementById('earnedBadges').innerHTML='';
  showQuizQuestion();
}

function showQuizQuestion() {
  qAnswered=false;
  const q=QUESTIONS[qCurrent];
  document.getElementById('quizEmoji').textContent=q.emoji;
  document.getElementById('quizQNum').textContent=`Question ${qCurrent+1} of ${QUESTIONS.length}`;
  document.getElementById('quizQuestion').textContent=q.q;
  document.getElementById('quizFeedback').className='quiz-feedback';
  document.getElementById('quizNextBtn').style.display='none';
  document.getElementById('quizProgressFill').style.width=(qCurrent/QUESTIONS.length*100)+'%';
  const opts=document.getElementById('quizOptions');
  opts.innerHTML='';
  q.opts.forEach((opt,i)=>{
    const b=document.createElement('button');
    b.className='quiz-opt'; b.textContent=opt;
    b.onclick=()=>quizAnswer(i); opts.appendChild(b);
  });
}

function quizAnswer(idx) {
  if (qAnswered) return;
  qAnswered=true;
  const q=QUESTIONS[qCurrent];
  document.querySelectorAll('.quiz-opt')[q.ans].classList.add('correct');
  const fb=document.getElementById('quizFeedback');
  if (idx===q.ans) {
    qScore++;
    fb.textContent='ğŸ‰ Correct! '+q.exp;
    fb.className='quiz-feedback show qcorrect';
    const bd=document.getElementById('earnedBadges');
    const b=document.createElement('span'); b.className='badge'; b.textContent=QUIZ_BADGES[qCurrent];
    bd.appendChild(b);
    launchConfetti();
  } else {
    document.querySelectorAll('.quiz-opt')[idx].classList.add('wrong');
    fb.textContent='âŒ Not quite! '+q.exp;
    fb.className='quiz-feedback show qwrong';
  }
  document.getElementById('quizScore').textContent=qScore;
  if (qCurrent<QUESTIONS.length-1) {
    document.getElementById('quizNextBtn').style.display='inline-block';
  } else {
    document.getElementById('quizProgressFill').style.width='100%';
    document.getElementById('quizRestartBtn').style.display='inline-block';
  }
}

function quizNext() { qCurrent++; showQuizQuestion(); }
function quizRestart() { quizStart(); }

function launchConfetti() {
  const wrap=document.getElementById('confettiWrap');
  wrap.innerHTML='';
  const cols=['#ffd700','#ff5252','#00e676','#40c4ff','#e040fb','#ff9100','#fff'];
  for(let i=0;i<55;i++){
    const el=document.createElement('div');
    el.className='confetti-piece';
    el.style.cssText=`left:${Math.random()*100}%;top:-16px;background:${cols[Math.floor(Math.random()*cols.length)]};width:${6+Math.random()*9}px;height:${6+Math.random()*9}px;border-radius:${Math.random()>.5?'50%':'2px'};animation-delay:${Math.random()*.8}s;animation-duration:${1.5+Math.random()*1.4}s;`;
    wrap.appendChild(el);
  }
  setTimeout(()=>wrap.innerHTML='',3200);
}

</script>
</body>
</html>
