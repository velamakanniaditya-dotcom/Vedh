<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Kingdom ‚ôö</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@600;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #f59e0b; --secondary: #7c3aed;
  --success: #22c55e; --danger: #ef4444;
  --dark: #1c1917; --paper: #ffffff;
  --grid: #e2e8f0;
  --light-sq: #f0d9b5; --dark-sq: #b58863;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Nunito', sans-serif;
  background-color: #1c1917;
  background-image: linear-gradient(rgba(245,158,11,0.07) 1px, transparent 1px), linear-gradient(90deg, rgba(245,158,11,0.07) 1px, transparent 1px);
  background-size: 40px 40px;
  color: #1c1917; min-height: 100vh;
  display: flex; flex-direction: column; align-items: center;
  padding: 20px 14px 60px;
}
.home-btn {
  position: fixed; top: 16px; left: 16px;
  background: #1c1917; border: 3px solid var(--primary);
  color: var(--primary); padding: 8px 16px; border-radius: 50px;
  text-decoration: none; font-family: 'Fredoka One', cursive;
  font-size: 1rem; z-index: 300; box-shadow: 0 4px 0 #92400e;
}
.home-btn:active { transform: translateY(4px); box-shadow: none; }
header { text-align: center; margin-top: 44px; margin-bottom: 16px; }
header h1 {
  font-family: 'Fredoka One', cursive;
  font-size: clamp(2.2rem,7vw,3.4rem);
  color: var(--primary); line-height: 1;
  text-shadow: 3px 3px 0 rgba(0,0,0,0.5);
}
.subtitle { font-size: 1rem; font-weight: 800; color: #a8a29e; margin-top: 5px; }

/* SCREENS */
.screen { display:none; width:100%; max-width:680px; animation: popIn .35s cubic-bezier(.175,.885,.32,1.275); }
.screen.active { display:block; }
@keyframes popIn { 0%{opacity:0;transform:scale(.92) translateY(14px)} 100%{opacity:1;transform:scale(1) translateY(0)} }

/* CARD */
.card {
  background: var(--paper); border: 4px solid var(--dark);
  border-radius: 24px; padding: 22px 20px;
  box-shadow: 0 8px 0 rgba(0,0,0,.4); margin-bottom: 12px;
}

/* TABS */
.tab-row { display:flex; gap:5px; flex-wrap:wrap; justify-content:center; margin-bottom:16px; }
.tab-btn {
  font-family:'Fredoka One',cursive; font-size:.85rem;
  padding:7px 13px; border:3px solid var(--dark); border-radius:50px;
  background:#f8fafc; color:var(--dark); cursor:pointer;
  box-shadow:0 4px 0 var(--dark); transition:all .1s;
}
.tab-btn.active { background:var(--primary); color:#fff; border-color:var(--primary); box-shadow:0 0 0 #b45309; transform:translateY(4px); }
.section { display:none; }
.section.active { display:block; animation:popIn .3s ease; }

/* BUTTONS */
.btn { font-family:'Fredoka One',cursive; font-size:1.1rem; padding:12px 18px; border-radius:14px; cursor:pointer; border:3px solid var(--dark); box-shadow:0 5px 0 var(--dark); transition:all .1s; display:inline-block; text-align:center; }
.btn:active { transform:translateY(5px); box-shadow:0 0 0 var(--dark); }
.btn-full { width:100%; }
.btn-sm { font-size:.82rem; padding:7px 12px; border-radius:10px; box-shadow:0 4px 0 var(--dark); }
.btn-sm:active { transform:translateY(4px); box-shadow:0 0 0 var(--dark); }
.btn-gold   { background:var(--primary); color:#fff; border-color:#b45309; box-shadow:0 5px 0 #b45309; }
.btn-gold:active { box-shadow:0 0 0 #b45309; }
.btn-green  { background:var(--success); color:#fff; border-color:#15803d; box-shadow:0 5px 0 #15803d; }
.btn-green:active { box-shadow:0 0 0 #15803d; }
.btn-purple { background:var(--secondary); color:#fff; border-color:#4c1d95; box-shadow:0 5px 0 #4c1d95; }
.btn-purple:active { box-shadow:0 0 0 #4c1d95; }
.btn-red    { background:var(--danger); color:#fff; border-color:#b91c1c; box-shadow:0 5px 0 #b91c1c; }
.btn-red:active { box-shadow:0 0 0 #b91c1c; }

/* TAGS */
.tag { display:inline-block; font-size:.65rem; font-weight:900; padding:2px 9px; border-radius:20px; text-transform:uppercase; letter-spacing:.04em; }
.tag-begin  { background:#dbeafe; color:#1e40af; border:2px solid #3b82f6; }
.tag-inter  { background:#f3e8ff; color:#6b21a8; border:2px solid #a855f7; }
.tag-adv    { background:#fee2e2; color:#991b1b; border:2px solid #ef4444; }
.tag-easy   { background:#dcfce7; color:#166534; border:2px solid #16a34a; }
.tag-medium { background:#fef3c7; color:#92400e; border:2px solid #f59e0b; }
.tag-hard   { background:#fee2e2; color:#991b1b; border:2px solid #ef4444; }

/* ‚îÄ‚îÄ PIECES ‚îÄ‚îÄ */
.pieces-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:9px; margin-bottom:14px; }
.piece-btn {
  background:#f8fafc; border:3px solid var(--dark); border-radius:14px;
  padding:14px 6px; text-align:center; cursor:pointer;
  box-shadow:0 5px 0 var(--dark); transition:all .1s;
}
.piece-btn:active,.piece-btn.sel { transform:translateY(5px); box-shadow:0 0 0 var(--dark); background:#fef3c7; border-color:var(--primary); }
.piece-icon { font-size:2.4rem; display:block; }
.piece-name { font-family:'Fredoka One',cursive; font-size:.95rem; color:var(--dark); margin-top:3px; }
.piece-sub  { font-size:.68rem; color:#64748b; font-weight:800; }
.piece-info-box { background:#fef3c7; border:3px solid var(--primary); border-radius:14px; padding:16px; display:none; margin-bottom:14px; }
.piece-info-box.show { display:block; animation:popIn .3s ease; }
.piece-info-box h3 { font-family:'Fredoka One',cursive; font-size:1.2rem; color:var(--dark); margin-bottom:6px; }
.piece-info-box .moves { font-size:.8rem; background:#1e293b; color:#7dd3fc; padding:4px 10px; border-radius:8px; display:inline-block; margin-bottom:8px; font-family:monospace; }
.piece-info-box p { font-size:.88rem; color:#44403c; line-height:1.6; margin-bottom:5px; font-weight:700; }
.values-row { display:flex; flex-wrap:wrap; gap:7px; margin-top:12px; }
.val-chip { text-align:center; background:#f8fafc; border:2px solid var(--dark); border-radius:10px; padding:9px 12px; min-width:60px; box-shadow:0 3px 0 var(--dark); }
.val-chip .vi { font-size:1.7rem; }
.val-chip .vn { font-family:'Fredoka One',cursive; font-size:.7rem; color:var(--dark); }
.val-chip .vp { font-size:.9rem; font-weight:900; color:var(--secondary); }

/* ‚îÄ‚îÄ PRACTICE ‚îÄ‚îÄ */
.board-wrap { display:flex; flex-wrap:wrap; gap:16px; align-items:flex-start; justify-content:center; }
.chessboard { display:grid; grid-template-columns:repeat(8,1fr); border:4px solid var(--dark); border-radius:6px; overflow:hidden; box-shadow:0 7px 0 rgba(0,0,0,.3); flex-shrink:0; }
.sq { width:50px; height:50px; display:flex; align-items:center; justify-content:center; font-size:1.7rem; cursor:pointer; position:relative; user-select:none; transition:filter .12s; }
.sq.light { background:var(--light-sq); } .sq.dark { background:var(--dark-sq); }
.sq.sel { background:#f6f669 !important; }
.sq.valid::after { content:''; position:absolute; width:34%; height:34%; border-radius:50%; background:rgba(0,0,0,.22); pointer-events:none; }
.sq.capture::after { content:''; position:absolute; inset:2px; border-radius:50%; border:4px solid rgba(0,0,0,.3); pointer-events:none; }
.sq:hover { filter:brightness(1.08); }
@media(max-width:500px){ .sq{width:40px;height:40px;font-size:1.3rem;} .chessboard{grid-template-columns:repeat(8,40px);} }
.board-side { flex:1; min-width:170px; }
.board-side h3 { font-family:'Fredoka One',cursive; font-size:1rem; color:var(--dark); margin-bottom:5px; }
.board-msg { background:#fef3c7; border:3px solid var(--primary); border-radius:10px; padding:9px 12px; font-weight:800; color:#78350f; font-size:.85rem; margin-bottom:8px; }
.turn-box { font-family:'Fredoka One',cursive; font-size:1rem; margin-bottom:8px; color:var(--dark); }
.cap-box  { font-size:1rem; color:#44403c; font-weight:700; min-height:22px; }
.pboard-btns { display:flex; flex-wrap:wrap; gap:5px; margin-top:9px; }

/* ‚îÄ‚îÄ OPENINGS ‚îÄ‚îÄ */
.opening-item { background:#f8fafc; border:3px solid var(--dark); border-radius:14px; padding:12px 14px; margin-bottom:9px; display:flex; gap:12px; align-items:flex-start; box-shadow:0 4px 0 var(--dark); }
.op-icon { font-size:2.2rem; flex-shrink:0; line-height:1; }
.op-content h3 { font-family:'Fredoka One',cursive; font-size:1rem; color:var(--dark); }
.moves-chip { font-family:monospace; font-size:.78rem; background:#1e293b; color:#7dd3fc; padding:2px 9px; border-radius:7px; display:inline-block; margin:3px 0; }
.op-content p { font-size:.82rem; color:#475569; font-weight:700; line-height:1.5; }
.rules-list { list-style:none; margin-top:10px; }
.rules-list li { font-size:.9rem; font-weight:700; color:#334155; padding:9px 0; border-bottom:2px solid #f1f5f9; display:flex; gap:9px; align-items:flex-start; line-height:1.5; }
.rules-list li:last-child { border-bottom:none; }
.rule-num { font-family:'Fredoka One',cursive; font-size:1rem; color:var(--primary); flex-shrink:0; width:22px; }

/* ‚îÄ‚îÄ MINI BOARD (strategies/tricks) ‚îÄ‚îÄ */
.strat-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(270px,1fr)); gap:10px; }
.strat-card { background:#f8fafc; border:3px solid var(--dark); border-radius:16px; padding:14px; box-shadow:0 5px 0 var(--dark); }
.strat-card h3 { font-family:'Fredoka One',cursive; font-size:1rem; color:var(--dark); margin-bottom:3px; }
.strat-card p  { font-size:.8rem; color:#475569; font-weight:700; line-height:1.5; margin-bottom:9px; }
.mini-board-wrap { position:relative; display:inline-block; }
.mini-board { display:grid; grid-template-columns:repeat(8,28px); border:3px solid var(--dark); border-radius:5px; overflow:hidden; box-shadow:0 4px 0 rgba(0,0,0,.2); }
.msq { width:28px; height:28px; display:flex; align-items:center; justify-content:center; font-size:.95rem; position:relative; }
.msq.light { background:var(--light-sq); } .msq.dark { background:var(--dark-sq); }
.msq.mhl   { background:rgba(246,246,105,.9) !important; }
.msq.matt  { background:rgba(220,50,50,.4) !important; }
.msq.mpath { background:rgba(34,197,94,.35) !important; }
.msq.mfrom { opacity:.3; }
.float-piece { position:absolute; display:flex; align-items:center; justify-content:center; pointer-events:none; z-index:20; transition:left .6s cubic-bezier(.4,0,.2,1), top .6s cubic-bezier(.4,0,.2,1); }
.anim-row { display:flex; align-items:center; gap:7px; margin-top:7px; flex-wrap:wrap; }
.anim-lbl { font-size:.72rem; color:#64748b; font-weight:700; font-style:italic; flex:1; min-width:90px; }

/* ‚îÄ‚îÄ CHALLENGES ‚îÄ‚îÄ */
.prog-bar-bg { background:#e2e8f0; border:2px solid var(--dark); border-radius:20px; height:12px; overflow:hidden; }
.prog-bar-fill { height:100%; background:linear-gradient(90deg,var(--success),var(--primary)); border-radius:20px; transition:width .5s ease; }
.prog-label { text-align:center; font-size:.75rem; font-weight:800; color:#64748b; margin:4px 0 12px; }
.chal-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(68px,1fr)); gap:6px; margin-bottom:16px; }
.cth { background:#f8fafc; border:3px solid var(--dark); border-radius:11px; padding:8px 4px; text-align:center; cursor:pointer; box-shadow:0 4px 0 var(--dark); transition:all .1s; position:relative; }
.cth:active { transform:translateY(4px); box-shadow:0 0 0 var(--dark); }
.cth.cur  { background:#fef3c7; border-color:var(--primary); }
.cth.done { background:#dcfce7; border-color:var(--success); }
.cth.done::after { content:'‚úì'; position:absolute; top:1px; right:4px; color:#16a34a; font-weight:900; font-size:.7rem; }
.cth .ci { font-size:1.2rem; display:block; }
.cth .cn { font-family:'Fredoka One',cursive; font-size:.6rem; color:var(--dark); }
.chal-layout { display:grid; grid-template-columns:auto 1fr; gap:14px; align-items:start; }
@media(max-width:580px){ .chal-layout { grid-template-columns:1fr; } }
.col-lbl { display:flex; padding-left:0; margin-bottom:2px; }
.col-lbl span { width:50px; text-align:center; font-family:'Fredoka One',cursive; font-size:.62rem; color:#94a3b8; }
.row-lbl { width:16px; font-family:'Fredoka One',cursive; font-size:.62rem; color:#94a3b8; text-align:right; line-height:50px; margin-right:2px; }
.row-lbl-wrap { display:flex; }
.chal-board { display:grid; grid-template-columns:repeat(8,50px); border:4px solid var(--dark); border-radius:7px; overflow:hidden; box-shadow:0 6px 0 rgba(0,0,0,.25); }
.csq { width:50px; height:50px; display:flex; align-items:center; justify-content:center; font-size:1.7rem; cursor:pointer; position:relative; user-select:none; transition:filter .12s; }
.csq.light { background:var(--light-sq); } .csq.dark { background:var(--dark-sq); }
.csq.csel  { background:#f6f669 !important; outline:3px solid #d97706; outline-offset:-2px; }
.csq.cvm::after { content:''; position:absolute; width:34%; height:34%; border-radius:50%; background:rgba(0,0,0,.2); pointer-events:none; }
.csq.cvc::after { content:''; position:absolute; inset:2px; border-radius:50%; border:4px solid rgba(0,0,0,.28); pointer-events:none; }
.csq.ctgt { animation:tgtPulse .9s ease-in-out infinite; }
@keyframes tgtPulse { 0%,100%{box-shadow:inset 0 0 0 3px rgba(245,158,11,.8);}50%{box-shadow:inset 0 0 0 3px rgba(239,68,68,1),inset 0 0 10px rgba(239,68,68,.4);} }
.csq:hover { filter:brightness(1.08); }
@media(max-width:480px){ .chal-board{grid-template-columns:repeat(8,40px);} .csq{width:40px;height:40px;font-size:1.3rem;} .col-lbl span{width:40px;} .row-lbl{line-height:40px;} }
.chal-side .info-block { background:#f8fafc; border:3px solid var(--dark); border-radius:14px; padding:12px 14px; margin-bottom:9px; box-shadow:0 4px 0 var(--dark); }
.chal-side .info-block h3 { font-family:'Fredoka One',cursive; font-size:.95rem; color:var(--dark); margin-bottom:5px; }
.chal-side .info-block p  { font-size:.82rem; color:#475569; font-weight:700; line-height:1.5; }
.mission-block { border-color:var(--success)!important; background:#f0fdf4!important; }
.mission-block h3 { color:#15803d!important; }
.hint-block { border-color:var(--primary)!important; background:#fef3c7!important; }
.hint-block h3 { color:#92400e!important; }
.hint-steps { list-style:none; margin-top:5px; }
.hint-steps li { font-size:.78rem; color:#44403c; font-weight:700; padding:4px 0 4px 20px; position:relative; border-bottom:1px solid rgba(0,0,0,.05); line-height:1.5; }
.hint-steps li::before { content:attr(data-n); position:absolute; left:0; color:var(--primary); font-weight:900; }
.result-block { background:#f0fdf4; border:3px solid var(--success); border-radius:14px; padding:14px; text-align:center; display:none; animation:popIn .35s ease; box-shadow:0 4px 0 #16a34a; margin-bottom:9px; }
.result-block.show { display:block; }
.result-block .re { font-size:2.4rem; }
.result-block h3 { font-family:'Fredoka One',cursive; font-size:1.2rem; color:var(--dark); margin:5px 0 3px; }
.result-block p  { font-size:.82rem; color:#475569; font-weight:700; }
.moves-log { background:#1e293b; border-radius:10px; padding:9px 11px; font-size:.74rem; color:#7dd3fc; font-weight:700; min-height:28px; font-family:monospace; line-height:1.7; word-break:break-all; }

/* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
.qscore-bar { text-align:center; font-family:'Fredoka One',cursive; font-size:1.2rem; color:var(--dark); }
.qprog-bg { background:#e2e8f0; border:2px solid var(--dark); border-radius:20px; height:9px; overflow:hidden; max-width:280px; margin:5px auto 14px; }
.qprog-fill { height:100%; background:linear-gradient(90deg,var(--success),var(--primary)); border-radius:20px; transition:width .4s; }
.quiz-emoji { font-size:2.8rem; text-align:center; margin-bottom:6px; }
.qnum { font-family:'Fredoka One',cursive; font-size:1.4rem; color:var(--dark); text-align:center; margin-bottom:9px; }
.qtext { font-size:.98rem; color:#334155; font-weight:800; margin-bottom:16px; line-height:1.6; text-align:center; }
.quiz-opts { display:grid; grid-template-columns:1fr 1fr; gap:9px; margin-bottom:14px; }
.qopt { font-family:'Fredoka One',cursive; font-size:1rem; background:#f8fafc; border:3px solid var(--dark); color:var(--dark); border-radius:12px; padding:12px; cursor:pointer; box-shadow:0 5px 0 var(--dark); transition:all .1s; }
.qopt:active { transform:translateY(5px); box-shadow:0 0 0 var(--dark); }
.qopt.correct { background:var(--success); color:#fff; border-color:#15803d; box-shadow:0 5px 0 #15803d; }
.qopt.wrong   { background:var(--danger);  color:#fff; border-color:#b91c1c; box-shadow:0 5px 0 #b91c1c; }
.qfb { border-radius:10px; padding:10px 12px; font-weight:800; font-size:.88rem; display:none; margin-bottom:10px; }
.qfb.show { display:block; animation:popIn .3s; }
.qfb.ok  { background:#dcfce7; border:2px solid var(--success); color:#166534; }
.qfb.bad { background:#fee2e2; border:2px solid var(--danger);  color:#991b1b; }
.badges-row { display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-top:10px; }
.badge { font-size:1.7rem; animation:popIn .4s ease; }
@media(max-width:400px){ .quiz-opts{grid-template-columns:1fr;} }

/* confetti */
.confetti-wrap { position:fixed; inset:0; pointer-events:none; z-index:999; }
.cp { position:absolute; border-radius:2px; animation:cpFall 1.8s ease-in forwards; }
@keyframes cpFall { 0%{transform:translateY(-40px) rotate(0);opacity:1} 100%{transform:translateY(105vh) rotate(720deg);opacity:0} }
</style>
</head>
<body>
<a href="index.html" class="home-btn">üè† Home</a>
<header>
  <h1>‚ôö Chess Kingdom</h1>
  <div class="subtitle">Learn ‚Ä¢ Practice ‚Ä¢ Puzzle ‚Ä¢ Master!</div>
</header>
<div style="max-width:700px;width:100%;margin-bottom:10px;">
  <a href="chess-coach.html" style="display:flex;align-items:center;justify-content:space-between;gap:14px;background:#7c3aed;border:4px solid #4c1d95;border-radius:18px;padding:14px 20px;text-decoration:none;box-shadow:0 6px 0 #4c1d95;transition:all .1s;">
    <div style="display:flex;align-items:center;gap:12px;">
      <span style="font-size:2.2rem;">ü¶Å</span>
      <div>
        <div style="font-family:'Fredoka One',cursive;font-size:1.2rem;color:#fff;">Play vs King Leo!</div>
        <div style="font-size:.78rem;font-weight:800;color:#c4b5fd;">Interactive coaching game ‚Äî safety dots, hints & AI explanations!</div>
      </div>
    </div>
    <div style="font-family:'Fredoka One',cursive;font-size:1rem;color:#fff;background:#4c1d95;padding:8px 14px;border-radius:12px;white-space:nowrap;">Play Now ‚ñ∂</div>
  </a>
</div>
<div class="screen active" id="mainScreen" style="max-width:700px;">
<div class="card">
  <div class="tab-row">
    <button class="tab-btn active" onclick="showTab('pieces',this)">‚ôü Pieces</button>
    <button class="tab-btn" onclick="showTab('practice',this)">üéÆ Practice</button>
    <button class="tab-btn" onclick="showTab('openings',this)">üìñ Openings</button>
    <button class="tab-btn" onclick="showTab('strategies',this)">üß† Strategy</button>
    <button class="tab-btn" onclick="showTab('tricks',this)">‚ö° Tricks</button>
    <button class="tab-btn" onclick="showTab('challenges',this)">üèÜ Puzzles</button>
    <button class="tab-btn" onclick="showTab('quiz',this)">‚ùì Quiz</button>
  </div>

  <!-- PIECES -->
  <div class="section active" id="sec-pieces">
    <div class="pieces-grid">
      <div class="piece-btn" onclick="showPiece('king')"><span class="piece-icon">‚ôö</span><div class="piece-name">King</div><div class="piece-sub">Most important</div></div>
      <div class="piece-btn" onclick="showPiece('queen')"><span class="piece-icon">‚ôõ</span><div class="piece-name">Queen</div><div class="piece-sub">Most powerful</div></div>
      <div class="piece-btn" onclick="showPiece('rook')"><span class="piece-icon">‚ôú</span><div class="piece-name">Rook</div><div class="piece-sub">Castle warrior</div></div>
      <div class="piece-btn" onclick="showPiece('bishop')"><span class="piece-icon">‚ôù</span><div class="piece-name">Bishop</div><div class="piece-sub">Diagonal master</div></div>
      <div class="piece-btn" onclick="showPiece('knight')"><span class="piece-icon">‚ôû</span><div class="piece-name">Knight</div><div class="piece-sub">L-shape jumper</div></div>
      <div class="piece-btn" onclick="showPiece('pawn')"><span class="piece-icon">‚ôü</span><div class="piece-name">Pawn</div><div class="piece-sub">Little hero</div></div>
    </div>
    <div class="piece-info-box" id="pieceInfo">
      <h3 id="piName"></h3>
      <div class="moves" id="piMoves"></div>
      <p id="piDesc"></p>
      <p id="piTip"></p>
    </div>
    <div style="font-family:'Fredoka One',cursive;font-size:1rem;color:var(--dark);margin-top:14px;margin-bottom:9px;">‚öñÔ∏è Piece Values</div>
    <div class="values-row">
      <div class="val-chip"><div class="vi">‚ôü</div><div class="vn">Pawn</div><div class="vp">1pt</div></div>
      <div class="val-chip"><div class="vi">‚ôû</div><div class="vn">Knight</div><div class="vp">3pt</div></div>
      <div class="val-chip"><div class="vi">‚ôù</div><div class="vn">Bishop</div><div class="vp">3pt</div></div>
      <div class="val-chip"><div class="vi">‚ôú</div><div class="vn">Rook</div><div class="vp">5pt</div></div>
      <div class="val-chip"><div class="vi">‚ôõ</div><div class="vn">Queen</div><div class="vp">9pt</div></div>
    </div>
  </div>

  <!-- PRACTICE -->
  <div class="section" id="sec-practice">
    <div class="board-wrap">
      <div>
        <div class="chessboard" id="practiceBoard"></div>
        <div class="pboard-btns">
          <button class="btn btn-sm btn-gold" onclick="resetPractice()">üîÑ Reset</button>
          <button class="btn btn-sm btn-purple" onclick="practiceSetup('scholars')">‚ö° Scholar's Mate</button>
          <button class="btn btn-sm" style="background:#0ea5e9;color:#fff;border-color:#0369a1;box-shadow:0 4px 0 #0369a1;" onclick="practiceSetup('castling')">üè∞ Castling</button>
        </div>
      </div>
      <div class="board-side">
        <h3>How to Play</h3>
        <p style="font-size:.82rem;color:#475569;font-weight:700;margin-bottom:9px;">üëÜ Click a piece, then click a green dot to move it!</p>
        <div class="board-msg" id="practiceMsg">Click any White piece to begin!</div>
        <div class="turn-box" id="practiceTurn">‚¨ú White's turn</div>
        <div class="cap-box" id="capW"></div>
        <div class="cap-box" id="capB"></div>
      </div>
    </div>
  </div>

  <!-- OPENINGS -->
  <div class="section" id="sec-openings">
    <div class="opening-item"><div class="op-icon">üèπ</div><div class="op-content"><h3>Italian Game <span class="tag tag-begin">Beginner</span></h3><div class="moves-chip">1.e4 e5 2.Nf3 Nc6 3.Bc4</div><p>One of the oldest openings! White attacks f7. Control the center and develop your pieces fast.</p></div></div>
    <div class="opening-item"><div class="op-icon">üõ°Ô∏è</div><div class="op-content"><h3>Sicilian Defence <span class="tag tag-inter">Intermediate</span></h3><div class="moves-chip">1.e4 c5</div><p>The most popular opening ever! Black fights back without mirroring ‚Äî creates exciting unbalanced games.</p></div></div>
    <div class="opening-item"><div class="op-icon">üå≤</div><div class="op-content"><h3>London System <span class="tag tag-begin">Beginner</span></h3><div class="moves-chip">1.d4 d5 2.Bf4 Nf6 3.e3</div><p>Solid and reliable for White. Build a strong pawn structure without memorising lots of theory!</p></div></div>
    <div class="opening-item"><div class="op-icon">ü¶Ö</div><div class="op-content"><h3>King's Indian <span class="tag tag-inter">Intermediate</span></h3><div class="moves-chip">1.d4 Nf6 2.c4 g6 3.Nc3 Bg7</div><p>Black lets White take the center then counterattacks fiercely! Loved by aggressive players.</p></div></div>
    <div class="opening-item"><div class="op-icon">üî•</div><div class="op-content"><h3>King's Gambit <span class="tag tag-inter">Intermediate</span></h3><div class="moves-chip">1.e4 e5 2.f4</div><p>White sacrifices a pawn for blazing fast development and a fierce attack!</p></div></div>
    <div class="opening-item"><div class="op-icon">üé≠</div><div class="op-content"><h3>French Defence <span class="tag tag-begin">Beginner</span></h3><div class="moves-chip">1.e4 e6 2.d4 d5</div><p>Black builds a solid pawn wall. Great for patient players who like to defend and counterattack.</p></div></div>
    <div style="font-family:'Fredoka One',cursive;font-size:1rem;color:var(--dark);margin-top:12px;margin-bottom:8px;">üåü Golden Opening Rules</div>
    <ul class="rules-list">
      <li><span class="rule-num">1.</span>Control the center ‚Äî e4, d4, e5, d5 are the most important squares!</li>
      <li><span class="rule-num">2.</span>Develop your pieces ‚Äî get knights and bishops out early!</li>
      <li><span class="rule-num">3.</span>Castle your king to safety ‚Äî don't leave it in the center!</li>
      <li><span class="rule-num">4.</span>Don't move the same piece twice in the opening!</li>
      <li><span class="rule-num">5.</span>Connect your rooks ‚Äî clear the back rank!</li>
    </ul>
  </div>

  <!-- STRATEGIES -->
  <div class="section" id="sec-strategies">
    <div class="strat-grid" id="stratGrid"></div>
  </div>

  <!-- TRICKS -->
  <div class="section" id="sec-tricks">
    <div class="strat-grid" id="tricksGrid"></div>
  </div>

  <!-- CHALLENGES -->
  <div class="section" id="sec-challenges">
    <div class="prog-bar-bg"><div class="prog-bar-fill" id="chalFill" style="width:0%"></div></div>
    <div class="prog-label" id="chalLabel">0 of 20 puzzles solved</div>
    <div class="chal-grid" id="chalGrid"></div>
    <div class="chal-layout">
      <div>
        <div class="col-lbl" id="colLbls"><span>a</span><span>b</span><span>c</span><span>d</span><span>e</span><span>f</span><span>g</span><span>h</span></div>
        <div id="chalBoardWrap"></div>
      </div>
      <div class="chal-side">
        <div class="info-block" style="display:flex;gap:10px;align-items:center;">
          <div style="font-size:2.2rem;" id="chalIcon">‚ôü</div>
          <div>
            <div style="font-family:'Fredoka One',cursive;font-size:1rem;color:var(--dark);" id="chalTitle">Pick a puzzle!</div>
            <span id="chalDiffTag" class="tag tag-easy">Easy</span>
          </div>
        </div>
        <div class="info-block mission-block">
          <h3>üéØ Mission</h3>
          <p id="chalMission">Choose a puzzle from the grid above to start!</p>
        </div>
        <div class="info-block hint-block">
          <h3>üí° Hint <button onclick="showHint()" style="font-family:'Nunito',sans-serif;font-size:.7rem;font-weight:900;background:rgba(245,158,11,.2);border:2px solid var(--primary);color:#92400e;padding:2px 9px;border-radius:20px;cursor:pointer;margin-left:5px;">Show üëÅ</button></h3>
          <div id="hintBody" style="display:none;">
            <p id="hintIntro" style="font-size:.78rem;color:#78350f;font-weight:700;line-height:1.5;margin-bottom:4px;"></p>
            <ul class="hint-steps" id="hintSteps"></ul>
          </div>
          <p id="hintHide" style="font-size:.78rem;color:#92400e;font-weight:700;">Click Show if you're stuck!</p>
        </div>
        <div style="display:flex;gap:7px;margin-bottom:9px;flex-wrap:wrap;">
          <button class="btn btn-sm" onclick="resetChal()" style="background:#e2e8f0;border-color:#94a3b8;box-shadow:0 4px 0 #94a3b8;color:#334155;">üîÑ Reset</button>
          <button class="btn btn-sm btn-green" id="nextBtn" onclick="nextChal()" style="display:none;">Next ‚û°Ô∏è</button>
        </div>
        <div class="result-block" id="resultBlock">
          <div class="re" id="resEmoji">üéâ</div>
          <h3 id="resTitle">Solved!</h3>
          <p id="resMsg"></p>
        </div>
        <div class="moves-log" id="movesLog">Make your first move‚Ä¶</div>
      </div>
    </div>
  </div>

  <!-- QUIZ -->
  <div class="section" id="sec-quiz">
    <div class="qscore-bar">‚≠ê Score: <span id="qScore">0</span> / <span id="qTotal">0</span></div>
    <div class="qprog-bg"><div class="qprog-fill" id="qBar" style="width:0%"></div></div>
    <div class="quiz-emoji" id="qEmoji">ü§î</div>
    <div class="qnum" id="qNum">Question 1 of 12</div>
    <div class="qtext" id="qText"></div>
    <div class="quiz-opts" id="qOpts"></div>
    <div class="qfb" id="qFB"></div>
    <div style="display:flex;gap:7px;flex-wrap:wrap;justify-content:center;">
      <button class="btn btn-gold" id="qNextBtn" onclick="quizNext()" style="display:none;">Next ‚û°Ô∏è</button>
      <button class="btn btn-green" id="qRestartBtn" onclick="quizStart()" style="display:none;">Play Again! üîÑ</button>
    </div>
    <div class="badges-row" id="badgesRow"></div>
  </div>

</div><!-- /card -->
</div><!-- /mainScreen -->
<div class="confetti-wrap" id="confettiWrap"></div>
<script>
'use strict';
/* ‚îÄ‚îÄ TAB NAV ‚îÄ‚îÄ */
const TAB_INIT = {};
function showTab(id, btn) {
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('sec-'+id).classList.add('active');
  if (!TAB_INIT[id]) { TAB_INIT[id]=true;
    if (id==='practice')   initPractice();
    if (id==='strategies') buildStrats();
    if (id==='tricks')     buildTricks();
    if (id==='challenges') initChallenges();
    if (id==='quiz')       quizStart();
  }
}

/* ‚îÄ‚îÄ PIECE INFO ‚îÄ‚îÄ */
const PINFO = {
  king:  {name:'üëë King ‚Äî The Royal Leader',moves:'‚Üë ‚Üó ‚Üí ‚Üò ‚Üì ‚Üô ‚Üê ‚Üñ  (one square, any direction)',desc:'The most important piece ‚Äî if your king is checkmated, you lose! Moves one square in any direction.',tip:'üí° Keep your king safe by castling early. In the endgame the king becomes a powerful fighter ‚Äî march it forward!'},
  queen: {name:'‚ôõ Queen ‚Äî The Mighty Warrior',moves:'Any distance in any direction (ranks, files, diagonals)',desc:'The most powerful piece on the board! She combines the rook and bishop, moving any number of squares in any direction.',tip:'üí° Don\'t bring her out too early ‚Äî she can be chased by smaller pieces, wasting precious development time!'},
  rook:  {name:'‚ôú Rook ‚Äî The Castle Tower',moves:'Any distance horizontally or vertically',desc:'Moves any number of squares in a straight line. Rooks love open files with no pawns blocking them.',tip:'üí° Connect your rooks by castling. Two rooks on the 7th rank are devastating and can often win the game alone!'},
  bishop:{name:'‚ôù Bishop ‚Äî The Diagonal Master',moves:'Any distance diagonally (stays on same colour)',desc:'Moves diagonally any number of squares ‚Äî always on the same colour. Loves long open diagonals with no pawns blocking.',tip:'üí° Don\'t trap your bishop behind your own pawns! An open diagonal makes a bishop as powerful as a rook.'},
  knight:{name:'‚ôû Knight ‚Äî The L-Shape Jumper',moves:'L-shape: 2 squares then 1 sideways (jumps over pieces!)',desc:'The ONLY piece that can jump over other pieces! Moves in an L-shape ‚Äî very tricky and unpredictable.',tip:'üí° A knight on the rim is dim! Keep knights near the center where they can control up to 8 squares at once.'},
  pawn:  {name:'‚ôü Pawn ‚Äî The Little Hero',moves:'‚Üë one square forward. First move can go 2. Captures diagonally!',desc:'Pawns move forward but capture diagonally. On first move can advance two squares. Reach the end and PROMOTE to a Queen! üéâ',tip:'üí° Passed pawns (no enemy pawns blocking them) are incredibly powerful. Push them forward to become queens!'}
};
function showPiece(p){
  const d=PINFO[p];
  document.getElementById('piName').textContent=d.name;
  document.getElementById('piMoves').textContent=d.moves;
  document.getElementById('piDesc').textContent=d.desc;
  document.getElementById('piTip').textContent=d.tip;
  const box=document.getElementById('pieceInfo');
  box.classList.add('show');
  box.scrollIntoView({behavior:'smooth',block:'nearest'});
  document.querySelectorAll('.piece-btn').forEach(b=>b.classList.remove('sel'));
  event.currentTarget.classList.add('sel');
}

/* ‚îÄ‚îÄ MOVE GENERATOR ‚îÄ‚îÄ */
const WP=['‚ôî','‚ôï','‚ôñ','‚ôó','‚ôò','‚ôô'];
const BP=['‚ôö','‚ôõ','‚ôú','‚ôù','‚ôû','‚ôü'];
const isW=p=>WP.includes(p), isB=p=>BP.includes(p);
function getMoves(board,r,c){
  const p=board[r][c]; if(!p) return [];
  const moves=[];
  const friendly=isW(p)?isW:isB, enemy=isW(p)?isB:isW;
  const add=(nr,nc)=>{
    if(nr<0||nr>7||nc<0||nc>7) return;
    if(friendly(board[nr][nc])) return;
    moves.push([nr,nc]);
  };
  const slide=(dr,dc)=>{
    let nr=r+dr,nc=c+dc;
    while(nr>=0&&nr<8&&nc>=0&&nc<8){
      if(friendly(board[nr][nc])) break;
      moves.push([nr,nc]); if(board[nr][nc]) break;
      nr+=dr; nc+=dc;
    }
  };
  switch(p){
    case'‚ôô':
      if(r>0&&!board[r-1][c]){moves.push([r-1,c]);if(r===6&&!board[r-2][c])moves.push([r-2,c]);}
      if(r>0&&c>0&&isB(board[r-1][c-1]))moves.push([r-1,c-1]);
      if(r>0&&c<7&&isB(board[r-1][c+1]))moves.push([r-1,c+1]); break;
    case'‚ôü':
      if(r<7&&!board[r+1][c]){moves.push([r+1,c]);if(r===1&&!board[r+2][c])moves.push([r+2,c]);}
      if(r<7&&c>0&&isW(board[r+1][c-1]))moves.push([r+1,c-1]);
      if(r<7&&c<7&&isW(board[r+1][c+1]))moves.push([r+1,c+1]); break;
    case'‚ôò':case'‚ôû':
      [[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(([dr,dc])=>add(r+dr,c+dc)); break;
    case'‚ôó':case'‚ôù': [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d=>slide(...d)); break;
    case'‚ôñ':case'‚ôú': [[-1,0],[1,0],[0,-1],[0,1]].forEach(d=>slide(...d)); break;
    case'‚ôï':case'‚ôõ': [[-1,-1],[-1,1],[1,-1],[1,1],[-1,0],[1,0],[0,-1],[0,1]].forEach(d=>slide(...d)); break;
    case'‚ôî':case'‚ôö': [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(([dr,dc])=>add(r+dr,c+dc)); break;
  }
  return moves;
}

/* ‚îÄ‚îÄ PRACTICE BOARD ‚îÄ‚îÄ */
const START_BOARD=[
  ['‚ôú','‚ôû','‚ôù','‚ôõ','‚ôö','‚ôù','‚ôû','‚ôú'],
  ['‚ôü','‚ôü','‚ôü','‚ôü','‚ôü','‚ôü','‚ôü','‚ôü'],
  ['','','','','','','',''],['','','','','','','',''],
  ['','','','','','','',''],['','','','','','','',''],
  ['‚ôô','‚ôô','‚ôô','‚ôô','‚ôô','‚ôô','‚ôô','‚ôô'],
  ['‚ôñ','‚ôò','‚ôó','‚ôï','‚ôî','‚ôó','‚ôò','‚ôñ']
];
let pb=[],pSel=null,pTurn='w',pCapW=[],pCapB=[];

function initPractice(){
  pb=START_BOARD.map(r=>[...r]);
  const el=document.getElementById('practiceBoard'); el.innerHTML='';
  for(let r=0;r<8;r++) for(let c=0;c<8;c++){
    const s=document.createElement('div');
    s.className='sq '+((r+c)%2===0?'light':'dark');
    s.id=`ps_${r}_${c}`; s.onclick=()=>pClick(r,c); el.appendChild(s);
  }
  renderPractice();
}
function renderPractice(){
  for(let r=0;r<8;r++) for(let c=0;c<8;c++){
    const s=document.getElementById(`ps_${r}_${c}`);
    s.className='sq '+((r+c)%2===0?'light':'dark');
    s.textContent=pb[r][c]||'';
  }
  document.getElementById('practiceTurn').textContent=pTurn==='w'?'‚¨ú White\'s turn':'‚¨õ Black\'s turn';
  document.getElementById('capW').textContent=pCapW.length?'‚¨ú took: '+pCapW.join(''):'';
  document.getElementById('capB').textContent=pCapB.length?'‚¨õ took: '+pCapB.join(''):'';
}
function pClick(r,c){
  const piece=pb[r][c], mine=pTurn==='w'?isW(piece):isB(piece);
  if(pSel){
    const [sr,sc]=pSel;
    const valid=getMoves(pb,sr,sc);
    if(valid.some(([vr,vc])=>vr===r&&vc===c)){
      const cap=pb[r][c];
      if(cap){isW(cap)?pCapB.push(cap):pCapW.push(cap);}
      pb[r][c]=pb[sr][sc]; pb[sr][sc]='';
      if(pb[r][c]==='‚ôô'&&r===0) pb[r][c]='‚ôï';
      if(pb[r][c]==='‚ôü'&&r===7) pb[r][c]='‚ôõ';
      pSel=null; pTurn=pTurn==='w'?'b':'w';
      document.getElementById('practiceMsg').textContent=pTurn==='w'?'‚¨ú White to move!':'‚¨õ Black to move!';
      renderPractice();
    } else if(mine){ pSel=[r,c]; renderPractice(); pHL(r,c); }
    else { pSel=null; renderPractice(); }
  } else if(mine){ pSel=[r,c]; renderPractice(); pHL(r,c); document.getElementById('practiceMsg').textContent='Selected! Click a dot to move.'; }
}
function pHL(r,c){
  document.getElementById(`ps_${r}_${c}`).classList.add('sel');
  getMoves(pb,r,c).forEach(([mr,mc])=>{
    const s=document.getElementById(`ps_${mr}_${mc}`);
    s.classList.add(pb[mr][mc]?'capture':'valid');
  });
}
function resetPractice(){
  pb=START_BOARD.map(r=>[...r]); pSel=null; pTurn='w'; pCapW=[]; pCapB=[];
  document.getElementById('practiceMsg').textContent='Click any White piece to begin!';
  renderPractice();
}
function practiceSetup(t){
  resetPractice();
  if(t==='scholars'){
    pb[4][4]='‚ôô'; pb[6][4]=''; pb[3][4]='‚ôü'; pb[1][4]=''; pb[4][2]='‚ôó'; pb[7][5]='';
    document.getElementById('practiceMsg').textContent="‚ö° Scholar's Mate! White threatens Qh5‚ÜíQxf7. Defend with Nf6!";
  } else {
    pb[7][5]=''; pb[7][6]='';
    document.getElementById('practiceMsg').textContent="üè∞ Castle! Move King two squares right ‚Äî the Rook jumps over!";
  }
  renderPractice();
}

/* ‚îÄ‚îÄ MINI BOARD ENGINE ‚îÄ‚îÄ */
function createMiniBoard(id){
  const wrap=document.createElement('div'); wrap.className='mini-board-wrap';
  const grid=document.createElement('div'); grid.className='mini-board'; grid.id='mb_'+id;
  for(let r=0;r<8;r++) for(let c=0;c<8;c++){
    const sq=document.createElement('div');
    sq.className='msq '+((r+c)%2===0?'light':'dark');
    sq.id=`mb_${id}_${r}_${c}`; grid.appendChild(sq);
  }
  wrap.appendChild(grid); return wrap;
}
function placeMB(id, pieces, hls){
  for(let r=0;r<8;r++) for(let c=0;c<8;c++){
    const sq=document.getElementById(`mb_${id}_${r}_${c}`);
    if(!sq) continue;
    sq.className='msq '+((r+c)%2===0?'light':'dark');
    sq.textContent='';
  }
  (pieces||[]).forEach(({p,r,c})=>{ const sq=document.getElementById(`mb_${id}_${r}_${c}`); if(sq) sq.textContent=p; });
  (hls||[]).forEach(({r,c,cls})=>{ const sq=document.getElementById(`mb_${id}_${r}_${c}`); if(sq) sq.classList.add(cls); });
}
function animMB(id, initP, steps, lbl){
  document.getElementById('fp_'+id)?.remove();
  let state=JSON.parse(JSON.stringify(initP));
  placeMB(id, state, []);
  if(lbl) lbl.textContent='‚è≥ Animating‚Ä¶';
  let si=0;
  function run(){
    if(si>=steps.length){ setTimeout(()=>{ placeMB(id, initP, []); if(lbl) lbl.textContent='‚ñ∂ Press Play!'; }, 1800); return; }
    const step=steps[si++];
    setTimeout(()=>{
      const gEl=document.getElementById('mb_'+id); if(!gEl) return;
      const fSq=document.getElementById(`mb_${id}_${step.fromR}_${step.fromC}`);
      const tSq=document.getElementById(`mb_${id}_${step.toR}_${step.toC}`);
      if(!fSq||!tSq) return;
      const gr=gEl.getBoundingClientRect(), fr=fSq.getBoundingClientRect(), tr=tSq.getBoundingClientRect();
      const sz=fr.width;
      const fp=document.createElement('div');
      fp.id='fp_'+id; fp.className='float-piece';
      fp.style.cssText=`width:${sz}px;height:${sz}px;font-size:${sz*.75}px;left:${fr.left-gr.left}px;top:${fr.top-gr.top}px;`;
      fp.textContent=step.piece;
      fSq.textContent=''; fSq.classList.add('mfrom');
      gEl.parentElement.appendChild(fp);
      requestAnimationFrame(()=>requestAnimationFrame(()=>{ fp.style.left=(tr.left-gr.left)+'px'; fp.style.top=(tr.top-gr.top)+'px'; }));
      setTimeout(()=>{
        fp.remove(); fSq.classList.remove('mfrom');
        if(step.cap){ const cSq=document.getElementById(`mb_${id}_${step.cap[0]}_${step.cap[1]}`); if(cSq) cSq.textContent=''; state=state.filter(p=>!(p.r===step.cap[0]&&p.c===step.cap[1])); }
        state=state.filter(p=>!(p.r===step.fromR&&p.c===step.fromC));
        state=state.filter(p=>!(p.r===step.toR&&p.c===step.toC));
        state.push({p:step.piece,r:step.toR,c:step.toC});
        placeMB(id, state, step.hl||[]);
        if(lbl&&step.lbl) lbl.textContent=step.lbl;
        run();
      }, 700);
    }, step.delay||300);
  }
  run();
}

/* ‚îÄ‚îÄ STRATEGIES DATA ‚îÄ‚îÄ */
const STRATS=[
  {id:'s0',icon:'üéØ',title:'Control the Center',diff:'begin',
   desc:'The four center squares (e4,d4,e5,d5) are the most powerful. Pieces there control more squares and are harder to attack!',
   show:[{p:'‚ôô',r:4,c:4},{p:'‚ôô',r:4,c:3},{p:'‚ôü',r:3,c:3},{p:'‚ôü',r:3,c:4}],
   hl:[{r:3,c:3,cls:'mhl'},{r:3,c:4,cls:'mhl'},{r:4,c:3,cls:'mhl'},{r:4,c:4,cls:'mhl'}],
   init:[{p:'‚ôô',r:6,c:4},{p:'‚ôô',r:6,c:3},{p:'‚ôü',r:1,c:3},{p:'‚ôü',r:1,c:4}],
   steps:[
     {piece:'‚ôô',fromR:6,fromC:4,toR:4,toC:4,lbl:'1.e4 ‚Äî White controls the center!',delay:0,hl:[{r:4,c:4,cls:'mhl'}]},
     {piece:'‚ôü',fromR:1,fromC:3,toR:3,toC:3,lbl:'1...d5 ‚Äî Black fights for center!',delay:0,hl:[{r:3,c:3,cls:'mhl'},{r:4,c:4,cls:'mhl'}]}
   ]},
  {id:'s1',icon:'üè∞',title:'Castle Early!',diff:'begin',
   desc:'Castling moves your king to safety AND connects your rooks. Always try to castle in the first 10 moves!',
   show:[{p:'‚ôî',r:7,c:6},{p:'‚ôñ',r:7,c:5},{p:'‚ôò',r:5,c:5},{p:'‚ôó',r:4,c:2}],
   hl:[{r:7,c:6,cls:'mhl'},{r:7,c:5,cls:'mhl'}],
   init:[{p:'‚ôî',r:7,c:4},{p:'‚ôñ',r:7,c:7},{p:'‚ôò',r:5,c:5},{p:'‚ôó',r:4,c:2}],
   steps:[
     {piece:'‚ôî',fromR:7,fromC:4,toR:7,toC:6,lbl:'King castles ‚Äî moves two squares right!',delay:0,hl:[{r:7,c:6,cls:'mhl'}]},
     {piece:'‚ôñ',fromR:7,fromC:7,toR:7,toC:5,lbl:'Rook jumps over! King is SAFE! üè∞',delay:0,hl:[{r:7,c:5,cls:'mhl'}]}
   ]},
  {id:'s2',icon:'ü¶Å',title:'Piece Activity',diff:'begin',
   desc:'An active piece controlling many squares is worth far more than a stuck one. Always ask: what can my pieces do?',
   show:[{p:'‚ôò',r:3,c:3}],
   hl:[{r:1,c:2,cls:'mpath'},{r:1,c:4,cls:'mpath'},{r:2,c:1,cls:'mpath'},{r:2,c:5,cls:'mpath'},{r:4,c:1,cls:'mpath'},{r:4,c:5,cls:'mpath'},{r:5,c:2,cls:'mpath'},{r:5,c:4,cls:'mpath'}],
   init:[{p:'‚ôò',r:7,c:1}],
   steps:[
     {piece:'‚ôò',fromR:7,fromC:1,toR:5,toC:2,lbl:'Knight develops ‚Äî but rim is grim!',delay:0},
     {piece:'‚ôò',fromR:5,fromC:2,toR:3,toC:3,lbl:'Knight to d5! Controls 8 squares! ü¶Å',delay:0,hl:[{r:1,c:2,cls:'mpath'},{r:1,c:4,cls:'mpath'},{r:2,c:1,cls:'mpath'},{r:2,c:5,cls:'mpath'},{r:4,c:1,cls:'mpath'},{r:4,c:5,cls:'mpath'},{r:5,c:2,cls:'mpath'},{r:5,c:4,cls:'mpath'}]}
   ]},
  {id:'s3',icon:'üìå',title:'Outpost Squares',diff:'inter',
   desc:'An outpost is a square deep in enemy territory where your piece sits safely ‚Äî no enemy pawn can attack it!',
   show:[{p:'‚ôò',r:2,c:3},{p:'‚ôü',r:1,c:2},{p:'‚ôü',r:1,c:4},{p:'‚ôü',r:3,c:2},{p:'‚ôü',r:3,c:4}],
   hl:[{r:2,c:3,cls:'mhl'}],
   init:[{p:'‚ôò',r:5,c:2},{p:'‚ôü',r:1,c:2},{p:'‚ôü',r:1,c:4},{p:'‚ôü',r:3,c:2},{p:'‚ôü',r:3,c:4}],
   steps:[{piece:'‚ôò',fromR:5,fromC:2,toR:2,toC:3,lbl:'Knight on outpost! No pawns can attack it! üìå',delay:0,hl:[{r:2,c:3,cls:'mhl'}]}]},
  {id:'s4',icon:'üîì',title:'Open Files for Rooks',diff:'inter',
   desc:'Rooks love open files with no pawns blocking. Two rooks on the 7th rank can often win the game alone!',
   show:[{p:'‚ôñ',r:1,c:3},{p:'‚ôñ',r:1,c:4},{p:'‚ôö',r:0,c:7}],
   hl:[{r:1,c:3,cls:'mhl'},{r:1,c:4,cls:'mhl'}],
   init:[{p:'‚ôñ',r:7,c:3},{p:'‚ôñ',r:7,c:4},{p:'‚ôö',r:0,c:7}],
   steps:[
     {piece:'‚ôñ',fromR:7,fromC:3,toR:1,toC:3,lbl:'First Rook invades the 7th rank!',delay:0,hl:[{r:1,c:3,cls:'mhl'}]},
     {piece:'‚ôñ',fromR:7,fromC:4,toR:1,toC:4,lbl:'Both Rooks on 7th! Devastating! üí•',delay:0,hl:[{r:1,c:3,cls:'mhl'},{r:1,c:4,cls:'mhl'}]}
   ]},
  {id:'s5',icon:'üëë',title:'King Safety',diff:'begin',
   desc:'Never ignore your king\'s safety! The pawn shield in front of your castled king is crucial ‚Äî don\'t advance those pawns!',
   show:[{p:'‚ôî',r:7,c:6},{p:'‚ôô',r:6,c:5},{p:'‚ôô',r:6,c:6},{p:'‚ôô',r:6,c:7}],
   hl:[{r:6,c:5,cls:'mpath'},{r:6,c:6,cls:'mpath'},{r:6,c:7,cls:'mpath'}],
   init:[{p:'‚ôî',r:7,c:6},{p:'‚ôô',r:6,c:5},{p:'‚ôô',r:6,c:6},{p:'‚ôô',r:6,c:7}],
   steps:[{piece:'‚ôô',fromR:6,fromC:6,toR:5,toC:6,lbl:'‚ö†Ô∏è Moving pawn shield ‚Äî king is now weaker!',delay:0,hl:[{r:6,c:5,cls:'mpath'},{r:6,c:7,cls:'mpath'}]}]},
  {id:'s6',icon:'üåü',title:'Passed Pawns',diff:'inter',
   desc:'A passed pawn has no enemy pawns blocking its path to promotion! Push it forward ‚Äî it can become a queen!',
   show:[{p:'‚ôï',r:0,c:4}],
   hl:[{r:0,c:4,cls:'mhl'}],
   init:[{p:'‚ôô',r:2,c:4}],
   steps:[
     {piece:'‚ôô',fromR:2,fromC:4,toR:1,toC:4,lbl:'Pawn advances ‚Äî unstoppable!',delay:0,hl:[{r:0,c:4,cls:'mpath'}]},
     {piece:'‚ôô',fromR:1,fromC:4,toR:0,toC:4,lbl:'PROMOTION! Becomes a Queen! üåü',delay:0}
   ]},
  {id:'s7',icon:'üîÑ',title:'Zugzwang',diff:'adv',
   desc:'A position where ANY move makes things WORSE for you! You wish you could pass your turn ‚Äî but in chess you must always move!',
   show:[{p:'‚ôî',r:2,c:4},{p:'‚ôö',r:0,c:4},{p:'‚ôô',r:1,c:4}],
   hl:[{r:0,c:3,cls:'matt'},{r:0,c:5,cls:'matt'}],
   init:[{p:'‚ôî',r:2,c:4},{p:'‚ôö',r:0,c:4},{p:'‚ôô',r:1,c:4}],
   steps:[
     {piece:'‚ôö',fromR:0,fromC:4,toR:0,toC:3,lbl:'Black king MUST move ‚Äî any move loses!',delay:0},
     {piece:'‚ôô',fromR:1,fromC:4,toR:0,toC:4,lbl:'Pawn promotes! White wins! üîÑ',delay:0}
   ]},
  {id:'s8',icon:'‚è∞',title:"Don't Waste Moves",diff:'begin',
   desc:"Every move counts! Moving the same piece twice in the opening wastes a 'tempo' ‚Äî letting your opponent develop for free.",
   show:[{p:'‚ôï',r:5,c:4},{p:'‚ôû',r:2,c:5}],
   hl:[{r:5,c:4,cls:'matt'}],
   init:[{p:'‚ôï',r:5,c:4},{p:'‚ôù',r:2,c:2},{p:'‚ôû',r:2,c:5}],
   steps:[
     {piece:'‚ôï',fromR:5,fromC:4,toR:2,toC:2,lbl:'Queen captures ‚Äî but moved again! Wasted tempo!',delay:0,cap:[2,2]},
     {piece:'‚ôû',fromR:2,fromC:5,toR:0,toC:4,lbl:'Black develops freely! They gained a tempo! ‚è∞',delay:0}
   ]},
  {id:'s9',icon:'üé™',title:'King in the Endgame',diff:'inter',
   desc:'In the endgame, the king becomes a powerful fighting piece! March it to the center to support your passed pawns.',
   show:[{p:'‚ôî',r:4,c:3},{p:'‚ôô',r:1,c:4}],
   hl:[{r:4,c:3,cls:'mhl'},{r:1,c:4,cls:'mpath'}],
   init:[{p:'‚ôî',r:7,c:0},{p:'‚ôô',r:3,c:4}],
   steps:[
     {piece:'‚ôî',fromR:7,fromC:0,toR:5,toC:2,lbl:'King marches to the center!',delay:0},
     {piece:'‚ôî',fromR:5,fromC:2,toR:4,toC:3,lbl:'King escorts the pawn forward! üé™',delay:0,hl:[{r:4,c:3,cls:'mhl'}]}
   ]},
  {id:'s10',icon:'‚ö°',title:'Gaining Tempo',diff:'adv',
   desc:"A 'tempo' is like a free move. Make a threat that forces your opponent to react ‚Äî you develop while they play defence!",
   show:[{p:'‚ôó',r:3,c:4},{p:'‚ôû',r:1,c:2}],
   hl:[{r:3,c:4,cls:'mhl'},{r:1,c:2,cls:'matt'}],
   init:[{p:'‚ôó',r:6,c:1},{p:'‚ôü',r:2,c:4},{p:'‚ôû',r:1,c:2}],
   steps:[
     {piece:'‚ôó',fromR:6,fromC:1,toR:3,toC:4,lbl:'Bishop attacks Queen ‚Äî AND forks the knight! Tempo! ‚ö°',delay:0,hl:[{r:3,c:4,cls:'mhl'},{r:2,c:4,cls:'matt'},{r:1,c:2,cls:'matt'}]}
   ]},
  {id:'s11',icon:'üîó',title:'Pawn Structure',diff:'inter',
   desc:"Pawns can't go backwards! Avoid doubled pawns (two on same file), isolated pawns, and backward pawns ‚Äî they become weaknesses.",
   show:[{p:'‚ôô',r:4,c:3},{p:'‚ôô',r:4,c:4},{p:'‚ôô',r:5,c:2}],
   hl:[{r:4,c:3,cls:'matt'},{r:4,c:4,cls:'matt'}],
   init:[{p:'‚ôô',r:4,c:3},{p:'‚ôô',r:5,c:4},{p:'‚ôô',r:5,c:2},{p:'‚ôú',r:1,c:3}],
   steps:[
     {piece:'‚ôô',fromR:5,fromC:4,toR:4,toC:3,lbl:'‚ö†Ô∏è Doubled pawns on d-file ‚Äî permanent weakness!',delay:0,cap:[4,3],hl:[{r:4,c:3,cls:'matt'},{r:3,c:3,cls:'mpath'}]}
   ]}
];

function buildStrats(){
  const grid=document.getElementById('stratGrid');
  STRATS.forEach((s,i)=>{
    const card=document.createElement('div'); card.className='strat-card';
    const tClass=s.diff==='begin'?'tag-begin':s.diff==='inter'?'tag-inter':'tag-adv';
    const tText=s.diff==='begin'?'Beginner':s.diff==='inter'?'Intermediate':'Advanced';
    card.innerHTML=`<h3>${s.icon} ${s.title} <span class="tag ${tClass}">${tText}</span></h3><p>${s.desc}</p>`;
    const bw=createMiniBoard('s'+i); card.appendChild(bw);
    const row=document.createElement('div'); row.className='anim-row';
    const lbl=document.createElement('span'); lbl.className='anim-lbl'; lbl.textContent='‚ñ∂ Press Play!';
    const pb=document.createElement('button'); pb.className='btn btn-sm btn-gold'; pb.textContent='‚ñ∂ Play';
    pb.onclick=()=>animMB('s'+i, s.init, s.steps, lbl);
    const rb=document.createElement('button'); rb.className='btn btn-sm'; rb.textContent='‚Ü∫';
    rb.style.cssText='background:#e2e8f0;border-color:#94a3b8;box-shadow:0 4px 0 #94a3b8;color:#334155;';
    rb.onclick=()=>{ placeMB('mb_s'+i, s.show, s.hl); lbl.textContent='‚ñ∂ Press Play!'; };
    row.appendChild(pb); row.appendChild(rb); row.appendChild(lbl);
    card.appendChild(row); grid.appendChild(card);
    setTimeout(()=>placeMB('mb_s'+i, s.show, s.hl), 30);
  });
}

/* ‚îÄ‚îÄ TRICKS DATA ‚îÄ‚îÄ */
const TRICKS=[
  {id:'t0',icon:'‚ö°',title:'Fork ‚Äî Attack Two at Once!',
   desc:'One piece attacks two enemy pieces simultaneously! Your opponent can only save one ‚Äî you win the other for free!',
   show:[{p:'‚ôò',r:4,c:4},{p:'‚ôú',r:3,c:2},{p:'‚ôõ',r:3,c:6}],
   hl:[{r:3,c:2,cls:'matt'},{r:3,c:6,cls:'matt'}],
   init:[{p:'‚ôò',r:5,c:3},{p:'‚ôú',r:3,c:2},{p:'‚ôõ',r:3,c:6}],
   steps:[
     {piece:'‚ôò',fromR:5,fromC:3,toR:4,toC:4,lbl:'Knight forks Rook AND Queen! üò± One must die!',delay:0,hl:[{r:3,c:2,cls:'matt'},{r:3,c:6,cls:'matt'}]},
     {piece:'‚ôò',fromR:4,fromC:4,toR:3,toC:2,lbl:'Knight takes the Rook ‚Äî free piece! ‚ö°',delay:0,cap:[3,2]}
   ]},
  {id:'t1',icon:'üìå',title:'Pin ‚Äî Piece Cannot Move!',
   desc:'A piece is pinned when moving it would expose a more valuable piece behind it. Pieces pinned to the King cannot legally move!',
   show:[{p:'‚ôñ',r:4,c:0},{p:'‚ôû',r:4,c:3},{p:'‚ôö',r:4,c:7}],
   hl:[{r:4,c:3,cls:'matt'}],
   init:[{p:'‚ôñ',r:7,c:0},{p:'‚ôû',r:4,c:3},{p:'‚ôö',r:4,c:7}],
   steps:[
     {piece:'‚ôñ',fromR:7,fromC:0,toR:4,toC:0,lbl:'Rook pins the Knight to the King!',delay:0,hl:[{r:4,c:3,cls:'matt'},{r:4,c:0,cls:'mhl'}]},
     {piece:'‚ôñ',fromR:4,fromC:0,toR:4,toC:3,lbl:'Knight can\'t run ‚Äî Rook captures it! üìå',delay:0,cap:[4,3]}
   ]},
  {id:'t2',icon:'üí•',title:'Skewer ‚Äî Big Piece Must Flee!',
   desc:'The opposite of a pin! Attack a big piece ‚Äî it moves to safety ‚Äî then you capture the smaller piece hiding behind it!',
   show:[{p:'‚ôó',r:3,c:2},{p:'‚ôö',r:1,c:4},{p:'‚ôõ',r:0,c:5}],
   hl:[{r:1,c:4,cls:'matt'},{r:0,c:5,cls:'matt'}],
   init:[{p:'‚ôó',r:5,c:0},{p:'‚ôö',r:2,c:3},{p:'‚ôõ',r:0,c:5}],
   steps:[
     {piece:'‚ôó',fromR:5,fromC:0,toR:3,toC:2,lbl:'Bishop attacks King ‚Äî MUST move!',delay:0,hl:[{r:2,c:3,cls:'matt'}]},
     {piece:'‚ôö',fromR:2,fromC:3,toR:1,toC:4,lbl:'King flees‚Ä¶ Queen exposed behind it!',delay:0},
     {piece:'‚ôó',fromR:3,fromC:2,toR:0,toC:5,lbl:'Bishop takes the Queen for FREE! üí•',delay:0,cap:[0,5]}
   ]},
  {id:'t3',icon:'üéØ',title:'Discovered Attack!',
   desc:'Move one piece to REVEAL a hidden attack from the piece behind it. Double attacks are near impossible to defend!',
   show:[{p:'‚ôò',r:2,c:4},{p:'‚ôó',r:6,c:1},{p:'‚ôö',r:2,c:5},{p:'‚ôõ',r:0,c:3}],
   hl:[{r:2,c:5,cls:'matt'},{r:0,c:3,cls:'matt'}],
   init:[{p:'‚ôò',r:4,c:3},{p:'‚ôó',r:6,c:1},{p:'‚ôö',r:2,c:5},{p:'‚ôõ',r:0,c:3}],
   steps:[{piece:'‚ôò',fromR:4,fromC:3,toR:2,toC:4,lbl:'Knight moves AND checks King! Bishop fires on Queen! Double attack! üéØ',delay:0,hl:[{r:2,c:5,cls:'matt'},{r:0,c:3,cls:'matt'},{r:2,c:4,cls:'mhl'}]}]},
  {id:'t4',icon:'üòà',title:"Scholar's Mate!",
   desc:"The fastest checkmate ‚Äî just 4 moves! White's Queen and Bishop team up to destroy the weak f7 square near Black's king.",
   show:[{p:'‚ôó',r:4,c:2},{p:'‚ôï',r:1,c:5},{p:'‚ôö',r:0,c:4}],
   hl:[{r:1,c:5,cls:'mhl'},{r:0,c:4,cls:'matt'}],
   init:[{p:'‚ôó',r:4,c:2},{p:'‚ôï',r:3,c:7},{p:'‚ôö',r:0,c:4},{p:'‚ôü',r:1,c:5}],
   steps:[{piece:'‚ôï',fromR:3,fromC:7,toR:1,toC:5,lbl:'Qxf7# CHECKMATE! The king is trapped! üòà',delay:0,cap:[1,5],hl:[{r:0,c:4,cls:'matt'}]}]},
  {id:'t5',icon:'üîÑ',title:'Zwischenzug!',
   desc:"An 'in-between' move! Instead of the expected recapture, play a surprise move first. Shocks your opponent and wins more!",
   show:[{p:'‚ôï',r:4,c:3},{p:'‚ôú',r:1,c:3},{p:'‚ôö',r:0,c:7}],
   hl:[{r:0,c:7,cls:'matt'}],
   init:[{p:'‚ôï',r:4,c:3},{p:'‚ôú',r:1,c:3},{p:'‚ôö',r:0,c:7}],
   steps:[
     {piece:'‚ôï',fromR:4,fromC:3,toR:0,toC:7,lbl:'Wait! CHECK first instead of capturing ‚Äî Zwischenzug!',delay:0,hl:[{r:0,c:7,cls:'matt'}]},
     {piece:'‚ôö',fromR:0,fromC:7,toR:1,toC:7,lbl:'King must deal with check first‚Ä¶',delay:0},
     {piece:'‚ôï',fromR:0,fromC:7,toR:1,toC:3,lbl:'NOW take the Rook! Won extra material! üéâ',delay:0,cap:[1,3]}
   ]},
  {id:'t6',icon:'üí´',title:'The Sacrifice!',
   desc:"Give up a piece on purpose to open lines, expose the enemy king, then deliver checkmate! The most spectacular moves in chess!",
   show:[{p:'‚ôö',r:0,c:6},{p:'‚ôï',r:1,c:5},{p:'‚ôü',r:1,c:6}],
   hl:[{r:0,c:6,cls:'matt'}],
   init:[{p:'‚ôó',r:3,c:7},{p:'‚ôö',r:0,c:6},{p:'‚ôü',r:1,c:7},{p:'‚ôü',r:1,c:6},{p:'‚ôï',r:5,c:3}],
   steps:[
     {piece:'‚ôó',fromR:3,fromC:7,toR:1,toC:7,lbl:'Bishop SACRIFICED on h7! üí´',delay:0,cap:[1,7]},
     {piece:'‚ôö',fromR:0,fromC:6,toR:0,toC:7,lbl:'King must capture!',delay:0,cap:[0,7]},
     {piece:'‚ôï',fromR:5,fromC:3,toR:1,toC:5,lbl:'Queen delivers CHECKMATE! The sacrifice wins! üéâ',delay:0,hl:[{r:0,c:7,cls:'matt'}]}
   ]},
  {id:'t7',icon:'üè∞',title:'Castling ‚Äî King Safety!',
   desc:"A special move where the King jumps TWO squares and the Rook leaps over it! The best way to keep your king safe.",
   show:[{p:'‚ôî',r:7,c:6},{p:'‚ôñ',r:7,c:5}],
   hl:[{r:7,c:5,cls:'mhl'},{r:7,c:6,cls:'mhl'}],
   init:[{p:'‚ôî',r:7,c:4},{p:'‚ôñ',r:7,c:7}],
   steps:[
     {piece:'‚ôî',fromR:7,fromC:4,toR:7,toC:6,lbl:'King jumps two squares to g1!',delay:0,hl:[{r:7,c:6,cls:'mhl'}]},
     {piece:'‚ôñ',fromR:7,fromC:7,toR:7,toC:5,lbl:'Rook leaps over to f1! Castled! üè∞',delay:0,hl:[{r:7,c:5,cls:'mhl'}]}
   ]}
];

function buildTricks(){
  const grid=document.getElementById('tricksGrid');
  TRICKS.forEach((t,i)=>{
    const card=document.createElement('div'); card.className='strat-card';
    card.innerHTML=`<h3>${t.icon} ${t.title}</h3><p>${t.desc}</p>`;
    const bw=createMiniBoard('t'+i); card.appendChild(bw);
    const row=document.createElement('div'); row.className='anim-row';
    const lbl=document.createElement('span'); lbl.className='anim-lbl'; lbl.textContent='‚ñ∂ Press Play!';
    const pb=document.createElement('button'); pb.className='btn btn-sm btn-purple'; pb.textContent='‚ñ∂ Play';
    pb.onclick=()=>animMB('t'+i, t.init, t.steps, lbl);
    const rb=document.createElement('button'); rb.className='btn btn-sm'; rb.textContent='‚Ü∫';
    rb.style.cssText='background:#e2e8f0;border-color:#94a3b8;box-shadow:0 4px 0 #94a3b8;color:#334155;';
    rb.onclick=()=>{ placeMB('mb_t'+i, t.show, t.hl); lbl.textContent='‚ñ∂ Press Play!'; };
    row.appendChild(pb); row.appendChild(rb); row.appendChild(lbl);
    card.appendChild(row); grid.appendChild(card);
    setTimeout(()=>placeMB('mb_t'+i, t.show, t.hl), 30);
  });
}

/* ‚îÄ‚îÄ CHALLENGES ‚îÄ‚îÄ */
const CHALS=[
  {id:1,icon:'‚ôü',title:'Pawn Takes Queen',diff:'easy',
   mission:'Your White Pawn is on d5. The Black Queen is on e6. Pawns capture diagonally ‚Äî grab the Queen!',
   pieces:[{p:'‚ôô',sq:[3,3]},{p:'‚ôõ',sq:[2,4]},{p:'‚ôö',sq:[0,7]},{p:'‚ôî',sq:[7,0]}],
   win:{type:'cap',at:[2,4]}, msg:"YES! Your tiny pawn just took the most powerful piece! Pawns are heroes! ü¶∏",
   hint:{intro:'Pawns always capture diagonally, one square forward.',steps:['Your White Pawn is on d5 ‚Äî that\'s row 3, column 3.','Pawns capture diagonally forward ‚Äî one square.','The Black Queen is on e6 ‚Äî one square diagonally forward-right!','Click the Pawn, then click the Queen to capture it!']}},
  {id:2,icon:'‚ôú',title:'Rook Slides In',diff:'easy',
   mission:'Slide your White Rook along the open rank to capture the Black Rook on the other side!',
   pieces:[{p:'‚ôñ',sq:[4,0]},{p:'‚ôú',sq:[4,7]},{p:'‚ôö',sq:[0,4]},{p:'‚ôî',sq:[7,4]}],
   win:{type:'cap',at:[4,7]}, msg:'Perfect Rook slide across the open file! üè∞',
   hint:{intro:'Rooks move any number of squares horizontally or vertically.',steps:['Your Rook is on a4. The Black Rook is on h4.','They are on the same rank (row 4).','Nothing blocks between them.','Click your Rook, then click the Black Rook to take it!']}},
  {id:3,icon:'‚ôó',title:'Bishop Strikes!',diff:'easy',
   mission:'Fire your White Bishop diagonally to capture the Black Knight!',
   pieces:[{p:'‚ôó',sq:[6,0]},{p:'‚ôû',sq:[2,4]},{p:'‚ôö',sq:[0,7]},{p:'‚ôî',sq:[7,7]}],
   win:{type:'cap',at:[2,4]}, msg:'Excellent diagonal shot! Bishops love open diagonals! ‚ôó‚ú®',
   hint:{intro:'Bishops move diagonally any number of squares.',steps:['Your Bishop is on a2 (row 6, col 0).','Bishops move diagonally ‚Äî count the squares.','The Knight is on e6 (row 2, col 4) ‚Äî same diagonal!','Click Bishop, count 4 squares diagonally, click Knight!']}},
  {id:4,icon:'‚ôõ',title:'Queen Captures!',diff:'easy',
   mission:'Use your powerful Queen to capture the Black Rook in one move!',
   pieces:[{p:'‚ôï',sq:[4,0]},{p:'‚ôú',sq:[4,6]},{p:'‚ôö',sq:[0,7]},{p:'‚ôî',sq:[7,7]}],
   win:{type:'cap',at:[4,6]}, msg:'The Queen strikes! Unstoppable! ‚ôõüí•',
   hint:{intro:'The Queen moves any direction ‚Äî any distance!',steps:['Your Queen is on a4 (row 4, col 0).','The Rook is on g4 (row 4, col 6) ‚Äî same row!','The Queen can slide across the whole rank.','Click Queen then click the Rook!']}},
  {id:5,icon:'‚ôü',title:'Pawn Promotion!',diff:'easy',
   mission:'March your passed pawn all the way to the end and promote it to a Queen!',
   pieces:[{p:'‚ôô',sq:[2,3]},{p:'‚ôî',sq:[7,0]},{p:'‚ôö',sq:[0,7]}],
   win:{type:'promote',at:[0,3]}, msg:"PROMOTION! Your little pawn became a Queen! üëëüéâ",
   hint:{intro:'Pawns promote when they reach the opposite end of the board!',steps:['Your White pawn is on d6 (row 2, col 3).','Move it forward to d7, then to d8.','When a pawn reaches row 0, it becomes a Queen!','Two moves forward ‚Äî you win!']}},
  {id:6,icon:'‚ôò',title:'Knight Hop!',diff:'easy',
   mission:'Jump your White Knight in an L-shape to capture the unprotected Black Knight!',
   pieces:[{p:'‚ôò',sq:[4,3]},{p:'‚ôû',sq:[2,4]},{p:'‚ôö',sq:[0,7]},{p:'‚ôî',sq:[7,7]}],
   win:{type:'cap',at:[2,4]}, msg:'Perfect L-shape jump! Knights are sneaky! ‚ôòüéØ',
   hint:{intro:'Knights move in an L-shape: 2 squares one direction, 1 square sideways.',steps:['Your Knight is on d4 (row 4, col 3).','The Black Knight is on e6 (row 2, col 4).','From d4 ‚Äî go up 2 rows, right 1 column = e6!','Click your Knight, then click e6 to capture!']}},
  {id:7,icon:'üè∞',title:'Stop the Passer!',diff:'easy',
   mission:'The Black pawn is racing to promote! Use your Rook to capture it before it escapes!',
   pieces:[{p:'‚ôñ',sq:[7,6]},{p:'‚ôü',sq:[1,4]},{p:'‚ôî',sq:[7,0]},{p:'‚ôö',sq:[0,7]}],
   win:{type:'cap',at:[1,4]}, msg:'Rook stops the promotion! Excellent defence! üõ°Ô∏è',
   hint:{intro:'Use your Rook to stop the passed pawn.',steps:['The Black pawn on e7 is about to promote!','Your Rook is on g1.','Rooks move in straight lines ‚Äî go to e1 first, then up.','Or go up first then across ‚Äî reach e7 to capture!']}},
  {id:8,icon:'‚ôõ',title:'Deliver Checkmate!',diff:'easy',
   mission:'Move the White Queen to deliver CHECKMATE to the Black King ‚Äî it cannot escape!',
   pieces:[{p:'‚ôï',sq:[3,0]},{p:'‚ôî',sq:[7,0]},{p:'‚ôö',sq:[0,4]},{p:'‚ôñ',sq:[1,7]}],
   win:{type:'moveto',from:[3,0],to:[0,4]}, msg:'CHECKMATE! The King is trapped! You win! üëëüéâ',
   hint:{intro:'Checkmate means the king is in check and cannot escape.',steps:['The Black King is on e8 (row 0, col 4).','Your Queen is on a5 (row 3, col 0).','The Rook on h7 is already attacking. Add the Queen!','Move Queen to e8 ‚Äî checkmate!']}},

  {id:9,icon:'‚ôû',title:'Knight Fork!',diff:'medium',
   mission:'Jump your Knight to a square that attacks BOTH the Black King and the Black Rook at the same time!',
   pieces:[{p:'‚ôò',sq:[5,3]},{p:'‚ôö',sq:[0,4]},{p:'‚ôú',sq:[0,2]},{p:'‚ôî',sq:[7,7]}],
   win:{type:'moveto',from:[5,3],to:[2,3]}, msg:'FORK! The Knight attacks King and Rook simultaneously! üç¥',
   hint:{intro:'A fork attacks two pieces at once with one move.',steps:['Your Knight is on d3 (row 5, col 3).','Black King on e8 (row 0, col 4), Rook on c8 (row 0, col 2).','Find a square where your Knight attacks BOTH!','d6 (row 2, col 3) forks King on e8 and Rook on c8!']}},
  {id:10,icon:'üìå',title:'Pin the Knight!',diff:'medium',
   mission:'Move your Rook to the same rank as the Black King, pinning the Knight between them!',
   pieces:[{p:'‚ôñ',sq:[7,0]},{p:'‚ôû',sq:[4,3]},{p:'‚ôö',sq:[4,7]},{p:'‚ôî',sq:[0,0]}],
   win:{type:'moveto',from:[7,0],to:[4,0]}, msg:'PERFECT PIN! The Knight is frozen ‚Äî it cannot move! üìå',
   hint:{intro:'A pin freezes a piece because moving it would expose the King.',steps:['Black Knight is on d4 (row 4, col 3), King on h4 (row 4, col 7).','They are on the same RANK!','Slide your Rook to a4 (row 4, col 0).','Now the Knight is pinned ‚Äî it cannot legally move!']}},
  {id:11,icon:'‚ö°',title:'Knight Forks King+Queen!',diff:'medium',
   mission:'Find the one jump that lets your Knight attack BOTH the Black King and Queen simultaneously!',
   pieces:[{p:'‚ôò',sq:[6,4]},{p:'‚ôö',sq:[1,3]},{p:'‚ôõ',sq:[1,7]},{p:'‚ôî',sq:[7,0]}],
   win:{type:'moveto',from:[6,4],to:[3,5]}, msg:'Brilliant Knight fork! King AND Queen threatened at once! üò±',
   hint:{intro:'Knights are the best forking pieces ‚Äî they jump unexpectedly!',steps:['Your Knight is on e2 (row 6, col 4).','Black King is on d7 (row 1, col 3), Queen on h7 (row 1, col 7).','A Knight on f5 (row 3, col 5) attacks BOTH!','Move the Knight there ‚Äî which way is the L-shape to f5?']}},
  {id:12,icon:'üèÅ',title:'Back Rank Mate!',diff:'medium',
   mission:'Slide your Rook to the back rank to deliver CHECKMATE! The Black King is trapped by its own pawns!',
   pieces:[{p:'‚ôñ',sq:[4,0]},{p:'‚ôö',sq:[0,5]},{p:'‚ôü',sq:[1,4]},{p:'‚ôü',sq:[1,5]},{p:'‚ôü',sq:[1,6]},{p:'‚ôî',sq:[7,7]}],
   win:{type:'moveto',from:[4,0],to:[0,0]}, msg:'BACK RANK CHECKMATE! The King was imprisoned by its own pawns! üèÅ',
   hint:{intro:'A back rank mate traps the king behind its own pawns.',steps:['The Black King sits on f8 (row 0, col 5).','Its own pawns on e7, f7, g7 block all escape!','Your Rook can slide up the a-file to a8.','That\'s checkmate ‚Äî King has no escape square!']}},
  {id:13,icon:'‚ôñ',title:'Rook Battery!',diff:'medium',
   mission:'Place your second Rook to double up on the open file, creating an unstoppable battery!',
   pieces:[{p:'‚ôñ',sq:[4,3]},{p:'‚ôñ',sq:[7,3]},{p:'‚ôö',sq:[0,3]},{p:'‚ôî',sq:[7,7]}],
   win:{type:'moveto',from:[7,3],to:[5,3]}, msg:'Rook battery formed! Double rooks on the d-file dominate! üè∞üè∞',
   hint:{intro:'Doubled rooks on an open file are devastating.',steps:['You already have a Rook on d4 (row 4, col 3).','The Black King is on d8 (row 0, col 3) ‚Äî same file!','Double your Rooks on the d-file.','Move the second Rook from d1 to d3 ‚Äî battery formed!']}},
  {id:14,icon:'üîç',title:'Discovered Check!',diff:'medium',
   mission:'Move your Knight to reveal a hidden check from the Bishop behind it!',
   pieces:[{p:'‚ôò',sq:[4,4]},{p:'‚ôó',sq:[7,1]},{p:'‚ôö',sq:[1,7]},{p:'‚ôî',sq:[7,7]}],
   win:{type:'moveto',from:[4,4],to:[2,5]}, msg:'Discovered check! The Bishop was hiding behind the Knight! üéØ',
   hint:{intro:'A discovered attack reveals a hidden piece when you move.',steps:['Your Knight on e4 (row 4, col 4) blocks the Bishop on b1.','Black King is on h7 (row 1, col 7).','Moving the Knight REVEALS the Bishop\'s diagonal attack!','Move Knight to f6 ‚Äî Bishop fires along the diagonal to h7!']}},
  {id:15,icon:'üëÅÔ∏è',title:'Skewer the King!',diff:'medium',
   mission:'Attack the Black King with your Bishop ‚Äî when it moves, your Bishop takes the Queen hiding behind it!',
   pieces:[{p:'‚ôó',sq:[5,1]},{p:'‚ôö',sq:[2,4]},{p:'‚ôõ',sq:[0,6]},{p:'‚ôî',sq:[7,7]}],
   win:{type:'moveto',from:[5,1],to:[3,3]}, msg:'Skewer! The King ran and exposed the Queen! ‚ôóüí•',
   hint:{intro:'A skewer attacks a big piece ‚Äî when it moves, you capture the piece behind!',steps:['Your Bishop is on b3 (row 5, col 1).','Black King on e6 (row 2, col 4), Queen on g8 (row 0, col 6).','Move Bishop to d5 (row 3, col 3).','Now it attacks King AND points toward the Queen behind!']}},

  {id:16,icon:'üç¥',title:'Royal Fork!',diff:'hard',
   mission:'Execute a brilliant Knight fork ‚Äî attack the King, Queen, AND a Rook all at once!',
   pieces:[{p:'‚ôò',sq:[6,3]},{p:'‚ôö',sq:[0,4]},{p:'‚ôõ',sq:[2,2]},{p:'‚ôú',sq:[0,0]},{p:'‚ôî',sq:[7,7]}],
   win:{type:'moveto',from:[6,3],to:[1,4]}, msg:'ROYAL FORK! Three pieces threatened at once! Magnificent! üëëüí•',
   hint:{intro:'Knights can attack three pieces at once in the right position!',steps:['Your Knight is on d2 (row 6, col 3).','Black King on e8, Queen on c6, Rook on a8.','Find a square the Knight can reach that attacks MULTIPLE pieces.','e7 (row 1, col 4) attacks King on e8, Queen on c6! Move there!']}},
  {id:17,icon:'üí•',title:'Force the Win!',diff:'hard',
   mission:"Your Queen is under attack but there's a stronger move ‚Äî give check FIRST, then recapture!",
   pieces:[{p:'‚ôï',sq:[4,3]},{p:'‚ôú',sq:[4,6]},{p:'‚ôö',sq:[0,7]},{p:'‚ôî',sq:[7,0]}],
   win:{type:'moveto',from:[4,3],to:[0,7]}, msg:'Brilliant Zwischenzug! Check first ‚Äî THEN win the Rook! üîÑ',
   hint:{intro:'A zwischenzug is an in-between move ‚Äî a surprise tactic!',steps:['Your Queen is on d4, a Black Rook threatens it on g4.','Instead of fleeing ‚Äî CHECK the King on h8!','Move Queen to h8 ‚Äî check! King must respond.','After King moves, go back and take the Rook for free!']}},
  {id:18,icon:'üåÄ',title:'Smothered Mate!',diff:'hard',
   mission:"Deliver a spectacular Smothered Mate ‚Äî the King is suffocated by its own pieces!",
   pieces:[{p:'‚ôò',sq:[3,4]},{p:'‚ôö',sq:[0,7]},{p:'‚ôõ',sq:[2,7]},{p:'‚ôü',sq:[0,6]},{p:'‚ôü',sq:[1,7]},{p:'‚ôî',sq:[7,0]}],
   win:{type:'moveto',from:[3,4],to:[1,6]}, msg:'SMOTHERED MATE! The Knight delivers checkmate ‚Äî King is trapped by its own pieces! üåÄüëë',
   hint:{intro:'A smothered mate happens when a Knight checks a King surrounded by its own pieces.',steps:['Black King on h8 (row 0, col 7) is surrounded by its own Queen and pawns!','Your Knight on e5 (row 3, col 4) is the hero.','Move Knight to g6 (row 1, col 6).','The Knight checks the King ‚Äî and the King cannot move! MATE!']}},
  {id:19,icon:'üèÜ',title:'Legendary Checkmate!',diff:'hard',
   mission:'Find the winning Queen sacrifice that leads to an unstoppable checkmate with the Rook!',
   pieces:[{p:'‚ôï',sq:[2,2]},{p:'‚ôñ',sq:[2,7]},{p:'‚ôö',sq:[0,4]},{p:'‚ôü',sq:[1,3]},{p:'‚ôü',sq:[1,5]},{p:'‚ôî',sq:[7,0]}],
   win:{type:'moveto',from:[2,2],to:[0,4]}, msg:'LEGENDARY! Queen sacrificed herself for the ultimate checkmate! üèÜüëë',
   hint:{intro:'Sometimes a sacrifice is the ONLY winning move!',steps:['Black King on e8 (row 0, col 4) is hemmed in by its own pawns.','Your Queen is on c6, Rook is on h6.','Sacrifice the Queen ‚Äî move it to e8!','The King MUST capture. Then Rook swings to e6 ‚Äî CHECKMATE!']}},
  {id:20,icon:'üëë',title:'The Double Check!',diff:'hard',
   mission:'Move your Knight to deliver a devastating double check ‚Äî two pieces give check simultaneously!',
   pieces:[{p:'‚ôò',sq:[4,5]},{p:'‚ôó',sq:[6,3]},{p:'‚ôö',sq:[0,4]},{p:'‚ôî',sq:[7,7]}],
   win:{type:'moveto',from:[4,5],to:[2,4]}, msg:'DOUBLE CHECK! Both Knight and Bishop give check ‚Äî impossible to block! üéäüëë',
   hint:{intro:'A double check attacks the King with two pieces at once ‚Äî it can only be escaped by moving the King!',steps:['Your Knight is on f4 (row 4, col 5).','Bishop on d2 (row 6, col 3) aims at the King on e8.','Move Knight to e6 (row 2, col 4).','BOTH Knight AND Bishop now attack e8 ‚Äî double check! King must run but there\'s nowhere to go!']}}
];

let chalSolved=[], chalCurrent=null, chalBoard=[], chalSel=null, chalMoveLog=[];

function initChallenges(){
  const grid=document.getElementById('chalGrid');
  CHALS.forEach(c=>{
    const btn=document.createElement('div'); btn.className='cth'; btn.id='cth_'+c.id;
    btn.innerHTML=`<span class="ci">${c.icon}</span><span class="cn">${c.id}</span>`;
    btn.onclick=()=>loadChal(c.id); grid.appendChild(btn);
  });
  updateChalProgress();
}

function updateChalProgress(){
  const n=chalSolved.length;
  document.getElementById('chalFill').style.width=(n/20*100)+'%';
  document.getElementById('chalLabel').textContent=n+' of 20 puzzles solved';
}

function loadChal(id){
  chalCurrent=CHALS.find(c=>c.id===id); if(!chalCurrent) return;
  chalMoveLog=[]; chalSel=null;
  document.querySelectorAll('.cth').forEach(b=>b.classList.remove('cur'));
  document.getElementById('cth_'+id).classList.add('cur');
  document.getElementById('chalIcon').textContent=chalCurrent.icon;
  document.getElementById('chalTitle').textContent=chalCurrent.title;
  const dc=chalCurrent.diff;
  const tag=document.getElementById('chalDiffTag');
  tag.className='tag '+(dc==='easy'?'tag-easy':dc==='medium'?'tag-medium':'tag-hard');
  tag.textContent=dc==='easy'?'Easy':dc==='medium'?'Medium':'Hard';
  document.getElementById('chalMission').textContent=chalCurrent.mission;
  document.getElementById('resultBlock').classList.remove('show');
  document.getElementById('nextBtn').style.display='none';
  document.getElementById('movesLog').textContent='Make your first move‚Ä¶';
  document.getElementById('hintBody').style.display='none';
  document.getElementById('hintHide').style.display='block';
  resetChalBoard();
}

function resetChalBoard(){
  if(!chalCurrent) return;
  chalBoard=Array.from({length:8},()=>Array(8).fill(''));
  chalCurrent.pieces.forEach(({p,sq})=>chalBoard[sq[0]][sq[1]]=p);
  chalSel=null; chalMoveLog=[];
  renderChalBoard();
  document.getElementById('movesLog').textContent='Make your first move‚Ä¶';
  document.getElementById('resultBlock').classList.remove('show');
  document.getElementById('nextBtn').style.display='none';
}

function renderChalBoard(){
  let wrap=document.getElementById('chalBoardWrap');
  // Build if first time
  if(!document.getElementById('chal-board-el')){
    wrap.innerHTML='';
    const board=document.createElement('div'); board.className='chal-board'; board.id='chal-board-el';
    for(let r=0;r<8;r++) for(let c=0;c<8;c++){
      const sq=document.createElement('div');
      sq.className='csq '+((r+c)%2===0?'light':'dark');
      sq.id=`csq_${r}_${c}`; sq.onclick=()=>chalClick(r,c); board.appendChild(sq);
    }
    wrap.appendChild(board);
  }
  const win=chalCurrent?.win;
  for(let r=0;r<8;r++) for(let c=0;c<8;c++){
    const sq=document.getElementById(`csq_${r}_${c}`);
    if(!sq) continue;
    sq.className='csq '+((r+c)%2===0?'light':'dark');
    sq.textContent=chalBoard[r][c]||'';
    if(win&&win.type==='cap'&&win.at[0]===r&&win.at[1]===c&&chalBoard[r][c]) sq.classList.add('ctgt');
    if(win&&win.type==='moveto'&&win.to[0]===r&&win.to[1]===c&&!chalBoard[r][c]) sq.classList.add('ctgt');
  }
}

function chalClick(r,c){
  if(document.getElementById('resultBlock').classList.contains('show')) return;
  const piece=chalBoard[r][c];
  if(chalSel){
    const [sr,sc]=chalSel;
    const valid=getMoves(chalBoard,sr,sc);
    if(valid.some(([vr,vc])=>vr===r&&vc===c)){
      chalDoMove(sr,sc,r,c);
    } else if(piece&&isW(piece)){
      chalSel=[r,c]; renderChalBoard(); chalHighlight(r,c);
    } else { chalSel=null; renderChalBoard(); }
  } else if(piece&&isW(piece)){
    chalSel=[r,c]; renderChalBoard(); chalHighlight(r,c);
  }
}
function chalHighlight(r,c){
  document.getElementById(`csq_${r}_${c}`).classList.add('csel');
  getMoves(chalBoard,r,c).forEach(([mr,mc])=>{
    const s=document.getElementById(`csq_${mr}_${mc}`);
    s.classList.add(chalBoard[mr][mc]?'cvc':'cvm');
  });
}
function chalDoMove(fr,fc,tr,tc){
  const moved=chalBoard[fr][fc];
  chalBoard[tr][tc]=moved; chalBoard[fr][fc]='';
  const files=['a','b','c','d','e','f','g','h'];
  const ranks=['8','7','6','5','4','3','2','1'];
  chalMoveLog.push(moved+files[fc]+ranks[fr]+'‚Üí'+files[tc]+ranks[tr]);
  document.getElementById('movesLog').textContent=chalMoveLog.slice(-4).join('  ');
  chalSel=null;
  // promote
  if(moved==='‚ôô'&&tr===0){ chalBoard[tr][tc]='‚ôï'; }
  renderChalBoard();
  const sq=document.getElementById(`csq_${tr}_${tc}`);
  sq.classList.add('cflash'); setTimeout(()=>sq.classList.remove('cflash'),500);
  checkWin(fr,fc,tr,tc,moved);
}
function checkWin(fr,fc,tr,tc,moved){
  const w=chalCurrent.win;
  let won=false;
  if(w.type==='cap'&&tr===w.at[0]&&tc===w.at[1]) won=true;
  if(w.type==='promote'&&moved==='‚ôô'&&tr===w.at[0]&&tc===w.at[1]) won=true;
  if(w.type==='moveto'&&fr===w.from[0]&&fc===w.from[1]&&tr===w.to[0]&&tc===w.to[1]) won=true;
  if(won){
    if(!chalSolved.includes(chalCurrent.id)){ chalSolved.push(chalCurrent.id); document.getElementById('cth_'+chalCurrent.id).classList.add('done'); updateChalProgress(); }
    document.getElementById('resEmoji').textContent='üéâ';
    document.getElementById('resTitle').textContent='Brilliant! Solved!';
    document.getElementById('resMsg').textContent=chalCurrent.msg;
    document.getElementById('resultBlock').classList.add('show');
    document.getElementById('nextBtn').style.display='inline-block';
    confetti();
    let xp=parseInt(localStorage.getItem('vedhTotalXP'))||0;
    localStorage.setItem('vedhTotalXP', xp+15);
  }
}
function showHint(){
  const h=chalCurrent?.hint; if(!h) return;
  document.getElementById('hintIntro').textContent=h.intro;
  const ul=document.getElementById('hintSteps'); ul.innerHTML='';
  h.steps.forEach((s,i)=>{ const li=document.createElement('li'); li.setAttribute('data-n',(i+1)+'.'); li.textContent=s; ul.appendChild(li); });
  document.getElementById('hintBody').style.display='block';
  document.getElementById('hintHide').style.display='none';
}
function resetChal(){ if(chalCurrent) resetChalBoard(); }
function nextChal(){
  const idx=CHALS.findIndex(c=>c.id===chalCurrent?.id);
  const next=CHALS[idx+1]; if(next) loadChal(next.id);
}

/* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
const QUIZ=[
  {q:'Which piece is the most IMPORTANT?',opts:['Queen','King','Rook','Bishop'],ans:1,e:'ü§¥'},
  {q:'Which piece is the most POWERFUL (can move anywhere)?',opts:['King','Rook','Queen','Knight'],ans:2,e:'‚ôõ'},
  {q:'How does a Knight move?',opts:['Diagonally','Straight lines only','L-shape, jumping over pieces','Only forward'],ans:2,e:'‚ôû'},
  {q:'What does CASTLING do?',opts:['Sacrifices the Queen','King moves 2 squares, Rook jumps over','Pawn promotes to Queen','Knight takes the King'],ans:1,e:'üè∞'},
  {q:'What happens when a pawn reaches the other end of the board?',opts:['It gets captured','It goes back to start','It can PROMOTE to any piece!','Nothing happens'],ans:2,e:'‚ôü'},
  {q:'How many points is a Queen worth?',opts:['3 points','5 points','9 points','1 point'],ans:2,e:'‚ôõ'},
  {q:'A FORK is when one piece attacks...',opts:['The opponent\'s Queen only','Two or more enemy pieces at the same time','Nothing ‚Äî it\'s a defensive move','Only Kings'],ans:0,e:'üç¥'},
  {q:'A Bishop always stays on...',opts:['Any square','One color of squares only','The center','The back rank'],ans:1,e:'‚ôù'},
  {q:'What is CHECKMATE?',opts:['The King is in check and cannot escape ‚Äî you WIN!','A draw','The Queen is captured','Pawns reach the end'],ans:0,e:'‚ôö'},
  {q:'What is ZUGZWANG?',opts:['A powerful sacrifice','When any move you make makes things WORSE for you','A special pawn move','Castling queenside'],ans:1,e:'üîÑ'},
  {q:"Scholar's Mate attacks which square?",opts:['d5','e4','f7','g8'],ans:2,e:'üòà'},
  {q:'A SKEWER is the opposite of a...',opts:['Fork','Pin','Checkmate','Promotion'],ans:1,e:'üí•'}
];
let qIdx=0, qScore=0, qAnswered=false, qBadges=[];

function quizStart(){
  qIdx=0; qScore=0; qAnswered=false; qBadges=[];
  document.getElementById('qBar').style.width='0%';
  document.getElementById('qScore').textContent='0';
  document.getElementById('qTotal').textContent='0';
  document.getElementById('badgesRow').innerHTML='';
  document.getElementById('qRestartBtn').style.display='none';
  renderQ();
}
function renderQ(){
  if(qIdx>=QUIZ.length){ quizEnd(); return; }
  const q=QUIZ[qIdx]; qAnswered=false;
  document.getElementById('qEmoji').textContent=q.e;
  document.getElementById('qNum').textContent=`Question ${qIdx+1} of ${QUIZ.length}`;
  document.getElementById('qText').textContent=q.q;
  document.getElementById('qFB').className='qfb';
  document.getElementById('qFB').textContent='';
  document.getElementById('qNextBtn').style.display='none';
  const opts=document.getElementById('qOpts'); opts.innerHTML='';
  q.opts.forEach((o,i)=>{
    const b=document.createElement('button'); b.className='qopt'; b.textContent=o;
    b.onclick=()=>ansQ(i,q.ans,b); opts.appendChild(b);
  });
  document.getElementById('qBar').style.width=((qIdx/QUIZ.length)*100)+'%';
}
function ansQ(picked,correct,btn){
  if(qAnswered) return; qAnswered=true;
  document.querySelectorAll('.qopt').forEach(b=>b.disabled=true);
  const fb=document.getElementById('qFB');
  if(picked===correct){
    btn.classList.add('correct'); qScore++; qBadges.push('‚≠ê');
    fb.textContent='‚úÖ Correct! Brilliant!'; fb.className='qfb show ok';
  } else {
    btn.classList.add('wrong');
    document.querySelectorAll('.qopt')[correct].classList.add('correct');
    fb.textContent='‚ùå Not quite! The answer is: '+QUIZ[qIdx].opts[correct]; fb.className='qfb show bad';
  }
  document.getElementById('qScore').textContent=qScore;
  document.getElementById('qTotal').textContent=qIdx+1;
  document.getElementById('qNextBtn').style.display='inline-block';
}
function quizNext(){ qIdx++; renderQ(); }
function quizEnd(){
  document.getElementById('qNum').textContent='üèÅ Quiz Complete!';
  document.getElementById('qText').textContent=`You scored ${qScore} out of ${QUIZ.length}! ${qScore>=10?'Chess Master! üèÜ':qScore>=7?'Great Job! üåü':'Keep practising! üí™'}`;
  document.getElementById('qEmoji').textContent=qScore>=10?'üèÜ':qScore>=7?'üåü':'üí™';
  document.getElementById('qOpts').innerHTML='';
  document.getElementById('qFB').className='qfb';
  document.getElementById('qNextBtn').style.display='none';
  document.getElementById('qRestartBtn').style.display='inline-block';
  document.getElementById('qBar').style.width='100%';
  document.getElementById('qTotal').textContent=QUIZ.length;
  const br=document.getElementById('badgesRow');
  qBadges.forEach(b=>{ const s=document.createElement('span'); s.className='badge'; s.textContent=b; br.appendChild(s); });
  let xp=parseInt(localStorage.getItem('vedhTotalXP'))||0;
  localStorage.setItem('vedhTotalXP', xp+qScore*3);
  if(qScore===QUIZ.length) confetti();
}

/* ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ */
function confetti(){
  const wrap=document.getElementById('confettiWrap'); wrap.innerHTML='';
  const colors=['#f59e0b','#7c3aed','#22c55e','#ef4444','#38bdf8','#f9a8d4'];
  for(let i=0;i<55;i++){
    const cp=document.createElement('div'); cp.className='cp';
    cp.style.cssText=`left:${Math.random()*100}%;width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;background:${colors[i%colors.length]};animation-delay:${Math.random()*1.2}s;animation-duration:${1.4+Math.random()*.8}s;`;
    wrap.appendChild(cp);
  }
  setTimeout(()=>wrap.innerHTML='', 3500);
}
</script>
</body>
</html>
