<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Kingdom ğŸ‘‘ - Learn, Play & Challenge!</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Baloo+2:wght@400;600;700;800&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --gold:#FFD700;--gold2:#ffb300;
  --deep-blue:#1a237e;--royal-blue:#283593;
  --green:#00e676;--green2:#00c853;--green-dark:#43a047;
  --red:#ff5252;--red-dark:#e53935;
  --orange:#ff9100;--blue:#40c4ff;
  --light-sq:#f0d9b5;--dark-sq:#b58863;
  --card-bg:rgba(255,255,255,0.07);--card-border:rgba(255,255,255,0.14);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Nunito',sans-serif;background:linear-gradient(145deg,#0f0c29 0%,#1a237e 35%,#283593 65%,#1565c0 100%);min-height:100vh;color:#fff;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:radial-gradient(circle,rgba(255,255,255,0.7) 1px,transparent 1px),radial-gradient(circle,rgba(255,255,255,0.35) 1px,transparent 1px);
  background-size:80px 80px,35px 35px;background-position:0 0,18px 18px;}
.container{max-width:1100px;margin:0 auto;padding:16px 16px 50px;position:relative;z-index:1;}

/* HEADER */
header{text-align:center;padding:28px 0 10px;}
.crown-anim{font-size:3rem;display:block;animation:crown-rock 4s ease-in-out infinite;}
@keyframes crown-rock{0%,100%{transform:rotate(-6deg) translateY(0);}50%{transform:rotate(6deg) translateY(-10px);}}
header h1{font-family:'Fredoka One',cursive;font-size:clamp(2.2rem,6vw,4.2rem);color:var(--gold);text-shadow:0 4px 20px rgba(255,215,0,0.45),3px 3px 0 rgba(0,0,0,0.35);letter-spacing:2px;animation:title-float 3.5s ease-in-out infinite;}
@keyframes title-float{0%,100%{transform:translateY(0);}50%{transform:translateY(-7px);}}
header p{color:#b0bce8;font-size:1.05rem;margin-top:6px;font-weight:600;}
.tips-ticker{background:rgba(255,215,0,0.1);border:1.5px solid rgba(255,215,0,0.28);border-radius:12px;padding:10px 20px;text-align:center;margin:14px 0;font-size:0.92rem;color:var(--gold);font-weight:700;}

/* TABS */
.tabs{display:flex;gap:7px;flex-wrap:wrap;justify-content:center;margin:16px 0 20px;}
.tab-btn{font-family:'Fredoka One',cursive;font-size:0.95rem;padding:9px 18px;border:2.5px solid rgba(255,255,255,0.25);border-radius:50px;background:rgba(255,255,255,0.09);color:#fff;cursor:pointer;transition:all 0.28s;backdrop-filter:blur(6px);}
.tab-btn:hover,.tab-btn.active{background:var(--gold);color:var(--deep-blue);border-color:var(--gold);transform:translateY(-3px);box-shadow:0 6px 22px rgba(255,215,0,0.38);}
.section{display:none;animation:fadeUp 0.4s ease;}
.section.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}
.section-title{font-family:'Fredoka One',cursive;font-size:1.9rem;color:var(--gold);text-align:center;margin-bottom:22px;text-shadow:2px 2px 0 rgba(0,0,0,0.3);}
.card{background:var(--card-bg);border:2px solid var(--card-border);border-radius:20px;padding:22px 24px;margin-bottom:18px;backdrop-filter:blur(10px);transition:transform 0.28s,box-shadow 0.28s;}
.card:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(0,0,0,0.3);}
.card h2{font-family:'Fredoka One',cursive;font-size:1.45rem;color:var(--gold);margin-bottom:12px;}
.card p{color:#c5cae9;line-height:1.7;font-size:1rem;margin-bottom:6px;}

/* PIECES */
.pieces-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:13px;margin-bottom:20px;}
.piece-card{background:rgba(255,255,255,0.09);border-radius:16px;padding:18px 12px;text-align:center;cursor:pointer;border:2px solid transparent;transition:all 0.28s;}
.piece-card:hover,.piece-card.selected{border-color:var(--gold);background:rgba(255,215,0,0.14);transform:scale(1.05);}
.piece-emoji{font-size:3rem;display:block;margin-bottom:8px;}
.piece-name{font-family:'Fredoka One',cursive;font-size:1.05rem;color:var(--gold);}
.piece-desc{font-size:0.82rem;color:#b0bce8;margin-top:4px;}
#piece-info{background:rgba(255,215,0,0.09);border:2px solid var(--gold);border-radius:16px;padding:18px 22px;display:none;margin-top:16px;}
#piece-info.show{display:block;animation:fadeUp 0.3s ease;}
#piece-info h3{font-family:'Fredoka One',cursive;color:var(--gold);font-size:1.35rem;margin-bottom:9px;}
#piece-info p{color:#e8eaf6;line-height:1.7;}
#piece-info .moves-diagram{font-size:1.4rem;letter-spacing:3px;margin:9px 0;color:var(--blue);}
.value-row{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px;}
.val-chip{text-align:center;background:rgba(255,255,255,0.09);padding:10px 14px;border-radius:12px;min-width:70px;}
.val-chip .vc-piece{font-size:1.8rem;}
.val-chip .vc-name{font-family:'Fredoka One';color:var(--gold);font-size:0.8rem;}
.val-chip .vc-pts{font-size:1.1rem;color:#fff;margin-top:2px;}

/* PRACTICE BOARD */
.board-container{display:flex;flex-wrap:wrap;gap:22px;align-items:flex-start;justify-content:center;}
.chess-board-practice{display:grid;grid-template-columns:repeat(8,1fr);border:4px solid var(--gold);border-radius:8px;overflow:hidden;box-shadow:0 10px 42px rgba(0,0,0,0.55);flex-shrink:0;}
.psq{width:52px;height:52px;display:flex;align-items:center;justify-content:center;font-size:1.85rem;cursor:pointer;transition:filter 0.18s;position:relative;}
.psq.light{background:var(--light-sq);}
.psq.dark{background:var(--dark-sq);}
.psq.highlight{background:rgba(255,215,0,0.72)!important;}
.psq.valid-move::after{content:'';position:absolute;width:16px;height:16px;border-radius:50%;background:rgba(0,200,80,0.55);border:2px solid rgba(0,230,100,0.9);pointer-events:none;}
.psq:hover{filter:brightness(1.12);}
.board-info{flex:1;min-width:200px;max-width:290px;}
.board-info h3{font-family:'Fredoka One',cursive;color:var(--gold);font-size:1.25rem;margin-bottom:8px;}
.board-info p{color:#b0bce8;font-size:0.9rem;line-height:1.6;margin-bottom:8px;}
#board-message{background:rgba(255,215,0,0.12);border:2px solid rgba(255,215,0,0.35);border-radius:12px;padding:10px 14px;font-weight:700;color:var(--gold);font-size:0.9rem;}
#turn-display{font-family:'Fredoka One',cursive;font-size:1.1rem;color:#fff;margin-top:5px;}
.pboard-btn{font-family:'Fredoka One',cursive;font-size:0.88rem;padding:8px 16px;border:none;border-radius:50px;cursor:pointer;margin:4px 4px 4px 0;transition:all 0.25s;}
.pboard-btn.gold{background:var(--gold);color:var(--deep-blue);}
.pboard-btn.green{background:var(--green-dark);color:#fff;}
.pboard-btn:hover{transform:translateY(-2px);box-shadow:0 5px 14px rgba(0,0,0,0.3);}

/* OPENINGS */
.opening-card{background:var(--card-bg);border:2px solid var(--card-border);border-radius:16px;padding:18px;margin-bottom:14px;display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap;transition:all 0.28s;}
.opening-card:hover{background:rgba(255,255,255,0.11);transform:translateX(5px);}
.opening-icon{font-size:2.8rem;flex-shrink:0;}
.opening-content h3{font-family:'Fredoka One',cursive;color:var(--gold);font-size:1.15rem;margin-bottom:4px;}
.moves-tag{font-family:monospace;font-size:0.88rem;color:#90caf9;background:rgba(0,0,0,0.3);padding:4px 10px;border-radius:8px;display:inline-block;margin:4px 0;}
.opening-content p{color:#b0bce8;font-size:0.9rem;line-height:1.6;}
.diff-tag{display:inline-block;padding:2px 11px;border-radius:20px;font-size:0.72rem;font-weight:700;margin-left:6px;}
.tag-beginner{background:rgba(0,230,118,0.2);color:var(--green);}
.tag-intermediate{background:rgba(255,145,0,0.2);color:var(--orange);}
.tag-advanced{background:rgba(255,82,82,0.2);color:var(--red);}

/* â•â•â• STRATEGIES with mini boards â•â•â• */
.strategies-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(330px,1fr));gap:18px;}
.strategy-card{background:var(--card-bg);border-radius:18px;padding:20px;border-left:5px solid var(--gold);transition:all 0.28s;}
.strategy-card:hover{transform:translateY(-4px);background:rgba(255,255,255,0.11);box-shadow:0 10px 30px rgba(0,0,0,0.35);}
.strategy-card h3{font-family:'Fredoka One',cursive;color:var(--gold);font-size:1.1rem;margin-bottom:4px;}
.strategy-card p{color:#b0bce8;font-size:0.85rem;line-height:1.6;margin-bottom:10px;}

/* â•â•â• TRICKS with demo boards â•â•â• */
.tricks-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:18px;}
.trick-card{background:var(--card-bg);border:2px solid var(--card-border);border-radius:18px;padding:20px;transition:all 0.28s;}
.trick-card:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(0,0,0,0.35);}
.trick-card h2{font-family:'Fredoka One',cursive;font-size:1.3rem;color:var(--gold);margin-bottom:8px;}
.trick-card p{color:#c5cae9;line-height:1.65;font-size:0.9rem;margin-bottom:12px;}

/* shared mini board */
.mini-board-wrap{position:relative;display:inline-block;margin-top:4px;}
.mini-board{display:grid;grid-template-columns:repeat(8,34px);border:2.5px solid rgba(255,215,0,0.55);border-radius:5px;overflow:hidden;box-shadow:0 4px 18px rgba(0,0,0,0.5);}
.msq{width:34px;height:34px;display:flex;align-items:center;justify-content:center;font-size:1.25rem;position:relative;transition:background 0.25s;}
.msq.light{background:var(--light-sq);}
.msq.dark{background:var(--dark-sq);}
.msq.mhl{background:rgba(255,215,0,0.7)!important;}
.msq.matt{background:rgba(255,60,60,0.55)!important;}
.msq.mpath{background:rgba(0,220,110,0.4)!important;}
.msq.mctrl{background:rgba(255,165,0,0.3)!important;}
.msq.mfrom{background:rgba(100,180,255,0.55)!important;}

/* Animated floating piece */
.float-piece{
  position:absolute;font-size:1.25rem;
  line-height:1;pointer-events:none;z-index:20;
  transition:left 0.7s cubic-bezier(0.4,0,0.2,1),top 0.7s cubic-bezier(0.4,0,0.2,1);
  width:34px;height:34px;display:flex;align-items:center;justify-content:center;
}

.anim-controls{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;align-items:center;}
.anim-btn{font-family:'Fredoka One',cursive;font-size:0.78rem;padding:5px 14px;border:none;border-radius:20px;cursor:pointer;transition:all 0.22s;}
.anim-btn-play{background:linear-gradient(135deg,var(--green2),#00bfa5);color:#002a1a;}
.anim-btn-play:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(0,200,100,0.4);}
.anim-btn-reset{background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);}
.anim-step-label{font-size:0.75rem;color:#8090b8;font-style:italic;}

/* CHALLENGES */
.challenge-progress-bar{background:rgba(255,255,255,0.1);border-radius:20px;height:11px;overflow:hidden;border:1px solid rgba(255,255,255,0.14);margin:0 0 6px;}
.challenge-progress-fill{height:100%;background:linear-gradient(90deg,var(--green2),var(--gold),var(--orange));border-radius:20px;transition:width 0.6s;box-shadow:0 0 10px rgba(0,230,118,0.45);}
.challenge-progress-text{text-align:center;font-size:0.82rem;color:#8090b8;margin-bottom:16px;}
.challenge-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:8px;margin-bottom:20px;}
.ch-thumb{background:var(--card-bg);border:2px solid var(--card-border);border-radius:12px;padding:8px 4px;text-align:center;cursor:pointer;transition:all 0.22s;position:relative;overflow:hidden;}
.ch-thumb:hover{transform:translateY(-4px);border-color:var(--gold);box-shadow:0 8px 22px rgba(255,215,0,0.2);}
.ch-thumb.ch-active{border-color:var(--gold);background:rgba(255,215,0,0.13);}
.ch-thumb.ch-solved{border-color:var(--green);background:rgba(0,230,118,0.1);}
.ch-thumb.ch-solved::after{content:'âœ“';position:absolute;top:2px;right:4px;color:var(--green);font-weight:800;font-size:0.8rem;}
.ch-thumb .th-icon{font-size:1.4rem;display:block;margin-bottom:2px;}
.ch-thumb .th-num{font-family:'Fredoka One';font-size:0.68rem;color:var(--gold);}
.ch-thumb .th-diff{font-size:0.58rem;padding:1px 6px;border-radius:20px;display:inline-block;margin-top:2px;font-weight:700;}
.easy-tag{background:rgba(0,230,118,0.2);color:var(--green);}
.medium-tag{background:rgba(255,145,0,0.2);color:var(--orange);}
.hard-tag{background:rgba(255,82,82,0.2);color:var(--red);}
.chal-game-area{display:grid;grid-template-columns:auto 1fr;gap:18px;align-items:start;}
@media(max-width:640px){.chal-game-area{grid-template-columns:1fr;}}
.board-label-row{display:flex;padding-left:20px;font-family:'Fredoka One';font-size:0.72rem;color:#607090;}
.board-label-row span{width:52px;text-align:center;}
.board-row-wrap{display:flex;align-items:center;}
.board-rank-lbl{width:18px;font-family:'Fredoka One';font-size:0.72rem;color:#607090;text-align:right;margin-right:2px;}
.chal-board{display:grid;grid-template-columns:repeat(8,52px);border:3px solid rgba(255,215,0,0.6);border-radius:6px;overflow:hidden;box-shadow:0 0 38px rgba(0,0,0,0.6);}
.csq{width:52px;height:52px;display:flex;align-items:center;justify-content:center;font-size:1.85rem;cursor:pointer;transition:filter 0.15s;position:relative;user-select:none;}
.csq.light{background:var(--light-sq);}
.csq.dark{background:var(--dark-sq);}
.csq.csel{outline:3px solid var(--gold);outline-offset:-3px;background:#e8c84a!important;}
.csq.cvm::after{content:'';position:absolute;width:17px;height:17px;border-radius:50%;background:rgba(0,200,80,0.52);border:2px solid rgba(0,230,100,0.9);pointer-events:none;}
.csq.cvc::after{content:'';position:absolute;inset:3px;border-radius:3px;border:3px solid rgba(255,80,80,0.85);pointer-events:none;}
.csq.ctarget{animation:pulse-tgt 1s ease-in-out infinite;}
@keyframes pulse-tgt{0%,100%{box-shadow:inset 0 0 0 3px rgba(255,215,0,0.8);}50%{box-shadow:inset 0 0 0 3px rgba(255,100,0,1),inset 0 0 12px rgba(255,150,0,0.4);}}
.csq.cflash{animation:flash-g 0.55s ease;}
@keyframes flash-g{0%,100%{filter:brightness(1);}50%{filter:brightness(2) saturate(2) hue-rotate(80deg);}}
.csq:hover{filter:brightness(1.1);}
.chal-side{min-width:0;}
.chal-header{display:flex;align-items:center;gap:10px;background:var(--card-bg);border:2px solid var(--card-border);border-radius:16px;padding:14px 18px;margin-bottom:12px;}
.chal-big-icon{font-size:2.5rem;flex-shrink:0;}
.chal-meta h2{font-family:'Fredoka One';font-size:1.25rem;color:var(--gold);line-height:1.2;}
.chal-diff-badge{display:inline-block;padding:2px 11px;border-radius:20px;font-size:0.72rem;font-weight:700;margin-top:3px;}
.mission-box{background:linear-gradient(135deg,rgba(0,230,118,0.08),rgba(0,200,83,0.04));border:2px solid rgba(0,230,118,0.3);border-radius:13px;padding:13px 15px;margin-bottom:10px;}
.mission-box h3{color:var(--green);font-family:'Fredoka One';font-size:0.95rem;margin-bottom:5px;}
.mission-box p{color:#c8d5e0;font-size:0.88rem;line-height:1.6;}
.target-tag{display:inline-flex;align-items:center;gap:5px;background:rgba(255,82,82,0.15);border:1.5px solid rgba(255,82,82,0.4);border-radius:10px;padding:4px 10px;font-size:0.9rem;font-weight:700;color:#ffa0a0;margin-top:7px;}
.hint-box{background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,145,0,0.04));border:2px solid rgba(255,215,0,0.25);border-radius:13px;padding:13px 15px;margin-bottom:10px;}
.hint-box h3{color:var(--gold);font-family:'Fredoka One';font-size:0.95rem;margin-bottom:5px;}
.hint-reveal-btn{cursor:pointer;font-size:0.75rem;background:rgba(255,215,0,0.15);padding:2px 10px;border-radius:20px;margin-left:6px;border:none;color:var(--gold);font-family:'Nunito';font-weight:700;}
.hint-reveal-btn:hover{background:rgba(255,215,0,0.28);}
.hint-intro{color:#ddd0a0;font-size:0.88rem;line-height:1.6;}
.hint-steps{list-style:none;margin-top:7px;}
.hint-steps li{padding:4px 0 4px 20px;position:relative;color:#c8d5e0;font-size:0.84rem;line-height:1.5;border-bottom:1px solid rgba(255,255,255,0.06);}
.hint-steps li::before{content:attr(data-n);position:absolute;left:0;color:var(--gold);font-weight:800;}
.chal-btn-row{display:flex;gap:7px;flex-wrap:wrap;margin-bottom:10px;}
.chal-btn{font-family:'Fredoka One';font-weight:700;font-size:0.9rem;padding:8px 17px;border:none;border-radius:50px;cursor:pointer;transition:all 0.22s;}
.chal-btn-reset{background:rgba(255,255,255,0.09);color:#ccc;border:2px solid rgba(255,255,255,0.16);}
.chal-btn-reset:hover{background:rgba(255,255,255,0.16);transform:translateY(-2px);}
.chal-btn-next{background:linear-gradient(135deg,var(--green2),#00bfa5);color:#002a1a;}
.chal-btn-next:hover{transform:translateY(-2px);box-shadow:0 5px 14px rgba(0,200,100,0.38);}
.result-box{border-radius:13px;padding:14px;text-align:center;margin-bottom:10px;display:none;animation:fadeUp 0.38s ease;}
.result-box.rsuccess{background:rgba(0,230,118,0.11);border:2px solid rgba(0,230,118,0.4);display:block;}
.result-box .r-big{font-size:2.3rem;}
.result-box h3{font-family:'Fredoka One';font-size:1.2rem;margin:5px 0 3px;}
.result-box p{color:#c8d5e0;font-size:0.87rem;}
.moves-log{background:rgba(0,0,0,0.28);border-radius:10px;padding:9px 13px;font-size:0.8rem;color:#7080a8;line-height:1.9;min-height:30px;border:1px solid rgba(255,255,255,0.07);}
.moves-log span{color:var(--blue);font-weight:700;}

/* QUIZ */
.quiz-score{font-family:'Fredoka One',cursive;font-size:1.25rem;color:var(--gold);text-align:center;margin-bottom:16px;}
.quiz-progress{background:rgba(255,255,255,0.12);border-radius:20px;height:10px;overflow:hidden;max-width:320px;margin:8px auto 0;}
.quiz-progress-fill{height:100%;background:linear-gradient(90deg,var(--green2),var(--gold));border-radius:20px;transition:width 0.5s ease;}
.quiz-box{background:var(--card-bg);border:2px solid var(--card-border);border-radius:20px;padding:28px;text-align:center;max-width:600px;margin:0 auto;}
.quiz-box h3{font-family:'Fredoka One',cursive;color:var(--gold);font-size:1.7rem;margin-bottom:16px;}
.quiz-question{font-size:1.1rem;color:#e0e8ff;margin-bottom:22px;line-height:1.6;}
.quiz-options{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px;}
.quiz-opt{padding:13px;border:2px solid rgba(255,255,255,0.18);border-radius:12px;background:rgba(255,255,255,0.07);color:#fff;font-size:0.97rem;font-weight:700;cursor:pointer;transition:all 0.26s;font-family:'Nunito',sans-serif;}
.quiz-opt:hover{border-color:var(--gold);background:rgba(255,215,0,0.14);}
.quiz-opt.correct{background:var(--green-dark);border-color:var(--green-dark);}
.quiz-opt.wrong{background:var(--red-dark);border-color:var(--red-dark);}
.quiz-feedback{padding:13px;border-radius:12px;font-weight:700;font-size:1rem;margin-bottom:14px;display:none;}
.quiz-feedback.show{display:block;animation:fadeUp 0.3s;}
.quiz-feedback.qcorrect{background:rgba(67,160,71,0.28);border:2px solid var(--green-dark);}
.quiz-feedback.qwrong{background:rgba(229,57,53,0.22);border:2px solid var(--red-dark);}
.badge{display:inline-block;font-size:1.7rem;margin:4px;cursor:default;transition:transform 0.28s;}
.badge:hover{transform:scale(1.3) rotate(10deg);}
.confetti-wrap{position:fixed;inset:0;pointer-events:none;z-index:999;}
.confetti-piece{position:absolute;border-radius:2px;animation:confetti-fall 2s ease-in forwards;}
@keyframes confetti-fall{0%{transform:translateY(-80px) rotate(0deg);opacity:1;}100%{transform:translateY(110vh) rotate(740deg);opacity:0;}}
@media(max-width:600px){
  .psq,.csq{width:40px;height:40px;font-size:1.35rem;}
  .chess-board-practice{grid-template-columns:repeat(8,40px);}
  .chal-board{grid-template-columns:repeat(8,40px);}
  .board-label-row span{width:40px;}
  .quiz-options{grid-template-columns:1fr;}
  .tab-btn{font-size:0.8rem;padding:7px 12px;}
  .mini-board{grid-template-columns:repeat(8,28px);}
  .msq,.float-piece{width:28px;height:28px;font-size:1rem;}
}
</style>
</head>
<body>
<div class="container">

<header>
  <span class="crown-anim">â™›</span>
  <h1>Chess Kingdom</h1>
  <p>Learn â€¢ Practice â€¢ Challenge â€¢ Master! ğŸ‘‘</p>
</header>
<div class="tips-ticker" id="tipsTicker">ğŸ’¡ Tip: Control the center with your pawns on e4 and d4!</div>

<div class="tabs">
  <button class="tab-btn active" onclick="showTab('pieces',this)">â™Ÿ Pieces</button>
  <button class="tab-btn" onclick="showTab('board',this)">ğŸ® Practice</button>
  <button class="tab-btn" onclick="showTab('openings',this)">ğŸ“– Openings</button>
  <button class="tab-btn" onclick="showTab('strategies',this)">ğŸ§  Strategies</button>
  <button class="tab-btn" onclick="showTab('tricks',this)">âš¡ Tricks</button>
  <button class="tab-btn" onclick="showTab('challenges',this)">ğŸ† Challenges</button>
  <button class="tab-btn" onclick="showTab('quiz',this)">â“ Quiz</button>
</div>

<!-- PIECES -->
<div class="section active" id="section-pieces">
  <h2 class="section-title">Meet the Chess Pieces! â™Ÿ</h2>
  <div class="pieces-grid">
    <div class="piece-card" onclick="showPieceInfo('king')"><span class="piece-emoji">â™š</span><div class="piece-name">King</div><div class="piece-desc">Most important!</div></div>
    <div class="piece-card" onclick="showPieceInfo('queen')"><span class="piece-emoji">â™›</span><div class="piece-name">Queen</div><div class="piece-desc">Most powerful!</div></div>
    <div class="piece-card" onclick="showPieceInfo('rook')"><span class="piece-emoji">â™œ</span><div class="piece-name">Rook</div><div class="piece-desc">Castle warrior!</div></div>
    <div class="piece-card" onclick="showPieceInfo('bishop')"><span class="piece-emoji">â™</span><div class="piece-name">Bishop</div><div class="piece-desc">Diagonal master!</div></div>
    <div class="piece-card" onclick="showPieceInfo('knight')"><span class="piece-emoji">â™</span><div class="piece-name">Knight</div><div class="piece-desc">L-shape jumper! ğŸ´</div></div>
    <div class="piece-card" onclick="showPieceInfo('pawn')"><span class="piece-emoji">â™Ÿ</span><div class="piece-name">Pawn</div><div class="piece-desc">Little hero!</div></div>
  </div>
  <div id="piece-info">
    <h3 id="pi-name"></h3><p id="pi-desc"></p>
    <div class="moves-diagram" id="pi-moves"></div><p id="pi-tip"></p>
  </div>
  <div class="card" style="margin-top:18px;">
    <h2>âš–ï¸ Piece Values</h2><p>Trade wisely using these point values!</p>
    <div class="value-row">
      <div class="val-chip"><div class="vc-piece">â™Ÿ</div><div class="vc-name">Pawn</div><div class="vc-pts">1 â­</div></div>
      <div class="val-chip"><div class="vc-piece">â™</div><div class="vc-name">Knight</div><div class="vc-pts">3 â­</div></div>
      <div class="val-chip"><div class="vc-piece">â™</div><div class="vc-name">Bishop</div><div class="vc-pts">3 â­</div></div>
      <div class="val-chip"><div class="vc-piece">â™œ</div><div class="vc-name">Rook</div><div class="vc-pts">5 â­</div></div>
      <div class="val-chip"><div class="vc-piece">â™›</div><div class="vc-name">Queen</div><div class="vc-pts">9 â­</div></div>
    </div>
  </div>
</div>

<!-- PRACTICE BOARD -->
<div class="section" id="section-board">
  <h2 class="section-title">ğŸ® Practice Board</h2>
  <div class="board-container">
    <div>
      <div class="chess-board-practice" id="practiceBoard"></div>
      <div style="margin-top:10px;display:flex;flex-wrap:wrap;gap:6px;">
        <button class="pboard-btn gold" onclick="resetPracticeBoard()">ğŸ”„ Reset</button>
        <button class="pboard-btn green" onclick="showPracticeSetup('scholars')">âš¡ Scholar's Mate</button>
        <button class="pboard-btn green" onclick="showPracticeSetup('castling')">ğŸ° Castling Demo</button>
      </div>
    </div>
    <div class="board-info">
      <h3>How to Play</h3>
      <p>ğŸ‘† Click a piece to select it, then click a highlighted dot to move!</p>
      <div id="board-message">ğŸ® Click any White piece to get started!</div>
      <div style="margin-top:12px;"><h3>Turn</h3><div id="turn-display">â¬œ White's turn</div></div>
      <div style="margin-top:12px;"><h3>Captured</h3>
        <div id="captured-white" style="min-height:26px;font-size:1.1rem;margin-top:4px;"></div>
        <div id="captured-black" style="min-height:26px;font-size:1.1rem;"></div>
      </div>
    </div>
  </div>
</div>

<!-- OPENINGS -->
<div class="section" id="section-openings">
  <h2 class="section-title">ğŸ“– Famous Openings</h2>
  <div class="opening-card"><div class="opening-icon">ğŸ¹</div><div class="opening-content"><h3>Italian Game <span class="diff-tag tag-beginner">Beginner</span></h3><div class="moves-tag">1.e4 e5 2.Nf3 Nc6 3.Bc4</div><p>One of the oldest openings! White attacks f7 â€” the weakest square near Black's king.</p></div></div>
  <div class="opening-card"><div class="opening-icon">ğŸ›¡ï¸</div><div class="opening-content"><h3>Sicilian Defence <span class="diff-tag tag-intermediate">Intermediate</span></h3><div class="moves-tag">1.e4 c5</div><p>The most popular opening in chess! Black fights back without mirroring. Creates an unbalanced, exciting game!</p></div></div>
  <div class="opening-card"><div class="opening-icon">ğŸŒ²</div><div class="opening-content"><h3>London System <span class="diff-tag tag-beginner">Beginner</span></h3><div class="moves-tag">1.d4 d5 2.Bf4 Nf6 3.e3</div><p>Solid and reliable for White. Build a strong pawn structure without memorising too much!</p></div></div>
  <div class="opening-card"><div class="opening-icon">ğŸ¦…</div><div class="opening-content"><h3>King's Indian Defence <span class="diff-tag tag-intermediate">Intermediate</span></h3><div class="moves-tag">1.d4 Nf6 2.c4 g6 3.Nc3 Bg7</div><p>Black lets White take the center, then counterattacks! Loved by aggressive players!</p></div></div>
  <div class="opening-card"><div class="opening-icon">ğŸ­</div><div class="opening-content"><h3>French Defence <span class="diff-tag tag-beginner">Beginner</span></h3><div class="moves-tag">1.e4 e6 2.d4 d5</div><p>Black builds a solid wall of pawns! Great for players who like patient defending.</p></div></div>
  <div class="opening-card"><div class="opening-icon">ğŸ”¥</div><div class="opening-content"><h3>King's Gambit <span class="diff-tag tag-intermediate">Intermediate</span></h3><div class="moves-tag">1.e4 e5 2.f4</div><p>White gives away a pawn for super-fast development and a fierce attack!</p></div></div>
  <div class="card"><h2>ğŸŒŸ Golden Opening Rules</h2>
    <p>1. <strong>Control the center</strong> â€” squares e4, d4, e5, d5 are most important!</p>
    <p>2. <strong>Develop your pieces</strong> â€” get knights and bishops out early!</p>
    <p>3. <strong>Castle your king to safety</strong> â€” don't leave your king in the center!</p>
    <p>4. <strong>Don't move the same piece twice</strong> â€” unless there's a great reason!</p>
    <p>5. <strong>Connect your rooks</strong> â€” clear the back rank so rooks work together!</p>
  </div>
</div>

<!-- STRATEGIES -->
<div class="section" id="section-strategies">
  <h2 class="section-title">ğŸ§  Chess Strategies</h2>
  <div class="strategies-grid" id="strategiesGrid"></div>
</div>

<!-- TRICKS -->
<div class="section" id="section-tricks">
  <h2 class="section-title">âš¡ Tactics &amp; Tricks</h2>
  <div class="tricks-grid" id="tricksGrid"></div>
</div>

<!-- CHALLENGES -->
<div class="section" id="section-challenges">
  <h2 class="section-title">ğŸ† Chess Challenges!</h2>
  <p style="text-align:center;color:#8090b8;font-size:0.88rem;margin-bottom:10px;">ğŸ¯ Make the correct move â€¢ ğŸ’¡ Use hints â€¢ âœ… Solve all 20!</p>
  <div class="challenge-progress-bar"><div class="challenge-progress-fill" id="chalFill" style="width:0%"></div></div>
  <div class="challenge-progress-text" id="chalProgressText">0 of 20 challenges solved</div>
  <div class="challenge-grid" id="challengeGrid"></div>
  <div class="chal-game-area">
    <div>
      <div class="board-label-row"><span>a</span><span>b</span><span>c</span><span>d</span><span>e</span><span>f</span><span>g</span><span>h</span></div>
      <div id="chalBoardRows"></div>
    </div>
    <div class="chal-side">
      <div class="chal-header"><div class="chal-big-icon" id="chalIcon">ğŸ¯</div><div class="chal-meta"><h2 id="chalTitle">Pick a Challenge!</h2><span class="chal-diff-badge easy-tag" id="chalDiff">Easy</span></div></div>
      <div class="mission-box"><h3>ğŸ¯ Your Mission</h3><p id="chalMission">Choose any challenge from the grid above to begin!</p><div id="chalTargetTag"></div></div>
      <div class="hint-box"><h3>ğŸ’¡ Hint <button class="hint-reveal-btn" id="hintRevealBtn" onclick="revealHint()">Show Hint ğŸ‘</button></h3>
        <div id="hintContent" style="display:none;"><p class="hint-intro" id="hintIntro"></p><ul class="hint-steps" id="hintSteps"></ul></div>
        <p id="hintHiddenMsg" style="color:#607090;font-size:0.85rem;">Click "Show Hint" if you're stuck!</p>
      </div>
      <div class="chal-btn-row">
        <button class="chal-btn chal-btn-reset" onclick="resetChallenge()">ğŸ”„ Reset</button>
        <button class="chal-btn chal-btn-next" id="chalNextBtn" onclick="nextChallenge()" style="display:none;">Next â¡ï¸</button>
      </div>
      <div class="result-box" id="chalResultBox"><div class="r-big" id="chalResultEmoji"></div><h3 id="chalResultTitle"></h3><p id="chalResultMsg"></p></div>
      <div class="moves-log" id="chalMovesLog">Waiting for your first moveâ€¦</div>
    </div>
  </div>
</div>

<!-- QUIZ -->
<div class="section" id="section-quiz">
  <h2 class="section-title">â“ Chess Quiz Challenge!</h2>
  <div class="quiz-score">â­ Score: <span id="quizScore">0</span> / <span id="quizTotal">0</span>
    <div class="quiz-progress"><div class="quiz-progress-fill" id="quizProgressFill" style="width:0%"></div></div>
  </div>
  <div class="quiz-box">
    <div id="quizEmoji" style="font-size:2.8rem;margin-bottom:8px;">ğŸ¤”</div>
    <h3 id="quizQNum">Question 1 of 12</h3>
    <div class="quiz-question" id="quizQuestion"></div>
    <div class="quiz-options" id="quizOptions"></div>
    <div class="quiz-feedback" id="quizFeedback"></div>
    <button style="font-family:'Fredoka One';background:var(--gold);color:var(--deep-blue);border:none;padding:9px 22px;border-radius:50px;cursor:pointer;font-size:1rem;margin:4px;display:none;" id="quizNextBtn" onclick="quizNext()">Next Question â¡ï¸</button>
    <button style="font-family:'Fredoka One';background:var(--green-dark);color:#fff;border:none;padding:9px 22px;border-radius:50px;cursor:pointer;font-size:1rem;margin:4px;display:none;" id="quizRestartBtn" onclick="quizRestart()">Play Again! ğŸ”„</button>
  </div>
  <div style="text-align:center;margin-top:18px;">
    <div id="badgesLabel" style="font-size:0.9rem;color:#7080a8;margin-bottom:8px;">Earn badges by answering correctly!</div>
    <div id="earnedBadges"></div>
  </div>
</div>

</div>
<div class="confetti-wrap" id="confettiWrap"></div>

<script>
'use strict';
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TIPS=["ğŸ’¡ Control the center with pawns on e4 and d4!","ğŸ’¡ Knights are best in the center, not on the edge!","ğŸ° Castle early to keep your king safe!","â­ The queen is worth 9 points â€” protect her!","ğŸ¯ Always look for forks, pins, and skewers!","â™Ÿ Passed pawns become queens â€” push them forward!","ğŸ‘ï¸ Always ask: what can my opponent do next turn?","ğŸ”— Connect your rooks by castling!","ğŸ§  Have a plan every move â€” don't just react!","âš¡ Discovered attacks are very powerful surprises!","ğŸ† A knight on the rim is dim â€” keep it central!","ğŸŒŸ When a pawn reaches the last rank, it becomes a queen!"];
let tipIdx=0;
setInterval(()=>{tipIdx=(tipIdx+1)%TIPS.length;document.getElementById('tipsTicker').textContent=TIPS[tipIdx];},5000);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let practiceBoardInit=false,quizInit=false,challengesInit=false,strategiesInit=false,tricksInit=false;
function showTab(id,btn){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('section-'+id).classList.add('active');
  btn.classList.add('active');
  if(id==='board'&&!practiceBoardInit){initPracticeBoard();practiceBoardInit=true;}
  if(id==='quiz'&&!quizInit){quizStart();quizInit=true;}
  if(id==='challenges'&&!challengesInit){initChallenges();challengesInit=true;}
  if(id==='strategies'&&!strategiesInit){buildStrategies();strategiesInit=true;}
  if(id==='tricks'&&!tricksInit){buildTricks();tricksInit=true;}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PIECE INFO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PIECE_DATA={
  king:{name:"ğŸ‘‘ King â€” The Royal Leader",desc:"The king is the most important piece! If your king is trapped (checkmate), you lose. The king can move one square in any direction â€” but keep it safe!",moves:"â†‘ â†— â†’ â†˜ â†“ â†™ â† â†–",tip:"ğŸ’¡ Keep your king safe! Castle early. In the endgame, march your king forward to help your pawns."},
  queen:{name:"â™› Queen â€” The Mighty Warrior",desc:"The most powerful piece on the board! The queen can move any number of squares in any direction â€” like a rook and bishop combined. Worth 9 pawns!",moves:"â†‘â†‘ â†—â†— â†’â†’ â†˜â†˜ â†“â†“ â†™â†™ â†â† â†–â†–",tip:"ğŸ’¡ Don't bring your queen out too early â€” she can be attacked by smaller pieces!"},
  rook:{name:"â™œ Rook â€” The Castle Tower",desc:"The rook moves any number of squares horizontally or vertically. Rooks are most powerful on open files. Two rooks working together are incredibly strong!",moves:"â†‘â†‘â†‘  â†“â†“â†“  â†â†â†  â†’â†’â†’",tip:"ğŸ’¡ Place rooks on open files and connect them by castling. Two rooks on the 7th rank often win the game!"},
  bishop:{name:"â™ Bishop â€” The Diagonal Master",desc:"The bishop moves diagonally any number of squares. Each bishop stays on one colour for the whole game! Bishops love open positions with long diagonals.",moves:"â†—â†—  â†˜â†˜  â†™â†™  â†–â†–",tip:"ğŸ’¡ Avoid putting your pawns on the same colour as your bishop â€” it blocks your own piece!"},
  knight:{name:"â™ Knight â€” The L-Shape Jumper",desc:"The knight moves in an L-shape: 2 squares one way, 1 square sideways. It's the ONLY piece that can jump over other pieces! Very tricky and surprising!",moves:"Moves in an L-shape â™ â€” 2+1 or 1+2",tip:"ğŸ’¡ A knight on the rim is dim! Keep knights near the center where they control the most squares."},
  pawn:{name:"â™Ÿ Pawn â€” The Little Hero",desc:"Pawns move forward one square (or two on their first move!) and capture diagonally. If a pawn reaches the other end, it becomes a queen! That's PROMOTION! ğŸ‰",moves:"â†‘ (forward)  â†—â†– (capture diagonally)",tip:"ğŸ’¡ If your pawn reaches the other side, promote it to a queen! Passed pawns are very powerful!"}
};
function showPieceInfo(p){
  const d=PIECE_DATA[p];
  document.getElementById('pi-name').textContent=d.name;
  document.getElementById('pi-desc').textContent=d.desc;
  document.getElementById('pi-moves').textContent=d.moves;
  document.getElementById('pi-tip').textContent=d.tip;
  const box=document.getElementById('piece-info');
  box.classList.add('show');
  box.scrollIntoView({behavior:'smooth',block:'nearest'});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRACTICE BOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const INIT_BOARD=[['â™œ','â™','â™','â™›','â™š','â™','â™','â™œ'],['â™Ÿ','â™Ÿ','â™Ÿ','â™Ÿ','â™Ÿ','â™Ÿ','â™Ÿ','â™Ÿ'],['','','','','','','',''],['','','','','','','',''],['','','','','','','',''],['','','','','','','',''],['â™™','â™™','â™™','â™™','â™™','â™™','â™™','â™™'],['â™–','â™˜','â™—','â™•','â™”','â™—','â™˜','â™–']];
let pBoard=[],pSelected=null,pTurn='white',pCapW=[],pCapB=[];
const WPIECES=['â™”','â™•','â™–','â™—','â™˜','â™™'],BPIECES=['â™š','â™›','â™œ','â™','â™','â™Ÿ'];
const isW=p=>WPIECES.includes(p),isB=p=>BPIECES.includes(p);

function initPracticeBoard(){
  pBoard=INIT_BOARD.map(r=>[...r]);
  const el=document.getElementById('practiceBoard');el.innerHTML='';
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const sq=document.createElement('div');
    sq.className='psq '+((r+c)%2===0?'light':'dark');
    sq.id=`psq_${r}_${c}`;sq.onclick=()=>practiceClick(r,c);el.appendChild(sq);
  }
  renderPracticeBoard();
}
function renderPracticeBoard(){
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const sq=document.getElementById(`psq_${r}_${c}`);
    sq.className='psq '+((r+c)%2===0?'light':'dark');
    sq.textContent=pBoard[r][c]||'';
  }
  document.getElementById('turn-display').textContent=pTurn==='white'?'â¬œ White\'s turn':'â¬› Black\'s turn';
  document.getElementById('captured-white').textContent='White captured: '+pCapW.join('');
  document.getElementById('captured-black').textContent='Black captured: '+pCapB.join('');
}
function practiceClick(r,c){
  const piece=pBoard[r][c];
  const isCurrentTeam=pTurn==='white'?isW(piece):isB(piece);
  if(pSelected){
    const[sr,sc]=pSelected;
    const valid=getMovesForPiece(pBoard,sr,sc);
    const ok=valid.some(([vr,vc])=>vr===r&&vc===c);
    if(ok){
      const cap=pBoard[r][c];
      if(cap){isW(cap)?pCapB.push(cap):pCapW.push(cap);}
      pBoard[r][c]=pBoard[sr][sc];pBoard[sr][sc]='';
      if(pBoard[r][c]==='â™™'&&r===0)pBoard[r][c]='â™•';
      if(pBoard[r][c]==='â™Ÿ'&&r===7)pBoard[r][c]='â™›';
      pSelected=null;pTurn=pTurn==='white'?'black':'white';
      document.getElementById('board-message').textContent=pTurn==='white'?'â¬œ White to move!':'â¬› Black to move!';
      renderPracticeBoard();
    }else if(isCurrentTeam){pSelected=[r,c];renderPracticeBoard();highlightPractice(r,c);}
    else{pSelected=null;renderPracticeBoard();}
  }else if(isCurrentTeam){
    pSelected=[r,c];renderPracticeBoard();highlightPractice(r,c);
    document.getElementById('board-message').textContent=pieceName(piece)+' selected! Click a green dot to move.';
  }
}
function highlightPractice(r,c){
  document.getElementById(`psq_${r}_${c}`).classList.add('highlight');
  getMovesForPiece(pBoard,r,c).forEach(([mr,mc])=>document.getElementById(`psq_${mr}_${mc}`).classList.add('valid-move'));
}
function resetPracticeBoard(){
  pBoard=INIT_BOARD.map(r=>[...r]);pSelected=null;pTurn='white';pCapW=[];pCapB=[];
  document.getElementById('board-message').textContent='ğŸ® Click any White piece to get started!';
  renderPracticeBoard();
}
function showPracticeSetup(type){
  resetPracticeBoard();
  if(type==='scholars'){
    pBoard[4][4]='â™™';pBoard[6][4]='';pBoard[3][4]='â™Ÿ';pBoard[1][4]='';
    pBoard[4][2]='â™—';pBoard[7][5]='';
    document.getElementById('board-message').textContent="ğŸ¯ Scholar's Mate setup! White threatens Qh5 then Qxf7. Defend with Nf6!";
  }else if(type==='castling'){
    pBoard[7][5]='';pBoard[7][6]='';
    document.getElementById('board-message').textContent="ğŸ° Try castling! Move the King two squares right â€” the Rook will jump over!";
  }
  renderPracticeBoard();
}
function pieceName(p){return{â™”:'King',â™•:'Queen',â™–:'Rook',â™—:'Bishop',â™˜:'Knight',â™™:'Pawn',â™š:'King',â™›:'Queen',â™œ:'Rook',â™:'Bishop',â™:'Knight',â™Ÿ:'Pawn'}[p]||'Piece';}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED MOVE GENERATOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getMovesForPiece(board,r,c){
  const p=board[r][c];if(!p)return[];
  const moves=[];
  const friendly=isW(p)?isW:isB;
  const add=(nr,nc)=>{if(nr<0||nr>7||nc<0||nc>7)return false;if(friendly(board[nr][nc]))return false;moves.push([nr,nc]);return!board[nr][nc];};
  const slide=(dr,dc)=>{let nr=r+dr,nc=c+dc;while(nr>=0&&nr<8&&nc>=0&&nc<8){if(friendly(board[nr][nc]))break;moves.push([nr,nc]);if(board[nr][nc])break;nr+=dr;nc+=dc;}};
  switch(p){
    case'â™™':if(r>0&&!board[r-1][c]){moves.push([r-1,c]);if(r===6&&!board[r-2][c])moves.push([r-2,c]);}if(r>0&&c>0&&isB(board[r-1][c-1]))moves.push([r-1,c-1]);if(r>0&&c<7&&isB(board[r-1][c+1]))moves.push([r-1,c+1]);break;
    case'â™Ÿ':if(r<7&&!board[r+1][c]){moves.push([r+1,c]);if(r===1&&!board[r+2][c])moves.push([r+2,c]);}if(r<7&&c>0&&isW(board[r+1][c-1]))moves.push([r+1,c-1]);if(r<7&&c<7&&isW(board[r+1][c+1]))moves.push([r+1,c+1]);break;
    case'â™˜':case'â™':[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(([dr,dc])=>add(r+dr,c+dc));break;
    case'â™—':case'â™':[[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d=>slide(...d));break;
    case'â™–':case'â™œ':[[-1,0],[1,0],[0,-1],[0,1]].forEach(d=>slide(...d));break;
    case'â™•':case'â™›':[[-1,-1],[-1,1],[1,-1],[1,1],[-1,0],[1,0],[0,-1],[0,1]].forEach(d=>slide(...d));break;
    case'â™”':case'â™š':[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(([dr,dc])=>add(r+dr,c+dc));break;
  }
  return moves;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MINI BOARD BUILDER (strategies & tricks)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Build a 8x8 mini board. pieces = [{p, r, c}], highlights = [{r,c,cls}]
// Returns the wrapper div (position:relative for float-piece overlay)
function buildMiniBoard(id, pieces, highlights){
  const wrap=document.createElement('div');
  wrap.className='mini-board-wrap';wrap.style.position='relative';
  const grid=document.createElement('div');
  grid.className='mini-board';grid.id='mb_'+id;
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const sq=document.createElement('div');
    sq.className='msq '+((r+c)%2===0?'light':'dark');
    sq.id=`mb_${id}_${r}_${c}`;
    grid.appendChild(sq);
  }
  wrap.appendChild(grid);
  // place pieces
  pieces.forEach(({p,r,c})=>{
    document.createElement('div'); // placeholder
    // We'll set textContent after DOM is ready via a helper
  });
  // Store config for later render
  wrap._pieces=pieces;
  wrap._highlights=highlights||[];
  wrap._id=id;
  return wrap;
}

function renderMiniBoard(id, pieces, highlights){
  // Clear all squares
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const sq=document.getElementById(`mb_${id}_${r}_${c}`);
    if(!sq)return;
    sq.className='msq '+((r+c)%2===0?'light':'dark');
    sq.textContent='';
  }
  // Place pieces
  pieces.forEach(({p,r,c})=>{
    const sq=document.getElementById(`mb_${id}_${r}_${c}`);
    if(sq)sq.textContent=p;
  });
  // Apply highlights
  (highlights||[]).forEach(({r,c,cls})=>{
    const sq=document.getElementById(`mb_${id}_${r}_${c}`);
    if(sq)sq.classList.add(cls);
  });
}

// Animate a piece moving on a mini board
// steps = [{fromR,fromC,toR,toC,piece,delay,captureAt}]
function animateMiniBoard(id,initialPieces,steps,labelEl){
  let state=JSON.parse(JSON.stringify(initialPieces));
  // Remove existing float piece
  const existingFP=document.getElementById('fp_'+id);
  if(existingFP)existingFP.remove();
  renderMiniBoard(id,state,[]);
  let stepIdx=0;
  function runStep(){
    if(stepIdx>=steps.length){
      // Reset after a pause
      setTimeout(()=>{
        renderMiniBoard(id,initialPieces,[]);
        stepIdx=0;
        if(labelEl)labelEl.textContent='â–¶ Press Play to watch again!';
      },2000);
      return;
    }
    const step=steps[stepIdx];
    stepIdx++;
    setTimeout(()=>{
      const sq=document.getElementById(`mb_${id}_${step.fromR}_${step.fromC}`);
      const toSq=document.getElementById(`mb_${id}_${step.toR}_${step.toC}`);
      if(!sq||!toSq)return;
      const gridEl=document.getElementById('mb_'+id);
      if(!gridEl)return;
      const gridRect=gridEl.getBoundingClientRect();
      const sqRect=sq.getBoundingClientRect();
      const toRect=toSq.getBoundingClientRect();
      const sqSize=sqRect.width;

      // Create floating piece
      const fp=document.createElement('div');
      fp.className='float-piece';fp.id='fp_'+id;fp.textContent=step.piece;
      fp.style.left=(sqRect.left-gridRect.left)+'px';
      fp.style.top=(sqRect.top-gridRect.top)+'px';
      fp.style.width=sqSize+'px';fp.style.height=sqSize+'px';
      fp.style.fontSize=(sqSize*0.72)+'px';
      // Remove from source square
      sq.textContent='';
      sq.classList.add('mfrom');
      gridEl.parentElement.appendChild(fp);

      requestAnimationFrame(()=>{
        requestAnimationFrame(()=>{
          fp.style.left=(toRect.left-gridRect.left)+'px';
          fp.style.top=(toRect.top-gridRect.top)+'px';
        });
      });

      setTimeout(()=>{
        fp.remove();
        sq.classList.remove('mfrom');
        // Handle capture
        if(step.captureAt){
          const capSq=document.getElementById(`mb_${id}_${step.captureAt[0]}_${step.captureAt[1]}`);
          if(capSq)capSq.textContent='';
          state=state.filter(p=>!(p.r===step.captureAt[0]&&p.c===step.captureAt[1]));
        }
        // Update state
        state=state.filter(p=>!(p.r===step.fromR&&p.c===step.fromC));
        // Remove piece at destination if capture
        state=state.filter(p=>!(p.r===step.toR&&p.c===step.toC));
        state.push({p:step.piece,r:step.toR,c:step.toC});
        renderMiniBoard(id,state,step.highlights||[]);
        if(labelEl&&step.label)labelEl.textContent=step.label;
        runStep();
      },800);
    },step.delay||0);
  }
  if(labelEl)labelEl.textContent='â³ Watchingâ€¦';
  runStep();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STRATEGIES DATA + BUILD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STRATEGIES=[
  {
    id:'center',icon:'ğŸ¯',title:'Control the Center',diff:'beginner',
    desc:'The four center squares (e4, d4, e5, d5) are the most powerful spots. Pieces in the center control more squares and are much harder to attack!',
    pieces:[{p:'â™™',r:4,c:4},{p:'â™™',r:4,c:3},{p:'â™Ÿ',r:3,c:3},{p:'â™Ÿ',r:3,c:4}],
    highlights:[{r:3,c:3,cls:'mctrl'},{r:3,c:4,cls:'mctrl'},{r:4,c:3,cls:'mctrl'},{r:4,c:4,cls:'mctrl'}],
    steps:[{piece:'â™™',fromR:6,fromC:4,toR:4,toC:4,label:'e4! White controls the center!',delay:0},{piece:'â™Ÿ',fromR:1,fromC:3,toR:3,toC:3,label:'d5 â€” Black fights back for center!',delay:0}],
    initPieces:[{p:'â™™',r:6,c:4},{p:'â™Ÿ',r:1,c:3}],
    stepLabel:'â–¶ Watch center control!'
  },
  {
    id:'castle',icon:'ğŸ°',title:'Castle Early!',diff:'beginner',
    desc:'Castling moves your king to safety AND connects your rooks. Always try to castle in the first 10 moves. Your king in the center is very dangerous!',
    pieces:[{p:'â™”',r:7,c:4},{p:'â™–',r:7,c:7},{p:'â™˜',r:7,c:6},{p:'â™—',r:7,c:5}],
    highlights:[{r:7,c:6,cls:'mpath'},{r:7,c:5,cls:'mpath'}],
    steps:[
      {piece:'â™˜',fromR:7,fromC:6,toR:5,toC:5,label:'Knight develops â€” clearing kingside!',delay:0},
      {piece:'â™—',fromR:7,fromC:5,toR:4,toC:2,label:'Bishop develops â€” ready to castle!',delay:0},
      {piece:'â™”',fromR:7,fromC:4,toR:7,toC:6,label:'King castles to safety! â™”â†’g1',delay:0,highlights:[{r:7,c:5,cls:'mhl'},{r:7,c:6,cls:'mhl'}]},
      {piece:'â™–',fromR:7,fromC:7,toR:7,toC:5,label:'Rook jumps to f1! Connected! ğŸ°',delay:0}
    ],
    initPieces:[{p:'â™”',r:7,c:4},{p:'â™–',r:7,c:7},{p:'â™˜',r:7,c:6},{p:'â™—',r:7,c:5}],
    stepLabel:'â–¶ Watch kingside castling!'
  },
  {
    id:'activity',icon:'ğŸ¦',title:'Piece Activity',diff:'beginner',
    desc:'An active piece controlling many squares is worth more than a stuck piece. Always ask: "What can my pieces do right now?"',
    pieces:[{p:'â™˜',r:4,c:3}],
    highlights:[{r:2,c:2,cls:'mctrl'},{r:2,c:4,cls:'mctrl'},{r:3,c:1,cls:'mctrl'},{r:3,c:5,cls:'mctrl'},{r:5,c:1,cls:'mctrl'},{r:5,c:5,cls:'mctrl'},{r:6,c:2,cls:'mctrl'},{r:6,c:4,cls:'mctrl'}],
    steps:[
      {piece:'â™˜',fromR:7,fromC:1,toR:5,toC:2,label:'Knight to c3 â€” good but edge-ish',delay:0,highlights:[{r:3,c:1,cls:'mctrl'},{r:3,c:3,cls:'mctrl'},{r:4,c:0,cls:'mctrl'}]},
      {piece:'â™˜',fromR:5,fromC:2,toR:3,toC:3,label:'Knight to d5 â€” center! Controls 8 squares!',delay:0,highlights:[{r:1,c:2,cls:'mctrl'},{r:1,c:4,cls:'mctrl'},{r:2,c:1,cls:'mctrl'},{r:2,c:5,cls:'mctrl'},{r:4,c:1,cls:'mctrl'},{r:4,c:5,cls:'mctrl'},{r:5,c:2,cls:'mctrl'},{r:5,c:4,cls:'mctrl'}]}
    ],
    initPieces:[{p:'â™˜',r:7,c:1}],
    stepLabel:'â–¶ Watch knight activation!'
  },
  {
    id:'outpost',icon:'ğŸ“Œ',title:'Outposts',diff:'intermediate',
    desc:'An outpost is a square deep in enemy territory where your piece sits safely and cannot be attacked by enemy pawns. A knight on an outpost dominates!',
    pieces:[{p:'â™˜',r:2,c:3},{p:'â™Ÿ',r:1,c:2},{p:'â™Ÿ',r:1,c:4},{p:'â™Ÿ',r:3,c:2},{p:'â™Ÿ',r:3,c:4}],
    highlights:[{r:2,c:3,cls:'mhl'}],
    steps:[
      {piece:'â™˜',fromR:4,fromC:2,toR:2,toC:3,label:'Knight to d6 â€” deep outpost!',delay:0,highlights:[{r:2,c:3,cls:'mhl'}]},
    ],
    initPieces:[{p:'â™˜',r:4,c:2},{p:'â™Ÿ',r:1,c:2},{p:'â™Ÿ',r:1,c:4},{p:'â™Ÿ',r:3,c:2},{p:'â™Ÿ',r:3,c:4}],
    stepLabel:'â–¶ Watch knight reach outpost!'
  },
  {
    id:'openfile',icon:'ğŸ”“',title:'Open Files for Rooks',diff:'intermediate',
    desc:'Rooks love open files (columns with no pawns). Put rooks on open files to attack. Two rooks on the 7th rank can often win games alone!',
    pieces:[{p:'â™–',r:7,c:3},{p:'â™–',r:7,c:4}],
    highlights:[{r:0,c:3,cls:'mpath'},{r:1,c:3,cls:'mpath'},{r:2,c:3,cls:'mpath'},{r:3,c:3,cls:'mpath'},{r:4,c:3,cls:'mpath'},{r:5,c:3,cls:'mpath'},{r:6,c:3,cls:'mpath'}],
    steps:[
      {piece:'â™–',fromR:7,fromC:3,toR:1,toC:3,label:'Rook invades the 7th rank! ğŸ’¥',delay:0},
      {piece:'â™–',fromR:7,fromC:4,toR:1,toC:4,label:'Second rook joins! Devastating!',delay:0}
    ],
    initPieces:[{p:'â™–',r:7,c:3},{p:'â™–',r:7,c:4}],
    stepLabel:'â–¶ Watch rooks invade!'
  },
  {
    id:'kingsafe',icon:'ğŸ‘‘',title:'King Safety',diff:'beginner',
    desc:'Never ignore your king\'s safety! A pawn shield in front of your castled king is very important. Avoid moving those pawns unless absolutely necessary!',
    pieces:[{p:'â™”',r:7,c:6},{p:'â™™',r:6,c:5},{p:'â™™',r:6,c:6},{p:'â™™',r:6,c:7}],
    highlights:[{r:6,c:5,cls:'mpath'},{r:6,c:6,cls:'mpath'},{r:6,c:7,cls:'mpath'}],
    steps:[
      {piece:'â™™',fromR:6,fromC:6,toR:5,toC:6,label:'âš ï¸ Pushing pawn weakens king shield!',delay:0},
      {piece:'â™™',fromR:5,fromC:6,toR:5,toC:6,label:'The g-pawn advance creates weaknesses!',delay:200}
    ],
    initPieces:[{p:'â™”',r:7,c:6},{p:'â™™',r:6,c:5},{p:'â™™',r:6,c:6},{p:'â™™',r:6,c:7}],
    stepLabel:'â–¶ See why pawn shield matters!'
  },
  {
    id:'pawnstr',icon:'ğŸ”—',title:'Pawn Structure',diff:'intermediate',
    desc:'Pawns can\'t move backwards! Avoid doubled pawns (two on same file), isolated pawns (no neighbours), and backward pawns.',
    pieces:[{p:'â™™',r:3,c:3},{p:'â™™',r:4,c:3},{p:'â™™',r:5,c:5},{p:'â™™',r:4,c:2}],
    highlights:[{r:3,c:3,cls:'matt'},{r:4,c:3,cls:'matt'}],
    steps:[
      {piece:'â™™',fromR:5,fromC:3,toR:4,toC:4,label:'Bad! Creates doubled pawns on d-file',delay:0,captureAt:[4,4]},
    ],
    initPieces:[{p:'â™™',r:5,c:3},{p:'â™™',r:4,c:3},{p:'â™™',r:5,c:5},{p:'â™™',r:4,c:2}],
    stepLabel:'â–¶ See pawn structure problems!'
  },
  {
    id:'passed',icon:'ğŸŒŸ',title:'Passed Pawns',diff:'intermediate',
    desc:'A passed pawn has no enemy pawns blocking its path to promotion. Push passed pawns forward â€” they can become queens! Very powerful in the endgame.',
    pieces:[{p:'â™™',r:2,c:3}],
    highlights:[{r:1,c:3,cls:'mpath'},{r:0,c:3,cls:'mpath'}],
    steps:[
      {piece:'â™™',fromR:2,fromC:3,toR:1,toC:3,label:'Passed pawn advances! One step away!',delay:0,highlights:[{r:0,c:3,cls:'mpath'}]},
      {piece:'â™™',fromR:1,fromC:3,toR:0,toC:3,label:'PROMOTION! Pawn becomes a Queen! ğŸŒŸâ™›',delay:0}
    ],
    initPieces:[{p:'â™™',r:2,c:3}],
    stepLabel:'â–¶ Watch promotion!'
  },
  {
    id:'zugzwang',icon:'ğŸ”„',title:'Zugzwang',diff:'advanced',
    desc:'A position where ANY move makes your position worse! You are forced to move but wish you could pass. This often decides king and pawn endgames.',
    pieces:[{p:'â™”',r:2,c:4},{p:'â™š',r:0,c:4},{p:'â™™',r:1,c:4}],
    highlights:[{r:0,c:3,cls:'matt'},{r:0,c:5,cls:'matt'},{r:1,c:3,cls:'matt'},{r:1,c:5,cls:'matt'}],
    steps:[
      {piece:'â™š',fromR:0,fromC:4,toR:0,toC:3,label:'Black king must move away â€” zugzwang!',delay:0},
      {piece:'â™™',fromR:1,fromC:4,toR:0,toC:4,label:'Pawn promotes! White wins!',delay:0}
    ],
    initPieces:[{p:'â™”',r:2,c:4},{p:'â™š',r:0,c:4},{p:'â™™',r:1,c:4}],
    stepLabel:'â–¶ Watch zugzwang!'
  },
  {
    id:'tempo',icon:'âš¡',title:'Tempo',diff:'advanced',
    desc:'A "tempo" is like a free move. Making threats forces your opponent to react, letting you develop pieces freely and control the pace of the game!',
    pieces:[{p:'â™•',r:4,c:0},{p:'â™',r:2,c:2},{p:'â™',r:2,c:5}],
    highlights:[{r:2,c:2,cls:'matt'}],
    steps:[
      {piece:'â™•',fromR:4,fromC:0,toR:2,toC:2,label:'Queen attacks bishop! Black must react!',delay:0,captureAt:[2,2]},
      {piece:'â™•',fromR:2,fromC:2,toR:2,toC:5,label:'Now Queen attacks Knight too! Free moves!',delay:0,captureAt:[2,5]}
    ],
    initPieces:[{p:'â™•',r:4,c:0},{p:'â™',r:2,c:2},{p:'â™',r:2,c:5}],
    stepLabel:'â–¶ Watch tempo attacks!'
  },
  {
    id:'activate',icon:'ğŸª',title:'King Activation',diff:'intermediate',
    desc:'In the endgame, the king becomes a powerful piece! Bring it to the center to help attack and escort passed pawns to promotion.',
    pieces:[{p:'â™”',r:7,c:0},{p:'â™™',r:3,c:4}],
    highlights:[{r:4,c:3,cls:'mpath'},{r:3,c:4,cls:'mpath'}],
    steps:[
      {piece:'â™”',fromR:7,fromC:0,toR:5,toC:2,label:'King marches forward in endgame!',delay:0},
      {piece:'â™”',fromR:5,fromC:2,toR:3,toC:4,label:'King supports the passed pawn!',delay:0}
    ],
    initPieces:[{p:'â™”',r:7,c:0},{p:'â™™',r:3,c:4}],
    stepLabel:'â–¶ Watch king activation!'
  },
  {
    id:'waste',icon:'â°',title:"Don't Waste Moves",diff:'beginner',
    desc:"In chess, every move counts! Don't move the same piece twice in the opening. Each move should improve your position or threaten something.",
    pieces:[{p:'â™•',r:3,c:4},{p:'â™',r:2,c:3},{p:'â™',r:2,c:5}],
    highlights:[{r:3,c:4,cls:'mhl'}],
    steps:[
      {piece:'â™•',fromR:3,fromC:4,toR:1,toC:4,label:'Queen moves again â€” wastes a tempo!',delay:0},
      {piece:'â™',fromR:2,fromC:3,toR:4,toC:1,label:'Meanwhile Black develops freely!',delay:0}
    ],
    initPieces:[{p:'â™•',r:3,c:4},{p:'â™',r:2,c:3},{p:'â™',r:2,c:5}],
    stepLabel:"â–¶ See why repeating moves is bad!"
  },
];

function buildStrategies(){
  const grid=document.getElementById('strategiesGrid');
  grid.innerHTML='';
  STRATEGIES.forEach((s,idx)=>{
    const card=document.createElement('div');
    card.className='strategy-card';
    const diffCls=s.diff==='beginner'?'tag-beginner':s.diff==='intermediate'?'tag-intermediate':'tag-advanced';
    card.innerHTML=`<h3>${s.icon} ${s.title} <span class="diff-tag ${diffCls}">${s.diff}</span></h3><p>${s.desc}</p>`;

    // Build mini board
    const boardWrap=document.createElement('div');
    boardWrap.style.cssText='margin-top:4px;';
    const grid8=document.createElement('div');grid8.className='mini-board';grid8.id='mb_s'+idx;
    boardWrap.style.position='relative';
    for(let r=0;r<8;r++)for(let c=0;c<8;c++){
      const sq=document.createElement('div');
      sq.className='msq '+((r+c)%2===0?'light':'dark');
      sq.id=`mb_s${idx}_${r}_${c}`;
      grid8.appendChild(sq);
    }
    boardWrap.appendChild(grid8);
    card.appendChild(boardWrap);

    // Controls
    const ctrl=document.createElement('div');ctrl.style.cssText='margin-top:6px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;';
    const playBtn=document.createElement('button');
    playBtn.className='anim-btn anim-btn-play';playBtn.textContent='â–¶ Animate';
    const resetBtn=document.createElement('button');
    resetBtn.className='anim-btn anim-btn-reset';resetBtn.textContent='â†º Reset';
    const lbl=document.createElement('span');
    lbl.style.cssText='font-size:0.75rem;color:#8090b8;font-style:italic;';
    lbl.textContent=s.stepLabel;

    playBtn.onclick=()=>{
      // need to re-render based on grid8 being in DOM
      animateMiniBoard('s'+idx, s.initPieces, s.steps, lbl);
    };
    resetBtn.onclick=()=>{
      renderMbById('s'+idx, s.pieces, s.highlights);
      lbl.textContent=s.stepLabel;
    };
    ctrl.appendChild(playBtn);ctrl.appendChild(resetBtn);ctrl.appendChild(lbl);
    card.appendChild(ctrl);
    grid.appendChild(card);

    // Render initial state after appending to DOM
    setTimeout(()=>renderMbById('s'+idx, s.pieces, s.highlights),10);
  });
}

function renderMbById(id, pieces, highlights){
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const sq=document.getElementById(`mb_${id}_${r}_${c}`);
    if(!sq)return;
    sq.className='msq '+((r+c)%2===0?'light':'dark');
    sq.textContent='';
  }
  pieces.forEach(({p,r,c})=>{const sq=document.getElementById(`mb_${id}_${r}_${c}`);if(sq)sq.textContent=p;});
  (highlights||[]).forEach(({r,c,cls})=>{const sq=document.getElementById(`mb_${id}_${r}_${c}`);if(sq)sq.classList.add(cls);});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRICKS DATA + BUILD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TRICKS=[
  {
    id:'fork',icon:'âš¡',title:'Fork â€” Attack Two at Once!',
    desc:'A fork attacks two enemy pieces at the same time with ONE move! The most famous is the knight fork. Your opponent can only save one piece â€” you capture the other for free! ğŸ˜±',
    pieces:[{p:'â™˜',r:5,c:3},{p:'â™œ',r:3,c:2},{p:'â™›',r:3,c:6}],
    highlights:[{r:3,c:2,cls:'matt'},{r:3,c:6,cls:'matt'}],
    steps:[
      {piece:'â™˜',fromR:5,fromC:3,toR:3,toC:4,label:'Knight forks Rook AND Queen! Both attacked at once! ğŸ˜±',delay:0,highlights:[{r:3,c:2,cls:'matt'},{r:3,c:6,cls:'matt'},{r:3,c:4,cls:'mhl'}]},
      {piece:'â™˜',fromR:3,fromC:4,toR:3,toC:2,label:'Knight captures Rook â€” wins material!',delay:0,captureAt:[3,2]}
    ],
    initPieces:[{p:'â™˜',r:5,c:3},{p:'â™œ',r:3,c:2},{p:'â™›',r:3,c:6}]
  },
  {
    id:'pin',icon:'ğŸ“Œ',title:'Pin â€” Piece Cannot Move!',
    desc:'A pin is when a piece cannot move because moving it would expose a more valuable piece behind it. A piece pinned to the King CANNOT legally move!',
    pieces:[{p:'â™–',r:4,c:0},{p:'â™',r:4,c:3},{p:'â™š',r:4,c:7}],
    highlights:[{r:4,c:3,cls:'matt'},{r:4,c:7,cls:'matt'}],
    steps:[
      {piece:'â™–',fromR:7,fromC:0,toR:4,toC:0,label:'Rook pins the Knight to the King!',delay:0,highlights:[{r:4,c:0,cls:'mhl'},{r:4,c:3,cls:'matt'},{r:4,c:7,cls:'matt'}]},
      {piece:'â™–',fromR:4,fromC:0,toR:4,toC:3,label:'Knight cannot move â€” Rook captures it!',delay:0,captureAt:[4,3]}
    ],
    initPieces:[{p:'â™–',r:7,c:0},{p:'â™',r:4,c:3},{p:'â™š',r:4,c:7}]
  },
  {
    id:'skewer',icon:'ğŸ’¥',title:'Skewer â€” Big Piece Must Flee!',
    desc:'A skewer is the OPPOSITE of a pin. You attack a valuable piece, it moves, then you capture the piece hiding behind it! It\'s like skewering two pieces at once.',
    pieces:[{p:'â™—',r:5,c:0},{p:'â™š',r:2,c:3},{p:'â™›',r:0,c:5}],
    highlights:[{r:2,c:3,cls:'matt'},{r:0,c:5,cls:'matt'}],
    steps:[
      {piece:'â™—',fromR:5,fromC:0,toR:3,toC:2,label:'Bishop attacks King! King MUST move!',delay:0,highlights:[{r:2,c:3,cls:'matt'}]},
      {piece:'â™š',fromR:2,fromC:3,toR:1,toC:4,label:'King fleesâ€¦ but exposes the Queen!',delay:0},
      {piece:'â™—',fromR:3,fromC:2,toR:0,toC:5,label:'Bishop captures Queen for free! ğŸ’¥',delay:0,captureAt:[0,5]}
    ],
    initPieces:[{p:'â™—',r:5,c:0},{p:'â™š',r:2,c:3},{p:'â™›',r:0,c:5}]
  },
  {
    id:'discovered',icon:'ğŸ¯',title:'Discovered Attack â€” Surprise Reveal!',
    desc:'A discovered attack happens when you move one piece and REVEAL an attack by the piece behind it. Both pieces can attack at once â€” devastating!',
    pieces:[{p:'â™˜',r:4,c:3},{p:'â™—',r:6,c:1},{p:'â™š',r:2,c:5},{p:'â™›',r:0,c:3}],
    highlights:[{r:2,c:5,cls:'matt'},{r:0,c:3,cls:'matt'}],
    steps:[
      {piece:'â™˜',fromR:4,fromC:3,toR:2,toC:4,label:'Knight moves AND attacks King! Bishop now revealed on Queen!',delay:0,highlights:[{r:2,c:4,cls:'mhl'},{r:2,c:5,cls:'matt'},{r:0,c:3,cls:'matt'}]},
    ],
    initPieces:[{p:'â™˜',r:4,c:3},{p:'â™—',r:6,c:1},{p:'â™š',r:2,c:5},{p:'â™›',r:0,c:3}]
  },
  {
    id:'scholars',icon:'ğŸ˜ˆ',title:"Scholar's Mate â€” 4 Move Checkmate!",
    desc:'The fastest checkmate! 1.e4 e5 2.Bc4 Nc6 3.Qh5 Nf6?? 4.Qxf7# â€” White\'s Queen and Bishop team up to attack f7. Defence: Play Nf6 on move 3!',
    pieces:[{p:'â™™',r:4,c:4},{p:'â™Ÿ',r:4,c:4},{p:'â™—',r:4,c:2},{p:'â™•',r:3,c:7},{p:'â™š',r:0,c:4},{p:'â™Ÿ',r:1,c:5}],
    highlights:[{r:1,c:5,cls:'matt'}],
    steps:[
      {piece:'â™•',fromR:3,fromC:7,toR:1,toC:5,label:'Queen captures f7! CHECKMATE! ğŸ˜ˆ King is trapped!',delay:0,captureAt:[1,5],highlights:[{r:0,c:4,cls:'matt'}]}
    ],
    initPieces:[{p:'â™—',r:4,c:2},{p:'â™•',r:3,c:7},{p:'â™š',r:0,c:4},{p:'â™Ÿ',r:4,c:4},{p:'â™™',r:5,c:4},{p:'â™Ÿ',r:1,c:5}]
  },
  {
    id:'zwischenzug',icon:'ğŸ”„',title:'Zwischenzug â€” The In-Between Move!',
    desc:'Instead of recapturing, play a powerful DIFFERENT move first! Your opponent will be shocked. Like saying "wait â€” I have something BETTER right now!"',
    pieces:[{p:'â™•',r:4,c:3},{p:'â™œ',r:1,c:3},{p:'â™š',r:0,c:7},{p:'â™”',r:7,c:0}],
    highlights:[{r:0,c:7,cls:'matt'}],
    steps:[
      {piece:'â™•',fromR:4,fromC:3,toR:0,toC:7,label:'Instead of recapturing, CHECK the king first! Zwischenzug!',delay:0,highlights:[{r:0,c:7,cls:'matt'}]},
      {piece:'â™š',fromR:0,fromC:7,toR:1,toC:7,label:'King must flee â€” then capture the rook!',delay:0},
      {piece:'â™•',fromR:0,fromC:7,toR:1,toC:3,label:'Queen captures rook AND gained extra moves!',delay:0,captureAt:[1,3]}
    ],
    initPieces:[{p:'â™•',r:4,c:3},{p:'â™œ',r:1,c:3},{p:'â™š',r:0,c:7},{p:'â™”',r:7,c:0}]
  },
  {
    id:'sacrifice',icon:'ğŸ’«',title:'Sacrifice â€” Give to Get More!',
    desc:'Sometimes giving up a piece is the key to a brilliant attack! Sacrifices can expose the enemy king, open lines, and lead to checkmate. The most beautiful chess moves!',
    pieces:[{p:'â™—',r:2,c:7},{p:'â™š',r:0,c:6},{p:'â™Ÿ',r:1,c:7},{p:'â™Ÿ',r:1,c:6},{p:'â™•',r:5,c:3}],
    highlights:[{r:0,c:7,cls:'mhl'}],
    steps:[
      {piece:'â™—',fromR:2,fromC:7,toR:0,toC:7,label:'Bishop SACRIFICE! Takes on h8!',delay:0,captureAt:[0,7]},
      {piece:'â™š',fromR:0,fromC:6,toR:0,toC:7,label:'King must capture the bishop!',delay:0,captureAt:[0,7]},
      {piece:'â™•',fromR:5,fromC:3,toR:1,toC:7,label:'Queen delivers checkmate! The sacrifice worked! ğŸ‰',delay:0,highlights:[{r:0,c:7,cls:'matt'}]}
    ],
    initPieces:[{p:'â™—',r:2,c:7},{p:'â™š',r:0,c:6},{p:'â™Ÿ',r:1,c:7},{p:'â™Ÿ',r:1,c:6},{p:'â™•',r:5,c:3}]
  },
  {
    id:'castlingtrick',icon:'ğŸ°',title:'Castling â€” King Safety Move!',
    desc:'Castling moves the King 2 squares and the Rook jumps over it! Kingside (short): King goes to g1. Queenside (long): King goes to c1. Always castle to keep your king safe!',
    pieces:[{p:'â™”',r:7,c:4},{p:'â™–',r:7,c:7}],
    highlights:[{r:7,c:5,cls:'mpath'},{r:7,c:6,cls:'mpath'}],
    steps:[
      {piece:'â™”',fromR:7,fromC:4,toR:7,toC:6,label:'King moves two squares right! â™”e1â†’g1',delay:0,highlights:[{r:7,c:6,cls:'mhl'}]},
      {piece:'â™–',fromR:7,fromC:7,toR:7,toC:5,label:'Rook jumps OVER to f1! â™–h1â†’f1 â€” Castled! ğŸ°',delay:0,highlights:[{r:7,c:5,cls:'mhl'}]}
    ],
    initPieces:[{p:'â™”',r:7,c:4},{p:'â™–',r:7,c:7}]
  }
];

function buildTricks(){
  const grid=document.getElementById('tricksGrid');
  grid.innerHTML='';
  TRICKS.forEach((t,idx)=>{
    const card=document.createElement('div');
    card.className='trick-card';
    card.innerHTML=`<h2>${t.icon} ${t.title}</h2><p>${t.desc}</p>`;

    // Board area
    const boardArea=document.createElement('div');
    boardArea.style.cssText='display:flex;gap:14px;align-items:flex-start;flex-wrap:wrap;';

    const boardWrap=document.createElement('div');
    boardWrap.style.position='relative';
    const grid8=document.createElement('div');
    grid8.className='mini-board';grid8.id='mb_t'+idx;
    for(let r=0;r<8;r++)for(let c=0;c<8;c++){
      const sq=document.createElement('div');
      sq.className='msq '+((r+c)%2===0?'light':'dark');
      sq.id=`mb_t${idx}_${r}_${c}`;
      grid8.appendChild(sq);
    }
    boardWrap.appendChild(grid8);
    boardArea.appendChild(boardWrap);

    // Side controls
    const sideWrap=document.createElement('div');
    sideWrap.style.cssText='flex:1;min-width:120px;';
    const lbl=document.createElement('div');
    lbl.style.cssText='font-size:0.8rem;color:#aac;line-height:1.5;margin-bottom:8px;min-height:2.5em;';
    lbl.textContent='Press â–¶ Play to see animation!';
    const playBtn=document.createElement('button');
    playBtn.className='anim-btn anim-btn-play';playBtn.textContent='â–¶ Play Animation';
    const resetBtn=document.createElement('button');
    resetBtn.className='anim-btn anim-btn-reset';resetBtn.style.marginTop='6px';resetBtn.textContent='â†º Reset';
    playBtn.onclick=()=>{animateMiniBoard('t'+idx, t.initPieces, t.steps, lbl);};
    resetBtn.onclick=()=>{renderMbById('t'+idx, t.pieces, t.highlights);lbl.textContent='Press â–¶ Play to see animation!';};
    sideWrap.appendChild(lbl);sideWrap.appendChild(playBtn);
    const br=document.createElement('div');br.style.height='6px';sideWrap.appendChild(br);
    sideWrap.appendChild(resetBtn);
    boardArea.appendChild(sideWrap);

    card.appendChild(boardArea);
    grid.appendChild(card);
    setTimeout(()=>renderMbById('t'+idx, t.pieces, t.highlights),10);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATE MINI BOARD â€” uses getBoundingClientRect
   for correct pixel positions
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function animateMiniBoard(id, initialPieces, steps, labelEl){
  // Remove any old float piece
  const old=document.getElementById('fp_'+id);if(old)old.remove();
  // Reset state
  let state=JSON.parse(JSON.stringify(initialPieces));
  renderMbById(id,state,[]);
  if(labelEl)labelEl.textContent='â³ Animatingâ€¦';

  let si=0;
  function runStep(){
    if(si>=steps.length){
      setTimeout(()=>{
        renderMbById(id,initialPieces,[]);
        if(labelEl)labelEl.textContent='â–¶ Press Play to watch again!';
      },2000);
      return;
    }
    const step=steps[si++];
    setTimeout(()=>{
      const gridEl=document.getElementById('mb_'+id);
      if(!gridEl)return;
      const fromSq=document.getElementById(`mb_${id}_${step.fromR}_${step.fromC}`);
      const toSq=document.getElementById(`mb_${id}_${step.toR}_${step.toC}`);
      if(!fromSq||!toSq)return;

      const gridRect=gridEl.getBoundingClientRect();
      const fromRect=fromSq.getBoundingClientRect();
      const toRect=toSq.getBoundingClientRect();
      const sqSize=fromRect.width;

      // Create float piece
      const fp=document.createElement('div');
      fp.id='fp_'+id;fp.className='float-piece';
      fp.textContent=step.piece;
      fp.style.cssText=`position:absolute;z-index:20;pointer-events:none;line-height:1;width:${sqSize}px;height:${sqSize}px;font-size:${sqSize*0.7}px;display:flex;align-items:center;justify-content:center;transition:left 0.7s cubic-bezier(0.4,0,0.2,1),top 0.7s cubic-bezier(0.4,0,0.2,1);`;
      fp.style.left=(fromRect.left-gridRect.left)+'px';
      fp.style.top=(fromRect.top-gridRect.top)+'px';

      // Hide the piece on source square
      fromSq.textContent='';
      fromSq.style.opacity='0.4';

      // append to parent of grid (which has position:relative)
      gridEl.parentElement.style.position='relative';
      gridEl.parentElement.appendChild(fp);

      requestAnimationFrame(()=>{
        requestAnimationFrame(()=>{
          fp.style.left=(toRect.left-gridRect.left)+'px';
          fp.style.top=(toRect.top-gridRect.top)+'px';
        });
      });

      setTimeout(()=>{
        fp.remove();
        fromSq.style.opacity='';
        // Handle capture
        if(step.captureAt){
          const cSq=document.getElementById(`mb_${id}_${step.captureAt[0]}_${step.captureAt[1]}`);
          if(cSq)cSq.textContent='';
          state=state.filter(p=>!(p.r===step.captureAt[0]&&p.c===step.captureAt[1]));
        }
        // Update logical state
        state=state.filter(p=>!(p.r===step.fromR&&p.c===step.fromC));
        state=state.filter(p=>!(p.r===step.toR&&p.c===step.toC));
        state.push({p:step.piece,r:step.toR,c:step.toC});
        renderMbById(id,state,step.highlights||[]);
        if(labelEl&&step.label)labelEl.textContent=step.label;
        runStep();
      },750);
    },step.delay||300);
  }
  runStep();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHALLENGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CHALLENGES=[
  // â”€â”€ EASY â”€â”€
  {id:1,icon:'â™Ÿ',title:'Pawn Captures Queen!',diff:'easy',
   mission:'Move your White Pawn forward-diagonally to CAPTURE the Black Queen!',
   targetLabel:'Capture the Black Queen â™›',
   pieces:[{p:'â™™',sq:[3,3],c:'w'},{p:'â™›',sq:[2,4],c:'b'},{p:'â™š',sq:[0,7],c:'b'},{p:'â™”',sq:[7,0],c:'w'}],
   winCondition:{type:'capture',at:[2,4]},
   successMsg:'YES! Your tiny pawn captured the most powerful piece! Pawns are heroes! ğŸ¦¸',
   hint:{intro:'Pawns capture diagonally â€” one square forward and to the side.',
     steps:['Your White Pawn is on d5.','Pawns move forward but capture DIAGONALLY forward.','The Black Queen is on e6 â€” one square diagonally forward-right from your pawn!','Click your Pawn, then click the Queen\'s square to capture it!']}},

  {id:2,icon:'ğŸ°',title:'Rook Takes Rook!',diff:'easy',
   mission:'Slide your White Rook all the way across the board to capture the Black Rook!',
   targetLabel:'Capture the Black Rook â™œ',
   pieces:[{p:'â™–',sq:[4,0],c:'w'},{p:'â™œ',sq:[4,7],c:'b'},{p:'â™š',sq:[0,4],c:'b'},{p:'â™”',sq:[7,4],c:'w'}],
   winCondition:{type:'capture',at:[4,7]},
   successMsg:'Perfect Rook move! Rooks are great on open files â€” sliding all the way across! ğŸ°',
   hint:{intro:'The Rook moves any number of squares in a straight line â€” left, right, up, or down.',
     steps:['Your White Rook is on a4. The Black Rook is on h4.','They are on the SAME ROW (rank 5)!','Nothing is blocking between them.','Click your Rook, then slide it all the way to h4 to capture!']}},

  {id:3,icon:'â™—',title:'Bishop Snipes the Knight!',diff:'easy',
   mission:'Move the White Bishop diagonally to capture the Black Knight!',
   targetLabel:'Capture the Black Knight â™',
   pieces:[{p:'â™—',sq:[6,0],c:'w'},{p:'â™',sq:[2,4],c:'b'},{p:'â™š',sq:[0,7],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'capture',at:[2,4]},
   successMsg:'Excellent! Your Bishop fired across the whole diagonal! â™—âœ¨',
   hint:{intro:'Bishops move diagonally â€” any number of squares, always on the same colour!',
     steps:['Your White Bishop is on a2.','The Black Knight is on e6.','Trace the diagonal: a2â†’b3â†’c4â†’d5â†’e6. They\'re connected!','Click the Bishop and move it all the way to e6 to capture the Knight!']}},

  {id:4,icon:'ğŸ¦',title:'Queen Takes Rook!',diff:'easy',
   mission:'Move the White Queen to capture the Black Rook in one swift move!',
   targetLabel:'Capture Black Rook â™œ',
   pieces:[{p:'â™•',sq:[7,0],c:'w'},{p:'â™œ',sq:[0,0],c:'b'},{p:'â™š',sq:[0,7],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'capture',at:[0,0]},
   successMsg:'The Queen is so powerful â€” she flies across the whole board in one move! ğŸ¦â™•',
   hint:{intro:'The Queen moves like a Rook AND Bishop combined â€” any direction, any distance!',
     steps:['Your White Queen is on a1.','The Black Rook is on a8 â€” on the SAME file (column a)!','Nothing is blocking between them on the a-file.','Move the Queen all the way from a1 to a8!']}},

  {id:5,icon:'ğŸŒŸ',title:'Pawn Promotion!',diff:'easy',
   mission:'Move your White Pawn to the last rank to PROMOTE it to a Queen!',
   targetLabel:'Promote Pawn on rank 8',
   pieces:[{p:'â™™',sq:[1,4],c:'w'},{p:'â™š',sq:[0,0],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'promote',at:[0,4]},
   successMsg:'PROMOTION! Your little Pawn became a mighty Queen! ğŸŒŸâ™› That\'s the dream!',
   hint:{intro:'When a Pawn reaches the opposite end of the board, it becomes a Queen!',
     steps:['Your White Pawn is on e7, just ONE square away from the end!','Pawns move forward (upward for White).','Nothing is blocking e8.','Simply move the Pawn one square forward to e8! ğŸŒŸ']}},

  {id:6,icon:'ğŸ”®',title:'Capture the Unprotected Knight!',diff:'easy',
   mission:'Your Bishop can capture the Black Knight that has no protection â€” take it for free!',
   targetLabel:'Capture Black Knight â™',
   pieces:[{p:'â™—',sq:[5,0],c:'w'},{p:'â™',sq:[2,3],c:'b'},{p:'â™š',sq:[0,7],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'capture',at:[2,3]},
   successMsg:'Great capture! You spotted the unprotected piece and grabbed it â€” good tactics! ğŸ”®',
   hint:{intro:'Always look for unprotected enemy pieces â€” they are FREE to capture!',
     steps:['The Black Knight on d6 is not protected by any other Black piece.','Your Bishop on a3 moves diagonally.','Trace the diagonal: a3â†’b4â†’c5â†’d6. The Knight is right there!','Click the Bishop, then click the Knight\'s square to capture!']}},

  {id:7,icon:'ğŸŒŠ',title:'Stop the Pawn!',diff:'easy',
   mission:'Use your White Rook to capture the Black Pawn before it promotes to a Queen!',
   targetLabel:'Capture Black Pawn â™Ÿ',
   pieces:[{p:'â™–',sq:[7,3],c:'w'},{p:'â™Ÿ',sq:[1,3],c:'b'},{p:'â™š',sq:[0,5],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'capture',at:[1,3]},
   successMsg:'Phew! You stopped the pawn just in time! Rooks are great at stopping passed pawns! ğŸŒŠ',
   hint:{intro:'A pawn one step from promoting is very dangerous â€” stop it fast with your Rook!',
     steps:['The Black Pawn is on d7, ready to become a Queen next move!','Your White Rook is on d1 â€” on the SAME file as the pawn!','The Rook can slide straight up the d-file.','Move the Rook all the way up to d7 to capture the pawn!']}},

  {id:8,icon:'â™•',title:'Queen Checkmate!',diff:'easy',
   mission:'Move the White Queen to give CHECKMATE! The King must have no escape!',
   targetLabel:'Deliver Checkmate on a8',
   pieces:[{p:'â™•',sq:[2,0],c:'w'},{p:'â™–',sq:[1,7],c:'w'},{p:'â™š',sq:[0,7],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'moveto',from:[2,0],to:[0,0]},
   successMsg:'CHECKMATE! The King has nowhere to go! You won the game! ğŸ‘‘ğŸ‰',
   hint:{intro:'Checkmate means the King is attacked AND cannot escape to any safe square.',
     steps:['The Black King is trapped in the corner at h8.','The White Rook on h7 covers the entire h-file.','If you move the Queen to a8, it covers the ENTIRE 8th rank!','The King can\'t escape â€” move Queen from a6 to a8! âœ…']}},

  // â”€â”€ MEDIUM â”€â”€
  {id:9,icon:'ğŸ´',title:'Knight Fork Attack!',diff:'medium',
   mission:'Move the White Knight to fork (attack) BOTH the Black Rook and Black King at the same time!',
   targetLabel:'Fork the Rook â™œ & King â™š',
   pieces:[{p:'â™˜',sq:[5,1],c:'w'},{p:'â™œ',sq:[1,0],c:'b'},{p:'â™š',sq:[1,6],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'moveto',from:[5,1],to:[3,2]},
   successMsg:'Amazing! Your Knight attacked two pieces at once â€” that\'s a FORK! ğŸ´âš¡',
   hint:{intro:'The Knight moves in an L-shape: 2 squares one way, then 1 square the other.',
     steps:['Your Knight is on b3. Look at ALL squares a knight can reach.','From b3, the knight can jump to: a1, c1, d2, d4, c5, a5.','From c5, it can reach: a4, a6, b3, b7, d3, d7, e4, e6.','Which landing square attacks BOTH the Rook (on a7) AND the King (on g7)?','Try d4! From d4: b3, b5, c2, c6, e2, e6, f3, f5.','Move to the square that simultaneously attacks both enemy pieces!']}},

  {id:10,icon:'ğŸ“Œ',title:'Pin the Knight!',diff:'medium',
   mission:'Move your White Rook to PIN the Black Knight against the Black King! The Knight will be stuck!',
   targetLabel:'Create a PIN on the Knight',
   pieces:[{p:'â™–',sq:[4,0],c:'w'},{p:'â™',sq:[4,4],c:'b'},{p:'â™š',sq:[4,7],c:'b'},{p:'â™”',sq:[7,0],c:'w'}],
   winCondition:{type:'moveto',from:[4,0],to:[4,3]},
   successMsg:"You created a PIN! The Knight can't move because it would expose the King! ğŸ“Œ",
   hint:{intro:'A PIN is when a piece can\'t move because moving it would expose a more valuable piece behind it!',
     steps:['Your Rook is on a4. The Black Knight is on e4. The Black King is on h4.','All three are on the SAME RANK (row 5)!','If you move your Rook to d4, it points at the Knight AND the King behind it.','The Knight cannot move away â€” it would expose the King!','Move Rook to d4 to create the pin! ğŸ“Œ']}},

  {id:11,icon:'âš¡',title:'Knight Forks Queen & King!',diff:'medium',
   mission:'Move the White Knight to a square where it attacks BOTH the Black Queen AND Black King!',
   targetLabel:'Fork Queen â™› and King â™š',
   pieces:[{p:'â™˜',sq:[6,3],c:'w'},{p:'â™›',sq:[4,2],c:'b'},{p:'â™š',sq:[4,6],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'moveto',from:[6,3],to:[5,5]},
   successMsg:'INCREDIBLE Fork! Your Knight attacked two pieces at once! âš¡ğŸ´',
   hint:{intro:'A Knight Fork attacks two (or more!) enemy pieces at the same time with one move.',
     steps:['Your Knight is on d2. Look at ALL squares a Knight can reach.','Knights move in an L-shape: 2+1 or 1+2 in any direction.','The Black Queen is on c4 and the King is on g4.','Try jumping to f3. From f3, which enemy pieces does the Knight attack?','From f3: d2, h2, d4, h4, e1, g1, e5, g5.','Move to f3 â€” it attacks both the Queen on c4? No... try e3: attacks c4 and g4? Check!','Move to the square that attacks BOTH pieces!']}},

  {id:12,icon:'ğŸ’',title:'Back Rank Checkmate!',diff:'medium',
   mission:'Use your Rook to deliver CHECKMATE on the back rank! The enemy King is trapped by its own pawns!',
   targetLabel:'Checkmate â™š on back rank',
   pieces:[{p:'â™–',sq:[4,0],c:'w'},{p:'â™š',sq:[0,6],c:'b'},{p:'â™Ÿ',sq:[1,4],c:'b'},{p:'â™Ÿ',sq:[1,5],c:'b'},{p:'â™Ÿ',sq:[1,6],c:'b'},{p:'â™”',sq:[7,0],c:'w'}],
   winCondition:{type:'moveto',from:[4,0],to:[0,0]},
   successMsg:'BACK RANK CHECKMATE! The King was trapped by its own pawns â€” a classic! ğŸ’ğŸ‘‘',
   hint:{intro:'When a King\'s pawns lock it in, a Rook on the back rank delivers checkmate!',
     steps:['The Black King is on g8, surrounded by its own pawns on e7, f7, g7.','Those pawns block the King from escaping forward.','If your Rook goes to a8, it covers the ENTIRE back rank!','Move your Rook from a4 all the way to a8! ğŸ°']}},

  {id:13,icon:'ğŸª',title:'Two Rooks Checkmate!',diff:'medium',
   mission:'Move the White Rook to give CHECKMATE with the two rooks working as a team!',
   targetLabel:'Deliver checkmate with 2 Rooks',
   pieces:[{p:'â™–',sq:[1,0],c:'w'},{p:'â™–',sq:[2,7],c:'w'},{p:'â™š',sq:[0,7],c:'b'},{p:'â™”',sq:[7,0],c:'w'}],
   winCondition:{type:'moveto',from:[1,0],to:[0,0]},
   successMsg:'Rook Ladder Checkmate! Two rooks pushing the King to the corner is a classic win! ğŸª',
   hint:{intro:'Two Rooks together are incredibly powerful â€” they can push the King to the corner!',
     steps:['The Black King is on h8.','Your second Rook on h6 covers the h-file â€” king can\'t go to h7.','If you move the Rook from a7 to a8, it covers the ENTIRE 8th rank!','The King on h8 cannot escape. Move Ra7 to a8 for checkmate! ğŸ°ğŸ°']}},

  {id:14,icon:'ğŸ”±',title:'Discovered Attack!',diff:'medium',
   mission:'Move the White Knight away to UNCOVER a devastating Bishop attack on the Black Queen!',
   targetLabel:'Uncover Bishop\'s attack on â™›',
   pieces:[{p:'â™˜',sq:[4,4],c:'w'},{p:'â™—',sq:[6,2],c:'w'},{p:'â™›',sq:[2,6],c:'b'},{p:'â™š',sq:[0,7],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'moveto',from:[4,4],to:[2,3]},
   successMsg:'Brilliant! Moving the Knight REVEALED the Bishop\'s hidden attack â€” Discovered Attack! ğŸ”±',
   hint:{intro:'A Discovered Attack happens when you move one piece and it reveals an attack by the piece behind it!',
     steps:['Look at the White Bishop on c2.','Trace its diagonal: c2â†’d3â†’e4â†’f5â†’g6. The Black Queen is on g6!','But the White Knight on e4 is BLOCKING that diagonal!','If you move the Knight away, the Bishop will attack the Queen.','Move the Knight to d6 â€” then the Bishop fires at the Queen!']}},

  {id:15,icon:'ğŸ¹',title:'Skewer the King!',diff:'medium',
   mission:'Move the White Bishop to SKEWER â€” attack the Black King, forcing it to move and exposing the Black Queen!',
   targetLabel:'Skewer King to expose Queen',
   pieces:[{p:'â™—',sq:[5,0],c:'w'},{p:'â™š',sq:[2,3],c:'b'},{p:'â™›',sq:[0,5],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'moveto',from:[5,0],to:[3,2]},
   successMsg:'SKEWER! The King had to move and the Bishop takes the Queen for free! ğŸ¹ğŸ’¥',
   hint:{intro:'A Skewer is like a reverse pin â€” you attack a BIG piece, it moves, and you capture the piece behind it!',
     steps:['The White Bishop is on a3.','Move the Bishop to c5. Now it attacks d6 (the King) along the diagonal.','The King MUST move away.','But the Queen on f8 is on the SAME diagonal, just behind the King!','After the King moves, the Bishop captures the Queen! â™—ğŸ˜ˆ']}},

  // â”€â”€ HARD â”€â”€
  {id:16,icon:'ğŸ‘»',title:'Knight Fork: Queen & Rook!',diff:'hard',
   mission:'Find the ONE square where your Knight simultaneously attacks the Black Queen AND Black Rook!',
   targetLabel:'Fork Queen â™› and Rook â™œ',
   pieces:[{p:'â™˜',sq:[6,4],c:'w'},{p:'â™›',sq:[3,2],c:'b'},{p:'â™œ',sq:[3,6],c:'b'},{p:'â™š',sq:[0,7],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'moveto',from:[6,4],to:[4,3]},
   successMsg:'FORK! Your Knight attacked two powerful pieces at once â€” you win material! ğŸ‘»âš¡',
   hint:{intro:'Knights are the only pieces that can fork multiple pieces â€” even from far away!',
     steps:['Your Knight is on e2. You need to find a landing square.','From any square, a Knight attacks up to 8 squares in L-shapes.','The Black Queen is on c5 and the Black Rook is on g5.','Try landing on e4. From e4: d6,f6,c5,g5,c3,g3,d2,f2.','Yes! e4 attacks c5 (Queen) AND g5 (Rook). Move the Knight there! ğŸ´']}},

  {id:17,icon:'ğŸ’¥',title:'Queen Check Forces Win!',diff:'hard',
   mission:'Move the White Queen to give CHECK to the Black King, then the position is winning!',
   targetLabel:'Give check with Queen â™•',
   pieces:[{p:'â™•',sq:[5,4],c:'w'},{p:'â™–',sq:[3,0],c:'w'},{p:'â™š',sq:[0,4],c:'b'},{p:'â™Ÿ',sq:[1,3],c:'b'},{p:'â™Ÿ',sq:[1,5],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'moveto',from:[5,4],to:[1,4]},
   successMsg:'Brilliant Queen move! The King is in check and cannot escape safely! ğŸ’¥',
   hint:{intro:'When you give check, your opponent MUST respond â€” use this to gain tempo!',
     steps:['Your Queen is on e3. The Black King is on e8.','They\'re on the SAME FILE (e-file)!','Move the Queen to e7 â€” check! The King must move.','Your Rook on a5 covers the a-file and supports the attack.','After the King moves, your pieces dominate!']}},

  {id:18,icon:'ğŸ§©',title:'Smothered Mate!',diff:'hard',
   mission:'The Black King is smothered by its own pieces. Move the White Knight to deliver CHECKMATE!',
   targetLabel:'Deliver Smothered Mate with â™˜',
   pieces:[{p:'â™˜',sq:[1,5],c:'w'},{p:'â™š',sq:[0,7],c:'b'},{p:'â™œ',sq:[0,6],c:'b'},{p:'â™Ÿ',sq:[1,7],c:'b'},{p:'â™”',sq:[7,0],c:'w'}],
   winCondition:{type:'moveto',from:[1,5],to:[0,7]},
   successMsg:'SMOTHERED MATE! The legendary Knight checkmate â€” the King trapped by its own pieces! ğŸ†ğŸ‘‘',
   hint:{intro:'Smothered Mate is one of the most beautiful checkmates â€” the King is smothered by its own pieces!',
     steps:['The Black King is on h8, crammed in the corner.','The Black Rook on g8 and Black Pawn on h7 block all escape squares!','Your White Knight is on f7.','From f7, trace the knight\'s L-shape moves: one up, two right.','That lands on h8 â€” right where the King is!','Move Nf7â†’h8 â€” CHECKMATE! ğŸ†']}},

  {id:19,icon:'ğŸ¯',title:'Rook Battery!',diff:'hard',
   mission:'Move the White Rook to create a battery (both rooks on d-file) threatening the Black King!',
   targetLabel:'Move Rook to create battery',
   pieces:[{p:'â™–',sq:[4,3],c:'w'},{p:'â™–',sq:[7,3],c:'w'},{p:'â™š',sq:[0,3],c:'b'},{p:'â™Ÿ',sq:[1,2],c:'b'},{p:'â™Ÿ',sq:[1,4],c:'b'},{p:'â™”',sq:[7,7],c:'w'}],
   winCondition:{type:'moveto',from:[4,3],to:[1,3]},
   successMsg:'Battery power! Both Rooks on the d-file are unstoppable! ğŸ¯ğŸ”‹',
   hint:{intro:'A "battery" is when two powerful pieces line up together, doubling their attacking power!',
     steps:['Your two Rooks are both on the d-file! (d4 and d1)','The Black King is on d8 â€” also on the d-file!','Slide the top Rook from d4 up to d7, right next to the King.','The second Rook on d1 BACKS IT UP â€” impossible to safely capture.','The Black pawns on c7 and e7 block the King\'s side escapes.','Move the Rook from d4 to d7! The King is in deep trouble! ğŸ’¥']}},

  {id:20,icon:'ğŸ†',title:'Legendary Checkmate!',diff:'hard',
   mission:'Find the winning Queen move to deliver CHECKMATE! The Black King is cornered with no escape!',
   targetLabel:'Deliver Checkmate with â™•',
   pieces:[{p:'â™•',sq:[3,0],c:'w'},{p:'â™–',sq:[4,7],c:'w'},{p:'â™š',sq:[0,7],c:'b'},{p:'â™Ÿ',sq:[1,6],c:'b'},{p:'â™”',sq:[7,0],c:'w'}],
   winCondition:{type:'moveto',from:[3,0],to:[1,7]},
   successMsg:'LEGENDARY CHECKMATE! You solved all 20 challenges â€” you are a Chess Champion! ğŸ†ğŸ‘‘ğŸ‰',
   hint:{intro:'Look for a move that attacks the King AND covers all its escape squares at once!',
     steps:['The Black King is on h8, trapped in the corner.','Your Rook on h5 controls the h-file.','The Queen on a4 can travel diagonally OR in straight lines.','Try moving the Queen to h7 â€” that\'s next to the King!','The King can\'t go to h7 (Queen), can\'t go to g8 (Queen covers it), can\'t escape h-file (Rook).','Move Queen to h7 â€” CHECKMATE! ğŸ†']}}
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHALLENGES STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let chalBoard=[],chalSelected=null,chalSolved=new Set(),currentChallenge=null;

function initChallenges(){
  buildChallengeGrid();
  buildChalBoard();
  loadChallenge(CHALLENGES[0]);
}

function buildChallengeGrid(){
  const grid=document.getElementById('challengeGrid');grid.innerHTML='';
  CHALLENGES.forEach(ch=>{
    const el=document.createElement('div');
    el.className='ch-thumb'+(chalSolved.has(ch.id)?' ch-solved':'');
    el.id='chalThumb'+ch.id;
    el.onclick=()=>loadChallenge(ch);
    const dc=ch.diff==='easy'?'easy-tag':ch.diff==='medium'?'medium-tag':'hard-tag';
    el.innerHTML=`<span class="th-icon">${ch.icon}</span><div class="th-num">#${ch.id}</div><div class="th-diff ${dc}">${ch.diff}</div>`;
    grid.appendChild(el);
  });
}

function buildChalBoard(){
  const container=document.getElementById('chalBoardRows');container.innerHTML='';
  for(let r=0;r<8;r++){
    const rowWrap=document.createElement('div');rowWrap.className='board-row-wrap';
    const lbl=document.createElement('div');lbl.className='board-rank-lbl';lbl.textContent=8-r;
    rowWrap.appendChild(lbl);
    const rowEl=document.createElement('div');rowEl.style.cssText='display:flex;';
    for(let c=0;c<8;c++){
      const sq=document.createElement('div');
      sq.className='csq '+((r+c)%2===0?'light':'dark');
      sq.id=`csq_${r}_${c}`;sq.onclick=()=>chalClick(r,c);
      rowEl.appendChild(sq);
    }
    rowWrap.appendChild(rowEl);container.appendChild(rowWrap);
  }
}

function renderChalBoard(){
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const sq=document.getElementById(`csq_${r}_${c}`);
    sq.className='csq '+((r+c)%2===0?'light':'dark');
    sq.textContent=chalBoard[r][c]||'';
  }
}

function loadChallenge(ch){
  currentChallenge=ch;
  chalSelected=null;
  chalBoard=Array.from({length:8},()=>Array(8).fill(''));
  ch.pieces.forEach(({p,sq})=>{chalBoard[sq[0]][sq[1]]=p;});
  renderChalBoard();

  // Highlight target capture square
  if(ch.winCondition.type==='capture'){
    const[tr,tc]=ch.winCondition.at;
    getCsq(tr,tc).classList.add('ctarget');
  }

  document.querySelectorAll('.ch-thumb').forEach(t=>t.classList.remove('ch-active'));
  const thumb=document.getElementById('chalThumb'+ch.id);
  if(thumb){thumb.classList.add('ch-active');thumb.scrollIntoView({behavior:'smooth',block:'nearest'});}

  document.getElementById('chalIcon').textContent=ch.icon;
  document.getElementById('chalTitle').textContent=ch.title;
  const diff=document.getElementById('chalDiff');
  diff.textContent=ch.diff.charAt(0).toUpperCase()+ch.diff.slice(1);
  diff.className='chal-diff-badge '+(ch.diff==='easy'?'easy-tag':ch.diff==='medium'?'medium-tag':'hard-tag');
  document.getElementById('chalMission').textContent=ch.mission;
  document.getElementById('chalTargetTag').innerHTML=`<div class="target-tag">ğŸ¯ ${ch.targetLabel}</div>`;
  document.getElementById('hintContent').style.display='none';
  document.getElementById('hintHiddenMsg').style.display='block';
  document.getElementById('hintRevealBtn').textContent='Show Hint ğŸ‘';
  const rb=document.getElementById('chalResultBox');rb.className='result-box';rb.style.display='none';
  document.getElementById('chalNextBtn').style.display='none';
  document.getElementById('chalMovesLog').innerHTML='Waiting for your first moveâ€¦';
}

function revealHint(){
  const ch=currentChallenge;if(!ch)return;
  document.getElementById('hintContent').style.display='block';
  document.getElementById('hintHiddenMsg').style.display='none';
  document.getElementById('hintRevealBtn').textContent='âœ… Showing hint';
  document.getElementById('hintIntro').textContent=ch.hint.intro;
  document.getElementById('hintSteps').innerHTML=ch.hint.steps.map((s,i)=>`<li data-n="${i+1}">${s}</li>`).join('');
}

function getCsq(r,c){return document.getElementById(`csq_${r}_${c}`);}
function clearChalHighlights(){document.querySelectorAll('.csq').forEach(s=>s.classList.remove('csel','cvm','cvc'));}
function showChalHighlights(r,c){
  getCsq(r,c).classList.add('csel');
  getMovesForPiece(chalBoard,r,c).forEach(([mr,mc])=>{
    const sq=getCsq(mr,mc);
    if(chalBoard[mr][mc])sq.classList.add('cvc');else sq.classList.add('cvm');
  });
}

function chalClick(r,c){
  if(!currentChallenge)return;
  const piece=chalBoard[r][c];
  if(chalSelected){
    const[sr,sc]=chalSelected;
    const valid=getMovesForPiece(chalBoard,sr,sc);
    const ok=valid.some(([vr,vc])=>vr===r&&vc===c);
    if(ok){
      chalMove(sr,sc,r,c);chalSelected=null;renderChalBoard();clearChalHighlights();
    }else if(isW(piece)){
      chalSelected=[r,c];renderChalBoard();clearChalHighlights();showChalHighlights(r,c);
    }else{
      chalSelected=null;renderChalBoard();clearChalHighlights();
    }
  }else if(isW(piece)){
    chalSelected=[r,c];clearChalHighlights();showChalHighlights(r,c);
  }
}

function chalMove(sr,sc,r,c){
  const captured=chalBoard[r][c];
  const moving=chalBoard[sr][sc];
  chalBoard[r][c]=moving;chalBoard[sr][sc]='';
  const files='abcdefgh',ranks='87654321';
  const note=`${files[sc]}${ranks[sr]}â†’${files[c]}${ranks[r]}${captured?'Ã—'+captured:''}`;
  const log=document.getElementById('chalMovesLog');
  log.innerHTML=(log.innerHTML==='Waiting for your first moveâ€¦'?'':log.innerHTML+' ')+'<span>'+note+'</span>';
  // Handle promotion
  if(moving==='â™™'&&r===0){chalBoard[r][c]='â™•';}
  getCsq(r,c).classList.add('cflash');
  setTimeout(()=>{
    renderChalBoard();
    // Re-apply target glow if piece still there
    const ch=currentChallenge;
    if(ch&&ch.winCondition.type==='capture'&&chalBoard[ch.winCondition.at[0]][ch.winCondition.at[1]]){
      getCsq(...ch.winCondition.at).classList.add('ctarget');
    }
    checkChalSuccess(sr,sc,r,c,captured,moving);
  },320);
}

function checkChalSuccess(sr,sc,r,c,captured,moving){
  const ch=currentChallenge;if(!ch)return;
  let win=false;
  const wc=ch.winCondition;
  if(wc.type==='capture'){
    if(r===wc.at[0]&&c===wc.at[1]&&captured)win=true;
  }else if(wc.type==='promote'){
    if(r===wc.at[0]&&c===wc.at[1]&&moving==='â™™')win=true;
  }else if(wc.type==='moveto'){
    if(sr===wc.from[0]&&sc===wc.from[1]&&r===wc.to[0]&&c===wc.to[1])win=true;
  }
  if(win){
    chalSolved.add(ch.id);
    updateChalProgress();
    buildChallengeGrid();
    const rb=document.getElementById('chalResultBox');
    rb.className='result-box rsuccess';rb.style.display='block';
    document.getElementById('chalResultEmoji').textContent='ğŸ‰';
    document.getElementById('chalResultTitle').textContent='Challenge Solved!';
    document.getElementById('chalResultMsg').textContent=ch.successMsg;
    document.getElementById('chalNextBtn').style.display='inline-block';
    launchConfetti();
  }
}

function updateChalProgress(){
  const pct=Math.round(chalSolved.size/CHALLENGES.length*100);
  document.getElementById('chalFill').style.width=pct+'%';
  document.getElementById('chalProgressText').textContent=`${chalSolved.size} of ${CHALLENGES.length} challenges solved`;
}

function resetChallenge(){if(currentChallenge)loadChallenge(currentChallenge);}
function nextChallenge(){
  if(!currentChallenge)return;
  const idx=CHALLENGES.findIndex(c=>c.id===currentChallenge.id);
  loadChallenge(CHALLENGES[(idx+1)%CHALLENGES.length]);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUIZ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const QUESTIONS=[
  {q:"Which piece can jump over other pieces?",opts:["Bishop","Rook","Knight","Queen"],ans:2,emoji:"ğŸ´",exp:"The Knight is the only piece that can jump over other pieces! It moves in an L-shape."},
  {q:"What is it called when the King cannot escape from attack?",opts:["Check","Stalemate","Checkmate","Fork"],ans:2,emoji:"ğŸ˜±",exp:"Checkmate! When the king is in check and has no escape, the game is over!"},
  {q:"How many points is the Queen worth?",opts:["5","7","9","3"],ans:2,emoji:"â™›",exp:"The Queen is worth 9 points â€” she's the most powerful piece on the board!"},
  {q:"What happens when you 'castle'?",opts:["Move queen across board","Move king 2 squares with rook","Capture a piece","Promote a pawn"],ans:1,emoji:"ğŸ°",exp:"Castling moves the king 2 squares and the rook jumps over it to safety!"},
  {q:"What is a 'fork' in chess?",opts:["Moving a piece backwards","Blocking a check","Attacking two pieces at once","A pawn promotion"],ans:2,emoji:"âš¡",exp:"A fork attacks two enemy pieces at the same time â€” your opponent can only save one!"},
  {q:"Where is the best square for a Knight?",opts:["Corner","Edge of board","Center of board","Behind other pieces"],ans:2,emoji:"ğŸ¯",exp:"Knights in the center control up to 8 squares. A knight on the rim is dim!"},
  {q:"What is 'pawn promotion'?",opts:["Pawns can capture backwards","Pawn reaching last rank becomes powerful piece","Two pawns merge","Pawn jumps over pieces"],ans:1,emoji:"ğŸŒŸ",exp:"When a pawn reaches the opposite end, it promotes â€” usually to a Queen!"},
  {q:"What is a 'pin' in chess?",opts:["A drawing move","A piece that can't move without exposing a valuable piece behind it","Moving two pieces at once","Blocking the opponent's queen"],ans:1,emoji:"ğŸ“Œ",exp:"A pinned piece can't move without exposing a more valuable piece behind it!"},
  {q:"What colour squares does a Bishop always stay on?",opts:["Open files","Same colour squares","Center squares","The back rank"],ans:1,emoji:"â™",exp:"Each Bishop stays on one colour (light or dark) for the entire game!"},
  {q:"In the starting position, which piece is in the corner?",opts:["Knight","Bishop","Rook","Queen"],ans:2,emoji:"â™œ",exp:"Rooks start in the corners! They need open files to unleash their strength."},
  {q:"What is 'Stalemate'?",opts:["A pawn promotion","King in check","No legal moves but not in check â€” it's a draw!","Both kings face each other"],ans:2,emoji:"ğŸ¤",exp:"Stalemate is when a player has no legal moves but their king is NOT in check. It's a draw!"},
  {q:"Which opening move is most popular for White?",opts:["a4","e4","h4","f4"],ans:1,emoji:"ğŸ“–",exp:"1.e4 is the most popular first move! It controls the center and opens lines for pieces."},
];
const QUIZ_BADGES=['ğŸŒŸ','ğŸ†','âš¡','ğŸ¯','â™›','ğŸ§ ','ğŸ”¥','ğŸ’','ğŸ‘‘','ğŸ–ï¸','ğŸ¦','ğŸŒˆ'];
let qCurrent=0,qScore=0,qAnswered=false;

function quizStart(){
  qCurrent=0;qScore=0;qAnswered=false;
  document.getElementById('quizScore').textContent='0';
  document.getElementById('quizTotal').textContent='0';
  document.getElementById('earnedBadges').innerHTML='';
  document.getElementById('quizRestartBtn').style.display='none';
  document.getElementById('quizNextBtn').style.display='none';
  showQuizQuestion();
}
function showQuizQuestion(){
  qAnswered=false;
  const q=QUESTIONS[qCurrent];
  document.getElementById('quizEmoji').textContent=q.emoji;
  document.getElementById('quizQNum').textContent=`Question ${qCurrent+1} of ${QUESTIONS.length}`;
  document.getElementById('quizQuestion').textContent=q.q;
  document.getElementById('quizFeedback').className='quiz-feedback';
  document.getElementById('quizFeedback').textContent='';
  document.getElementById('quizNextBtn').style.display='none';
  document.getElementById('quizRestartBtn').style.display='none';
  document.getElementById('quizTotal').textContent=qCurrent;
  document.getElementById('quizProgressFill').style.width=(qCurrent/QUESTIONS.length*100)+'%';
  const opts=document.getElementById('quizOptions');opts.innerHTML='';
  q.opts.forEach((opt,i)=>{
    const b=document.createElement('button');b.className='quiz-opt';b.textContent=opt;
    b.onclick=()=>quizAnswer(i);opts.appendChild(b);
  });
}
function quizAnswer(idx){
  if(qAnswered)return;qAnswered=true;
  const q=QUESTIONS[qCurrent];
  document.querySelectorAll('.quiz-opt')[q.ans].classList.add('correct');
  const fb=document.getElementById('quizFeedback');
  if(idx===q.ans){
    qScore++;
    document.querySelectorAll('.quiz-opt')[idx].classList.add('correct');
    fb.textContent='ğŸ‰ Correct! '+q.exp;fb.className='quiz-feedback show qcorrect';
    if(qCurrent<QUIZ_BADGES.length){
      const bd=document.getElementById('earnedBadges');
      const b=document.createElement('span');b.className='badge';b.textContent=QUIZ_BADGES[qCurrent];b.title='Q'+(qCurrent+1)+' badge!';bd.appendChild(b);
    }
    launchConfetti();
  }else{
    document.querySelectorAll('.quiz-opt')[idx].classList.add('wrong');
    fb.textContent='âŒ Not quite! '+q.exp;fb.className='quiz-feedback show qwrong';
  }
  document.getElementById('quizScore').textContent=qScore;
  document.getElementById('quizTotal').textContent=qCurrent+1;
  if(qCurrent<QUESTIONS.length-1){
    document.getElementById('quizNextBtn').style.display='inline-block';
  }else{
    document.getElementById('quizProgressFill').style.width='100%';
    const pct=Math.round(qScore/QUESTIONS.length*100);
    fb.textContent=(pct===100?'ğŸ† PERFECT! You\'re a Chess Grandmaster! ':pct>=80?'ğŸŒŸ Excellent! Chess Expert! ':pct>=60?'â­ Good job! Keep practicing! ':'ğŸ“š Keep studying â€” you\'ll get there! ')+`Final score: ${qScore}/${QUESTIONS.length} (${pct}%)`;
    document.getElementById('quizRestartBtn').style.display='inline-block';
    document.getElementById('badgesLabel').textContent='Your badges:';
  }
}
function quizNext(){qCurrent++;showQuizQuestion();}
function quizRestart(){quizStart();}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function launchConfetti(){
  const wrap=document.getElementById('confettiWrap');wrap.innerHTML='';
  const cols=['#ffd700','#ff5252','#00e676','#40c4ff','#e040fb','#ff9100','#fff'];
  for(let i=0;i<55;i++){
    const el=document.createElement('div');el.className='confetti-piece';
    el.style.cssText=`left:${Math.random()*100}%;top:-16px;background:${cols[Math.floor(Math.random()*cols.length)]};width:${6+Math.random()*9}px;height:${6+Math.random()*9}px;border-radius:${Math.random()>.5?'50%':'2px'};animation-delay:${Math.random()*.8}s;animation-duration:${1.5+Math.random()*1.4}s;`;
    wrap.appendChild(el);
  }
  setTimeout(()=>wrap.innerHTML='',3200);
}
</script>
</body>
</html>
