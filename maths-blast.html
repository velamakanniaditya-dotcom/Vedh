<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maths Blast! ğŸš€ - Worksheet Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@600;800;900&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORKSHEET THEME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --primary: #4ade80; /* Friendly Green */
  --secondary: #38bdf8; /* Bright Blue */
  --danger: #fb7185; /* Soft Red */
  --warning: #fbbf24; /* Warm Yellow */
  --dark: #334155;
  --paper: #ffffff;
  --grid: #e2e8f0;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Nunito', sans-serif;
  /* Graph Paper Background */
  background-color: #f8fafc;
  background-image: 
    linear-gradient(var(--grid) 1px, transparent 1px),
    linear-gradient(90deg, var(--grid) 1px, transparent 1px);
  background-size: 30px 30px;
  color: var(--dark);
  min-height: 100vh;
  display: flex; flex-direction: column; align-items: center;
  padding: 20px;
}

/* Floating Home Button */
.home-btn {
  position: absolute; top: 20px; left: 20px;
  background: white; border: 3px solid var(--secondary);
  color: var(--secondary); padding: 8px 16px;
  border-radius: 50px; text-decoration: none;
  font-family: 'Fredoka One', cursive; font-size: 1.1rem;
  box-shadow: 0 4px 0 var(--secondary);
  transition: all 0.1s; z-index: 100;
}
.home-btn:active { transform: translateY(4px); box-shadow: 0 0 0 var(--secondary); }

/* Header */
header { text-align: center; margin-top: 40px; margin-bottom: 20px; }
h1 { font-family: 'Fredoka One', cursive; font-size: 3.5rem; color: var(--secondary); text-shadow: 2px 2px 0 #fff, 4px 4px 0 rgba(0,0,0,0.1); line-height: 1; }
.subtitle { font-size: 1.2rem; font-weight: 800; color: #64748b; margin-top: 5px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen { display: none; width: 100%; max-width: 500px; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
.screen.active { display: block; }
@keyframes popIn { 0% { opacity: 0; transform: scale(0.9) translateY(20px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }

/* Cards / Containers */
.worksheet-card {
  background: var(--paper);
  border: 4px solid var(--dark);
  border-radius: 24px;
  padding: 30px;
  box-shadow: 0 10px 0 rgba(51, 65, 85, 0.1);
  text-align: center;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   START SCREEN (MODE SELECTION)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mode-btn {
  width: 100%; display: flex; align-items: center; gap: 15px;
  background: white; border: 4px solid var(--dark);
  border-radius: 20px; padding: 15px 20px; margin-bottom: 15px;
  cursor: pointer; text-align: left; transition: all 0.1s;
  box-shadow: 0 6px 0 var(--dark);
}
.mode-btn:active { transform: translateY(6px); box-shadow: 0 0 0 var(--dark); }
.mode-btn.relaxed { border-color: var(--primary); box-shadow: 0 6px 0 var(--primary); }
.mode-btn.blast { border-color: var(--warning); box-shadow: 0 6px 0 var(--warning); }

.mode-icon { font-size: 2.5rem; }
.mode-text h3 { font-family: 'Fredoka One', cursive; font-size: 1.4rem; margin-bottom: 3px; color: var(--dark); }
.mode-text p { font-size: 0.95rem; font-weight: 600; color: #64748b; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.top-bar { display: flex; justify-content: space-between; font-family: 'Fredoka One', cursive; font-size: 1.5rem; margin-bottom: 15px; color: var(--dark); }

/* Timer Bar */
.timer-container { width: 100%; height: 20px; background: #e2e8f0; border-radius: 20px; border: 3px solid var(--dark); overflow: hidden; margin-bottom: 30px; position: relative; }
.timer-fill { height: 100%; background: var(--primary); width: 100%; transition: width 0.3s linear, background-color 0.3s; }
.timer-fill.low { background: var(--danger); }
.time-plus { position: absolute; right: 10px; top: -5px; color: var(--primary); font-weight: 900; font-size: 1.2rem; opacity: 0; }
.time-plus.show { animation: floatUpFade 1s ease-out forwards; }
@keyframes floatUpFade { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-20px); } }

/* Vertical Math Layout (Worksheet Style) */
.math-problem {
  font-family: 'Fredoka One', cursive;
  font-size: 4.5rem; line-height: 1;
  display: inline-block; text-align: right;
  margin-bottom: 30px; color: var(--dark);
  position: relative;
}
.math-problem .top-num { display: block; padding-right: 10px; }
.math-problem .bottom-row { display: flex; align-items: center; justify-content: flex-end; border-bottom: 6px solid var(--dark); padding-bottom: 10px; padding-right: 10px; gap: 15px;}
.math-problem .operator { color: var(--secondary); font-size: 3.5rem; }

/* Answer Options Grid */
.options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.opt-btn {
  font-family: 'Fredoka One', cursive; font-size: 2rem;
  background: white; border: 4px solid var(--dark); color: var(--dark);
  border-radius: 16px; padding: 15px; cursor: pointer;
  box-shadow: 0 6px 0 var(--dark); transition: all 0.1s;
}
.opt-btn:active { transform: translateY(6px); box-shadow: 0 0 0 var(--dark); }
.opt-btn.correct { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 6px 0 #16a34a; }
.opt-btn.wrong { background: var(--danger); color: white; border-color: var(--danger); box-shadow: 0 6px 0 #e11d48; }

/* Feedback animations */
.feedback-star { position: absolute; font-size: 4rem; opacity: 0; pointer-events: none; z-index: 10; }
.feedback-star.pop { animation: starPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
@keyframes starPop { 0% { opacity: 1; transform: scale(0.5) rotate(-20deg); } 50% { transform: scale(1.2) rotate(10deg); } 100% { opacity: 0; transform: scale(1) translateY(-30px); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   END SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.score-big { font-size: 5rem; margin: 10px 0; color: var(--secondary); font-family: 'Fredoka One'; line-height: 1;}
.end-msg { font-size: 1.2rem; font-weight: 800; color: #64748b; margin-bottom: 25px; }
.btn-primary {
  width: 100%; font-family: 'Fredoka One', cursive; font-size: 1.5rem;
  background: var(--primary); color: white; border: 4px solid #16a34a;
  border-radius: 16px; padding: 15px; cursor: pointer;
  box-shadow: 0 6px 0 #16a34a; transition: all 0.1s;
}
.btn-primary:active { transform: translateY(6px); box-shadow: 0 0 0 #16a34a; }

</style>
</head>
<body>

<a href="index.html" class="home-btn">ğŸ  Home</a>

<header>
  <h1>Maths Blast!</h1>
  <div class="subtitle">Interactive Worksheet ğŸ“</div>
</header>

<div id="startScreen" class="screen active">
  <div class="worksheet-card">
    <h2 style="font-family:'Fredoka One'; font-size: 1.8rem; margin-bottom: 20px; color: var(--dark);">Choose Your Mode</h2>
    
    <button class="mode-btn relaxed" onclick="startGame('relaxed')">
      <div class="mode-icon">ğŸŒŸ</div>
      <div class="mode-text">
        <h3>Relaxed Mode</h3>
        <p>Take your time! The timer fully resets for every question.</p>
      </div>
    </button>

    <button class="mode-btn blast" onclick="startGame('blast')">
      <div class="mode-icon">ğŸš€</div>
      <div class="mode-text">
        <h3>Blast Mode</h3>
        <p>Survival! Get +5 seconds for every correct answer.</p>
      </div>
    </button>
  </div>
</div>

<div id="gameScreen" class="screen">
  <div class="worksheet-card" style="position:relative;">
    <div class="feedback-star" id="fStar">â­</div>
    
    <div class="top-bar">
      <div>Score: <span id="scoreDisplay">0</span></div>
      <div id="modeDisplay" style="color: var(--warning);">ğŸŒŸ Relaxed</div>
    </div>

    <div class="timer-container">
      <div class="timer-fill" id="timerFill"></div>
      <div class="time-plus" id="timePlus">+5s</div>
    </div>

    <div class="math-problem">
      <span class="top-num" id="num1">0</span>
      <div class="bottom-row">
        <span class="operator" id="operator">+</span>
        <span id="num2">0</span>
      </div>
    </div>

    <div class="options-grid" id="optionsContainer">
      </div>
  </div>
</div>

<div id="endScreen" class="screen">
  <div class="worksheet-card">
    <h2 style="font-family:'Fredoka One'; font-size: 2.5rem; color: var(--dark);">Time's Up!</h2>
    <div class="score-big" id="finalScore">0</div>
    <div class="end-msg" id="endMessage">Great effort!</div>
    <button class="btn-primary" onclick="showStartScreen()">Play Again ğŸ”„</button>
  </div>
</div>

<script>
let score = 0;
let timeLeft = 0;
let timeTotal = 0;
let timerInterval;
let correctAnswer = 0;
let currentMode = 'relaxed'; // 'relaxed' or 'blast'

const SECONDS_RELAXED = 15; // Reset to this every question
const SECONDS_BLAST_START = 20; // Start with this in Blast mode
const BONUS_TIME = 5; // Added per correct answer in Blast mode

// DOM Elements
const screens = {
  start: document.getElementById('startScreen'),
  game: document.getElementById('gameScreen'),
  end: document.getElementById('endScreen')
};
const els = {
  num1: document.getElementById('num1'),
  num2: document.getElementById('num2'),
  op: document.getElementById('operator'),
  opts: document.getElementById('optionsContainer'),
  score: document.getElementById('scoreDisplay'),
  timer: document.getElementById('timerFill'),
  plus: document.getElementById('timePlus'),
  mode: document.getElementById('modeDisplay'),
  star: document.getElementById('fStar')
};

function switchScreen(screenName) {
  Object.values(screens).forEach(s => s.classList.remove('active'));
  screens[screenName].classList.add('active');
}

function showStartScreen() {
  clearInterval(timerInterval);
  switchScreen('start');
}

function startGame(mode) {
  currentMode = mode;
  score = 0;
  els.score.innerText = score;
  
  if (mode === 'relaxed') {
    els.mode.innerHTML = 'ğŸŒŸ Relaxed';
    els.mode.style.color = 'var(--primary)';
    timeTotal = SECONDS_RELAXED;
    timeLeft = SECONDS_RELAXED;
  } else {
    els.mode.innerHTML = 'ğŸš€ Blast';
    els.mode.style.color = 'var(--warning)';
    timeTotal = SECONDS_BLAST_START;
    timeLeft = SECONDS_BLAST_START;
  }

  updateTimerUI();
  generateQuestion();
  switchScreen('game');

  clearInterval(timerInterval);
  timerInterval = setInterval(countdown, 1000);
}

function countdown() {
  timeLeft--;
  updateTimerUI();
  if (timeLeft <= 0) {
    endGame();
  }
}

function updateTimerUI() {
  // Ensure we don't divide by zero or go over 100%
  let percentage = (timeLeft / timeTotal) * 100;
  if (percentage > 100) percentage = 100; 
  if (percentage < 0) percentage = 0;

  els.timer.style.width = percentage + '%';

  if (timeLeft <= 5) {
    els.timer.classList.add('low');
  } else {
    els.timer.classList.remove('low');
  }
}

function generateQuestion() {
  // If Relaxed Mode, reset timer every question!
  if (currentMode === 'relaxed') {
    timeLeft = SECONDS_RELAXED;
    timeTotal = SECONDS_RELAXED; // keep base consistent
    updateTimerUI();
  }

  // Adjust difficulty based on score
  let maxNum = score < 5 ? 10 : (score < 12 ? 20 : 50);
  let isAdd = Math.random() > 0.4; // 60% chance addition

  let n1 = Math.floor(Math.random() * maxNum) + 1;
  let n2 = Math.floor(Math.random() * maxNum) + 1;

  // For subtraction, ensure n1 > n2 for young kids
  if (!isAdd) {
    if (n2 > n1) [n1, n2] = [n2, n1]; 
  }

  els.num1.innerText = n1;
  els.num2.innerText = n2;
  els.op.innerText = isAdd ? '+' : '-';
  correctAnswer = isAdd ? n1 + n2 : n1 - n2;

  generateOptions(correctAnswer);
}

function generateOptions(correct) {
  let options = [correct];
  while (options.length < 4) {
    // Generate answers close to the correct one (more worksheet-like)
    let offset = Math.floor(Math.random() * 5) + 1;
    let wrong = Math.random() > 0.5 ? correct + offset : correct - offset;
    if (wrong >= 0 && !options.includes(wrong)) {
      options.push(wrong);
    }
  }

  // Shuffle options
  options.sort(() => Math.random() - 0.5);

  els.opts.innerHTML = '';
  options.forEach(opt => {
    let btn = document.createElement('button');
    btn.className = 'opt-btn';
    btn.innerText = opt;
    btn.onclick = () => checkAnswer(opt, btn);
    els.opts.appendChild(btn);
  });
}

function checkAnswer(selected, btn) {
  // Disable all buttons to prevent double clicking
  document.querySelectorAll('.opt-btn').forEach(b => b.disabled = true);

  if (selected === correctAnswer) {
    // CORRECT
    btn.classList.add('correct');
    score++;
    els.score.innerText = score;
    
    // Star Animation
    els.star.style.left = btn.offsetLeft + (btn.offsetWidth/2) - 20 + 'px';
    els.star.style.top = btn.offsetTop - 30 + 'px';
    els.star.classList.remove('pop');
    void els.star.offsetWidth; // trigger reflow
    els.star.classList.add('pop');

    // Handle Time Mechanics
    if (currentMode === 'blast') {
      timeLeft += BONUS_TIME;
      // Expand the total bar visually if they bank a lot of time
      if(timeLeft > timeTotal) timeTotal = timeLeft; 
      
      // Show +5s floating text
      els.plus.classList.remove('show');
      void els.plus.offsetWidth; 
      els.plus.classList.add('show');
      updateTimerUI();
    }

    setTimeout(() => {
      generateQuestion();
    }, 600); // Short delay to see green button

  } else {
    // WRONG
    btn.classList.add('wrong');
    // Find the correct button and show it
    document.querySelectorAll('.opt-btn').forEach(b => {
      if (parseInt(b.innerText) === correctAnswer) {
        b.classList.add('correct');
      }
    });

    // Time penalty in blast mode? Let's just let the clock tick naturally so it's not too punishing.
    setTimeout(() => {
      generateQuestion();
    }, 1200); // Longer delay to learn from mistake
  }
}

function endGame() {
  clearInterval(timerInterval);
  document.getElementById('finalScore').innerText = score;
  
  let msg = "Keep Practising! ğŸ‘";
  if (score > 10) msg = "Great Job! ğŸŒŸ";
  if (score > 20) msg = "Maths Superstar! ğŸ†";
  
  document.getElementById('endMessage').innerText = msg;
  switchScreen('end');
}

// Sparkle cursor effect (optional, kept for fun)
document.addEventListener('click', e => {
  if(e.target.tagName === 'BUTTON') return; // Don't block button clicks
  const sparkles = ['âœ¨','âœï¸','ğŸ“'];
  const el = document.createElement('div');
  el.textContent = sparkles[Math.floor(Math.random()*sparkles.length)];
  el.style.position = 'fixed';
  el.style.left = (e.clientX - 10) + 'px';
  el.style.top = (e.clientY - 10) + 'px';
  el.style.fontSize = '1.2rem';
  el.style.pointerEvents = 'none';
  el.style.animation = 'sparkle-pop 0.8s ease forwards';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 800);
});
</script>
</body>
</html>
