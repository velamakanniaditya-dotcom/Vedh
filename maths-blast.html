<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maths Blast! üöÄ</title>
    <link href="https://fonts.googleapis.com/css2?family=Boogaloo&family=Nunito:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --sky-dark: #0a0a2e;
            --gold: #FFD700;
            --neon-blue: #00d2ff;
        }

        body {
            margin: 0;
            font-family: 'Nunito', sans-serif;
            background: radial-gradient(circle at center, #1a3a8f 0%, #0a0a2e 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        #game-box {
            width: 90%;
            max-width: 450px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 3px solid var(--gold);
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            position: relative;
        }

        h1 { font-family: 'Boogaloo', cursive; font-size: 3rem; color: var(--gold); margin: 0 0 10px 0; line-height: 1; }
        p { margin-bottom: 20px; color: rgba(255,255,255,0.8); }

        .stat-row { display: flex; justify-content: space-around; margin: 20px 0; font-size: 1.2rem; }

        #timer-container {
            width: 100%;
            height: 15px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid rgba(255,255,255,0.2);
            overflow: hidden;
        }

        #timer-bar {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #ff007f, #FFD700, #39ff14);
            border-radius: 10px;
            transition: width 0.1s linear;
        }

        #problem {
            font-size: 4.5rem;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        #answer {
            width: 160px;
            font-size: 3rem;
            padding: 10px;
            border-radius: 15px;
            border: 4px solid var(--gold);
            text-align: center;
            outline: none;
            background: #fff;
            color: #0a0a2e;
            font-weight: bold;
        }

        .btn {
            background: var(--gold);
            color: #0a0a2e;
            padding: 15px 40px;
            font-size: 1.5rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-family: 'Boogaloo', cursive;
            margin-top: 10px;
            transition: transform 0.2s;
            width: 100%;
            box-sizing: border-box;
        }
        
        .btn:hover { transform: scale(1.05); }

        .select-diff {
            background: rgba(255,255,255,0.9);
            color: #0a0a2e;
            font-family: 'Nunito', sans-serif;
            font-weight: bold;
            font-size: 1.1rem;
            padding: 10px;
            border-radius: 15px;
            border: 2px solid var(--gold);
            margin-bottom: 20px;
            width: 100%;
            cursor: pointer;
        }

        .hidden { display: none !important; }
        .flash-correct { background: #1b5e20 !important; transition: background 0.1s; }
        .flash-wrong { background: #b71c1c !important; transition: background 0.1s; }
        
        .back-link {
            position: absolute; top: 20px; left: 20px;
            color: var(--gold); text-decoration: none; font-weight: bold;
            font-size: 1.2rem;
            z-index: 10;
        }
    </style>
</head>
<body>

<a href="index.html" class="back-link">üè∞ Back to Kingdom</a>

<div id="game-box">
    <div id="start-screen">
        <h1>üöÄ MATHS BLAST!</h1>
        <p>Keep the rocket flying with correct answers!</p>
        
        <select id="difficulty" class="select-diff">
            <option value="1">üü¢ Easy (Start at Level 1)</option>
            <option value="5">üü° Medium (Start at Level 5)</option>
            <option value="10">üî¥ Hard (Start at Level 10)</option>
        </select>

        <button class="btn" onclick="startGame()">BLAST OFF!</button>
    </div>

    <div id="play-screen" class="hidden">
        <div class="stat-row">
            <span>‚≠ê Score: <b id="score">0</b></span>
            <span>üî• Level: <b id="level">1</b></span>
        </div>
        <div id="timer-container"><div id="timer-bar"></div></div>
        <div id="problem">0 + 0</div>
        <input type="number" id="answer" pattern="\d*" inputmode="numeric" autocomplete="off" placeholder="?">
    </div>

    <div id="end-screen" class="hidden">
        <h1 id="status-title">üí• BOOM!</h1>
        <p>The rocket ran out of fuel!</p>
        <h2 style="font-size: 2.5rem; color: var(--gold); margin: 10px 0;">Score: <span id="final-score">0</span></h2>
        <button class="btn" onclick="showStartScreen()">PLAY AGAIN</button>
    </div>
</div>

<script>
    let score = 0, level = 1, currentAns = 0, timeLeft = 100, timer;
    const probEl = document.getElementById('problem'), ansInp = document.getElementById('answer');
    
    // Audio Synthesizer for zero-dependency sound effects
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx;

    function initAudio() {
        if (!audioCtx) audioCtx = new AudioContext();
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function playSound(type) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // Happy high beep
            osc.type = 'sine';
            osc.frequency.setValueAtTime(587.33, audioCtx.currentTime); // D5
            osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1); // A5
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        } else if (type === 'boom') {
            // Low descending rumble
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.6);
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.6);
        }
    }

    function showStartScreen() {
        document.getElementById('start-screen').className = '';
        document.getElementById('end-screen').className = 'hidden';
        document.getElementById('play-screen').className = 'hidden';
    }

    function startGame() {
        initAudio(); // Required by browsers to start audio on user interaction
        
        score = 0; 
        level = parseInt(document.getElementById('difficulty').value); 
        timeLeft = 100;
        
        document.getElementById('start-screen').className = 'hidden';
        document.getElementById('end-screen').className = 'hidden';
        document.getElementById('play-screen').className = '';
        
        updateStats();
        newProblem();
        startTimer();
        ansInp.focus();
    }

    function newProblem() {
        let n1, n2, op = '+';
        
        // Dynamic difficulty scaling based on level
        let maxAdd = 10 + (level * 2); // Numbers get bigger as level goes up
        let maxMult = 3 + Math.floor(level / 2); // Multipliers grow slowly

        // Unlock operations based on level
        let availableOps = ['+'];
        if (level >= 3) availableOps.push('-');
        if (level >= 6) availableOps.push('√ó');
        
        op = availableOps[Math.floor(Math.random() * availableOps.length)];

        if (op === '+') {
            n1 = rand(1, maxAdd); 
            n2 = rand(1, maxAdd);
            currentAns = n1 + n2;
        } else if (op === '-') {
            n1 = rand(5, maxAdd + 10); 
            n2 = rand(1, n1); // Ensure no negative answers
            currentAns = n1 - n2;
        } else if (op === '√ó') {
            n1 = rand(2, 12); 
            n2 = rand(2, maxMult);
            currentAns = n1 * n2;
        }

        probEl.innerText = `${n1} ${op} ${n2}`;
        ansInp.value = '';
    }

    function rand(min, max) { return Math.floor(Math.random() * (max - min + 1) + min); }

    ansInp.addEventListener('input', () => {
        if (ansInp.value === '') return; // Ignore empty input
        
        if (parseInt(ansInp.value) === currentAns) {
            playSound('correct');
            score++;
            timeLeft = Math.min(100, timeLeft + 15); // Add fuel back
            if (score % 5 === 0) level++; // Level up every 5 correct answers
            
            flash('flash-correct');
            updateStats();
            newProblem();
        }
    });

    function startTimer() {
        clearInterval(timer);
        timer = setInterval(() => {
            // Game gets slightly faster the higher the level
            let speedDeduction = 0.5 + (level * 0.05);
            timeLeft -= speedDeduction; 
            
            document.getElementById('timer-bar').style.width = Math.max(0, timeLeft) + '%';
            
            // Change color to red if time is low
            if(timeLeft < 30) {
                document.getElementById('timer-bar').style.background = '#ff0000';
            } else {
                document.getElementById('timer-bar').style.background = 'linear-gradient(90deg, #ff007f, #FFD700, #39ff14)';
            }

            if (timeLeft <= 0) gameOver();
        }, 100);
    }

    function gameOver() {
        clearInterval(timer);
        playSound('boom');
        document.getElementById('play-screen').className = 'hidden';
        document.getElementById('end-screen').className = '';
        document.getElementById('final-score').innerText = score;
    }

    function updateStats() {
        document.getElementById('score').innerText = score;
        document.getElementById('level').innerText = level;
    }

    function flash(cls) {
        document.body.classList.add(cls);
        setTimeout(() => document.body.classList.remove(cls), 150);
    }
    
    // Keep focus on input so kid doesn't have to click it again if they click away
    document.addEventListener('click', () => {
        if(!document.getElementById('play-screen').classList.contains('hidden')) {
            ansInp.focus();
        }
    });
</script>
</body>
</html>
